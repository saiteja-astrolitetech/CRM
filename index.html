<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy CRM</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />

    <!-- Leaflet CSS -->
    <link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Chart.js (only include once) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jsPDF Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- jsPDF AutoTable Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- SheetJS (XLSX) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Google Charts Loader (only include once) -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body {
            background: white;
            color: #212529;
            overflow-x: hidden;
            font-size: 0.95rem;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            gap: 1.5rem;
        }

        header button {
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }

        header button:hover {
            transform: scale(1.1);
        }

        .hdr-logo {
            height: 50px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .hdr-logo:hover {
            transform: scale(1.05);
        }

        .hdr-left,
        .hdr-center,
        .hdr-right {
            display: flex;
            align-items: center;
        }

        .hdr-left {
            gap: 2rem;
        }

        .hdr-center {
            flex: 1;
            justify-content: center;
        }

        .hdr-right {
            gap: 1rem;
        }

        .hdr-search {
            width: 100%;
            max-width: 350px;
            min-width: 200px;
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
            transition: all 0.3s;
        }

        .hdr-search:focus {
            border-color: #4286f4;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .hdr-icon {
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px;
            border-radius: 50%;
        }

        .hdr-icon:hover {
            background: #e9ecef;
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #ffffff;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            z-index: 1;
            border-radius: 8px;
            padding: 8px 0;
            right: 0;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-item {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dropdown-item:hover {
            background-color: #e9ecef;
        }

        .dropdown-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1rem;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .dropdown-btn:hover {
            background-color: #e9ecef;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot.green {
            background: #10b981;
        }

        .dot.red {
            background: #ef4444;
        }

        .dot.gray {
            background: #6b7280;
        }

        .profile-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .profile-section:hover {
            background-color: #e9ecef;
        }

        .profile-name {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            font-size: 14px;
            z-index: 100;
        }

        .profile-section:hover .profile-name {
            opacity: 1;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .sidebar {
            position: fixed;
            top: 80px;
            left: 0;
            bottom: 0;
            background: white;
            overflow-y: auto;
            padding: 1rem;
            transition: transform 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            background: #ffffff;
            margin: 0.75rem 0;
            padding: 0.8rem 1rem;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #297e33;
        }

        .sidebar li:hover {
            background: #e9ecef;
            transform: translateX(8px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .sidebar li.active {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            color: white;
        }

        .sidebar i {
            width: 20px;
            text-align: center;
        }

        .main {
            margin-top: 80px;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }

        .main.collapsed {
            margin-left: 0;
            padding-left: 0;
        }

        .banner {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: white;
            padding: 15px 20px;
            gap: 12px;
        }

        .section {
            display: none;

        }

        .section.active {
            display: block;

        }

        .profile-form {
            max-width: 500px;
            background: #ffffff;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 1rem;
        }

        .profile-form label {
            display: block;
            margin: 1rem 0 0.5rem;
            font-weight: 500;
        }

        .profile-form input,
        .profile-form textarea,
        .profile-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            transition: all 0.3s;
            margin-bottom: 0.5rem;
        }

        .profile-form input:focus,
        .profile-form textarea:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .profile-form button {
            margin-top: 1.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .input-error {
            border-color: #ff3860 !important;
        }

        .error-message {
            color: #ff3860;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: none;
        }

        @media (max-width: 992px) {
            .sidebar {
                display: none;
            }

            .main {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-wrap: wrap;
                height: auto;
                padding: 1rem;
            }

            .hdr-left,
            .hdr-center,
            .hdr-right {
                width: 100%;
                justify-content: space-between;
                margin: 5px 0;
            }

            .hdr-search {
                max-width: 100%;
            }

            .main {
                padding: 1rem;
            }

            .profile-form {
                padding: 1rem;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        .sidebar::-webkit-scrollbar {
            display: none;
        }

        body::-webkit-scrollbar {
            display: none;
        }
    </style>
    <style>
        /* Global Styles */
        :root {
            --primary: #2c6e49;
            --secondary: #4c956c;
            --accent: #f8961e;
            --light: #f9f7f3;
            --dark: #2d3142;
            --success: #43aa8b;
            --warning: #f8961e;
            --danger: #e63946;
            --info: #457b9d;
            --gray: #8d99ae;
            --light-gray: #edf2f4;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: white;
            color: var(--dark);
            line-height: 1.6;
            background: white;
            overflow-x: hidden;
            font-size: 0.95rem;
        }

        .section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: var(--transition);
        }

        .section:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            margin: 20px 0;
            color: var(--primary);
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 10px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card-gridd {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .card.card-blue {
            border-top-color: #457b9d;
        }

        .card.card-green {
            border-top-color: #43aa8b;
        }

        .card.card-orange {
            border-top-color: #f8961e;
        }

        .card.card-red {
            border-top-color: #e63946;
        }

        .card.card-purple {
            border-top-color: #6a4c93;
        }

        .card.card-teal {
            border-top-color: #2a9d8f;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: rgba(44, 110, 73, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--dark);
        }

        .card-change {
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-change i {
            color: var(--success);
        }

        .card-change.down i {
            color: var(--danger);
            transform: rotate(180deg);
        }

        .form-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .form-control {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 110, 73, 0.2);
        }

        .btn {
            padding: 10px 12px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #24593d;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #388d72;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f3c;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #3a6a8a;
        }

        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .custom-table th {
            background-color: var(--primary);
            color: white;
            text-align: left;
            padding: 15px;
            font-weight: 600;
        }

        .custom-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .custom-table tr:last-child td {
            border-bottom: none;
        }

        .custom-table tr:hover {
            background-color: rgba(44, 110, 73, 0.05);
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(800px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .chart-box {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
        }

        .chart-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 600;
        }

        .chart-canvas {
            height: 300px;
            position: relative;
        }

        .activity-log {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-top: 25px;
        }

        .activity-log h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .activity-log ul {
            list-style: none;
        }

        .activity-log li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-log li:last-child {
            border-bottom: none;
        }

        .activity-log i {
            color: var(--secondary);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            padding: 25px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group label .required {
            color: var(--danger);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .tabs-container {
            margin: 25px 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            background: var(--light-gray);
            border-bottom: 1px solid var(--light-gray);
        }

        .tab-btn {
            padding: 15px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark);
            transition: var(--transition);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            padding: 25px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .filter-input {
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .view-buttons {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 10px 15px;
            background: var(--light-gray);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        .action-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }

        .pagination button {
            padding: 8px 15px;
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            cursor: pointer;
        }

        .pagination button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Responsive styles */
        @media (max-width: 992px) {
            .charts-container {
                grid-template-columns: 1fr;
            }

            .charts-containerr {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .form-controls {
                flex-direction: column;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .view-controls {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }

        /* Section-specific adjustments */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .map-placeholder {
            height: 400px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            text-align: center;
            padding: 20px;
        }

        .map-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card-summary {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            text-align: center;
            border-top: 4px solid var(--primary);
        }

        .card-summary.total {
            border-top-color: var(--primary);
        }

        .card-summary.capacity {
            border-top-color: var(--info);
        }

        .card-summary.active {
            border-top-color: var(--accent);
        }

        .card-summary.products {
            border-top-color: var(--purple);
        }

        .card-summary .icon {
            width: 60px;
            height: 60px;
            background: rgba(44, 110, 73, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .card-summary h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .card-summary p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .validation-summary {
            background: #fee;
            color: var(--danger);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--danger);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification i {
            font-size: 1.5rem;
            color: var(--success);
        }

        .notification-content h4 {
            margin-bottom: 5px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn.edit {
            background: #e3f2fd;
            color: #1976d2;
        }

        .action-btn.delete {
            background: #ffebee;
            color: #d32f2f;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }
    </style>
    <style>
        /* Modal display fix */
        .modal {
            display: none;
        }

        .modal.active {
            display: flex;
        }

        /* Add chart header styles */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        /* Fix status indicator colors */
        .status-active {
            color: var(--success);
            background: rgba(67, 170, 139, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .status-inactive {
            color: var(--warning);
            background: rgba(248, 150, 30, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--light-gray);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
        }

        /* Order Form Styles */
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .item-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--light-gray);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .qty-input {
            width: 60px;
            padding: 8px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .order-summary {
            background: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .summary-row.total {
            font-weight: bold;
            border-top: 1px solid var(--gray);
            margin-top: 10px;
            padding-top: 15px;
        }

        .status-pending {
            color: var(--warning);
            background: rgba(248, 150, 30, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 500;
        }

        .btn-edit {
            background: #e3f2fd;
            color: #1976d2;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .btn-edit:hover {
            background: #bbdefb;
        }

        .btn-delete {
            background: #ffebee;
            color: #d32f2f;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .btn-delete:hover {
            background: #ffcdd2;
        }

        .capacity-progress {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
        }

        .capacity-progress-bar {
            height: 100%;
            background: var(--success);
            transition: var(--transition);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 2fr));
            gap: 20px;
        }

        .chart-wrapper {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            height: 350px;
        }


        .alert-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-top: 25px;
        }

        .alert-container h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .alert-container ul {
            list-style: none;
        }

        .alert-container li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-container li:last-child {
            border-bottom: none;
        }

        .alert-container i {
            color: var(--secondary);
        }

        /* Plant Cards */
        .plant-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
            border-top: 4px solid var(--primary);
        }

        .plant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .plant-header {
            margin-bottom: 15px;
        }

        .plant-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .status-active {
            background: rgba(67, 170, 139, 0.1);
            color: var(--success);
        }

        .status-inactive {
            background: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }

        .status-maintenance {
            background: rgba(69, 123, 157, 0.1);
            color: var(--info);
        }

        .plant-name {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .plant-location {
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .plant-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .plant-detail {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 10px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .detail-value {
            font-weight: 300;
        }

        .plant-products {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .product-tag {
            background: rgba(44, 110, 73, 0.1);
            color: var(--primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .plant-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            background: rgba(25, 118, 210, 0.1);
            color: #1976d2;
        }

        .btn-delete {
            background: rgba(211, 47, 47, 0.1);
            color: #d32f2f;
        }

        .btn-edit:hover,
        .btn-delete:hover {
            opacity: 0.9;
        }

        .charts-containerr {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }


        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-in-stock {
            background: rgba(67, 170, 139, 0.15);
            color: var(--success);
        }

        .status-low-stock {
            background: rgba(248, 150, 30, 0.15);
            color: var(--warning);
        }

        .status-out-of-stock {
            background: rgba(230, 57, 70, 0.15);
            color: var(--danger);
        }

        .expiry-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .expiry-safe {
            background: rgba(67, 170, 139, 0.15);
            color: var(--success);
        }

        .expiry-soon {
            background: rgba(248, 150, 30, 0.15);
            color: var(--warning);
        }

        .expiry-expired {
            background: rgba(230, 57, 70, 0.15);
            color: var(--danger);
        }

        .change {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .low-contrast {
            opacity: 0.7;
        }

        /* Color Variants */
        .card-blue {
            border-color: #2563eb;
            box-shadow: 0 6px 12px rgba(37, 99, 235, 0.15);
        }

        .card-blue .stat-icon,
        .card-blue .delivery-icon {
            color: #2563eb;
        }

        .card-sky {
            border-color: #0ea5e9;
            box-shadow: 0 6px 12px rgba(14, 165, 233, 0.15);
        }

        .card-sky .stat-icon {
            color: #0ea5e9;
        }

        .card-amber {
            border-color: #d97706;
            box-shadow: 0 6px 12px rgba(217, 119, 6, 0.15);
        }

        .card-amber .stat-icon {
            color: #d97706;
        }

        .card-emerald {
            border-color: #059669;
            box-shadow: 0 6px 12px rgba(5, 150, 105, 0.15);
        }

        .card-emerald .stat-icon {
            color: #059669;
        }

        .card-orange {
            border-color: #ea580c;
            box-shadow: 0 6px 12px rgba(234, 88, 12, 0.15);
        }

        .card-orange .stat-icon {
            color: #ea580c;
        }

        .card-indigo {
            border-color: #4f46e5;
            box-shadow: 0 6px 12px rgba(79, 70, 229, 0.15);
        }

        .card-indigo .stat-icon {
            color: #4f46e5;
        }

        .card-green {
            border-color: #10b981;
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.15);
        }

        .card-green .stat-icon {
            color: #10b981;
        }

        .card-yellow {
            border-color: #f59e0b;
            box-shadow: 0 6px 12px rgba(245, 158, 11, 0.15);
        }

        .card-yellow .stat-icon {
            color: #f59e0b;
        }

        .card-rose {
            border-color: #f43f5e;
            box-shadow: 0 6px 12px rgba(244, 63, 94, 0.15);
        }

        .card-rose .stat-icon {
            color: #f43f5e;
        }

        .card-teal {
            border-color: #14b8a6;
            box-shadow: 0 6px 12px rgba(20, 184, 166, 0.15);
        }

        .card-teal .stat-icon {
            color: #14b8a6;
        }

        .card-violet {
            border-color: #8b5cf6;
            box-shadow: 0 6px 12px rgba(139, 92, 246, 0.15);
        }

        .card-violet .stat-icon {
            color: #8b5cf6;
        }

        .card-lime {
            border-color: #22c55e;
            box-shadow: 0 6px 12px rgba(34, 197, 94, 0.15);
        }

        .card-lime .stat-icon {
            color: #22c55e;
        }

        .card-red {
            border-color: #ef4444;
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.15);
        }

        .card-red .stat-icon {
            color: #ef4444;
        }

        .card-purple {
            border-color: #7c3aed;
            box-shadow: 0 6px 12px rgba(124, 58, 237, 0.15);
        }

        .card-purple .stat-icon {
            color: #7c3aed;
        }

        .card-azure {
            border-color: #3b82f6;
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.15);
        }

        .card-azure .stat-icon {
            color: #3b82f6;
        }

        .status-setup {
            background: rgba(69, 123, 157, 0.1);
            color: var(--info);
        }

        .clear-btn {
            background: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            margin-left: auto;
        }

        .activity-feed {
            list-style: none;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .activity-feed li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-header {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
    </style>
    <style>
        #farmer_lineChart,
        #farmer_pieChart,
        #payments_chart_status {
            height: 300px !important;
        }

        .activity-section {
            margin-top: 30px;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .activity-time {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .deliveryvehiclecard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .btn-add {
            background: transparent;
            border: 1px dashed var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        /* === Enhanced Dark Mode === */
        .dark-mode {
            --primary: #8ab4f8;
            --primary-dark: #5a9cf5;
            --secondary: #81c995;
            --secondary-dark: #5ca877;
            --accent: #f28b82;
            --accent-dark: #e07c73;
            --warning: #fbbc04;
            --warning-dark: #f9ab00;
            --light: #202124;
            --dark: #e8eaed;
            --gray: #9aa0a6;
            --light-gray: #3c4043;
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text: #e8eaed;
            --text-light: #bdc1c6;
            --border: #3c4043;
        }

        /* Remove gradient backgrounds for dark mode */
        .dark-mode .section {
            background-color: black;
            border-radius: 0px;
        }


        .dark-mode .sidebar {
            background-color: black;
            border: none;
        }


        .dark-mode .sidebar li {
            background: var(--card-bg) !important;
            border: none;
        }

        .dark-mode .tab.active {
            background-color: green !important;
        }

        .dark-mode .banner,
        .dark-mode header button {
            background: var(--card-bg) !important;
            color: var(--text);
        }

        /* Charts, cards, tables, modals cleanup */
        .dark-mode .card,
        .dark-mode .card-summary,
        .dark-mode .chart-box,
        .dark-mode .modal-content,
        .dark-mode .data-section,
        .dark-mode .info-box,
        .dark-mode .orders-section,
        .dark-mode .table-wrapper,
        .dark-mode .alert-container,
        .dark-mode .gauge,
        .dark-mode .feedback-card,
        .dark-mode .setting-card,
        .dark-mode .profile-form {
            background: var(--card-bg) !important;
            color: var(--text);
            border: 1px solid var(--border);
        }

        /* Header and input */
        .dark-mode header,
        .dark-mode input,
        .dark-mode select,
        .dark-mode header,
        .dark-mode textarea {
            background: var(--card-bg);
            color: var(--text);
            border-color: var(--border);
        }

        /* Buttons */
        .dark-mode .btn,
        .dark-mode .btn-export,
        .dark-mode .chart-btn,
        .dark-mode .btn-outline,
        .dark-mode .dropdown-btn,
        .dark-mode .dropdown-item,
        .dark-mode .pagination button {
            background: var(--light-gray) !important;
            color: var(--text) !important;
            border: 1px solid var(--border);
        }

        .dark-mode .btn:hover,
        .dark-mode .chart-btn:hover,
        .dark-mode .btn-outline:hover,
        .dark-mode .dropdown-btn:hover,
        .dark-mode .dropdown-item:hover,
        .dark-mode .pagination button:hover {
            background: var(--gray) !important;
        }

        /* Table Header */
        .dark-mode th {
            background: var(--light-gray);
            color: var(--text-light);
        }

        /* Status badges */
        .dark-mode .status-badge {
            color: inherit;
        }

        /* Modal overlays */
        .dark-mode .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
        }


        .dark-mode table,
        .dark-mode thead,
        .dark-mode tbody,
        .dark-mode tr,
        .dark-mode td,
        .dark-mode th {
            background-color: var(--card-bg) !important;
            color: var(--text) !important;
            border-color: var(--border) !important;
        }

        .dark-mode table th {
            background: var(--light-gray) !important;
            color: var(--text-light) !important;
        }

        .dark-mode .pagination button {
            background: var(--light-gray) !important;
            color: var(--text);
            border: 1px solid var(--border);
        }


        /* Dark mode visual corrections */
        .dark-mode .card,
        .dark-mode .info-box,
        .dark-mode .modal-content,
        .dark-mode .table-wrapper,
        .dark-mode .custom-table,
        .dark-mode .alert-container {
            background: var(--card-bg) !important;
            color: var(--text) !important;
            border: 1px solid var(--border);
        }

        .dark-mode .card i,
        .dark-mode .card .card-title,
        .dark-mode .card .card-value,
        .dark-mode .card .card-change {
            color: var(--text) !important;
        }

        /* Dark mode support for charts */
        .dark-mode .chart-container,
        .dark-mode .charts-container,
        .dark-mode .charts-containerr,
        .dark-mode .chart-containerr {
            background: var(--card-bg) !important;
            color: var(--text) !important;
            border: 1px solid var(--border);
        }

        .dark-mode .tab.active {
            background-color: whitesmoke;
            color: black;
        }

        .dark-mode .sidebar li.active {
            background-color: whitesmoke !important;
            color: black;
        }

        .dark-mode .activity-log,
        .dark-mode .activity-section,
        .dark-mode .plant-card,
        .dark-mode .activity-feed,
        .dark-mode #chilling_temperatureChart,
        .dark-mode #chilling_capacityChart,
        .dark-mode #chilling_energyChart,
        .dark-mode #chilling_tempPerformanceChart {
            background: var(--card-bg) !important;
            color: var(--text);
        }
    </style>
</head>

<body>
    <header>
        <div class="hdr-left">
            <img alt="Logo" class="hdr-logo" onclick="showSection('dashboard')" src="Company logo.jpg" />
            <button onclick="toggleSidebar()">â˜°</button>
        </div>
        <div class="hdr-center">
            <input class="hdr-search" placeholder="Search..." type="text" />
        </div>
        <div class="hdr-right">
            <i class="fas fa-bell hdr-icon"></i>
            <i class="fas fa-envelope hdr-icon"></i>
            <div class="dropdown">
                <button class="dropdown-btn">English</button>
                <div class="dropdown-content">
                    <div class="dropdown-item" onclick="setLanguage('en')">English</div>
                    <div class="dropdown-item" onclick="setLanguage('hi')">Hindi</div>
                    <div class="dropdown-item" onclick="setLanguage('te')">Telugu</div>
                    <div class="dropdown-item" onclick="setLanguage('de')">German</div>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn"><span class="dot green"></span> Active</button>
                <div class="dropdown-content">
                    <div class="dropdown-item" onclick="setWorkMode('active')"><span class="dot green"></span> Active
                    </div>
                    <div class="dropdown-item" onclick="setWorkMode('away')"><span class="dot gray"></span> Away</div>
                    <div class="dropdown-item" onclick="setWorkMode('dnd')"><span class="dot red"></span> Do Not Disturb
                    </div>
                </div>
            </div>
            <!-- Add this to your header's hdr-right section -->
            <button class="theme-toggle" id="theme-toggle" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i>
            </button>
            <div class="profile-section"
                onclick="document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById('profile').classList.add('active');">
                <span class="profile-name">Sai Teja</span>
                <img alt="Profile" class="profile-img" src="image.png" />
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <ul>
            <li class="active" onclick="activateNav(this,'dashboard')"><i class="fas fa-home"></i> Dashboard</li>
            <li onclick="activateNav(this,'farmer-mgmt')"><i class="fas fa-users"></i> Farmer Management</li>
            <li onclick="activateNav(this,'milk-collection')"><i class="fas fa-tint"></i> Milk Collection</li>
            <li onclick="activateNav(this,'chilling')"><i class="fas fa-snowflake"></i> Chilling Centers</li>
            <li onclick="activateNav(this,'processing')"><i class="fas fa-cogs"></i> Processing Plants</li>
            <li onclick="activateNav(this,'inventory')"><i class="fas fa-boxes"></i> Product Inventory</li>
            <li onclick="activateNav(this,'logistics')"><i class="fas fa-truck"></i> Distribution &amp; Logistics</li>
            <li onclick="activateNav(this,'retail')"><i class="fas fa-store"></i> Retail &amp; Franchise</li>
            <li onclick="activateNav(this,'customers-section')"><i class="fas fa-user-friends"></i> Customers</li>
            <li onclick="activateNav(this,'deliveries-section')"><i class="fas fa-shipping-fast"></i> Deliveries</li>
            <li onclick="activateNav(this,'payments-section')"><i class="fas fa-rupee-sign"></i> Payments</li>
            <li onclick="activateNav(this,'reports-section')"><i class="fas fa-file-alt"></i> Reports</li>
            <li onclick="activateNav(this,'settings-section')"><i class="fas fa-cog"></i> Settings</li>
        </ul>
    </aside>

    <div class="main" id="main">

        <div class="section active fade-in" id="dashboard">
            <div class="banner">
                <i class="fas fa-chart-line"></i> Real-Time Dashboard Metrics
            </div>

            <div class="card-grid" id="dashboard_cards">
                <div class="card card-blue">
                    <div class="card-header">
                        <div class="card-title">Total Milk (L)</div>
                        <div class="card-icon">
                            <i class="fas fa-wine-bottle"></i>
                        </div>
                    </div>
                    <div id="dashboard_card_total_milk" class="card-value">0</div>
                    <div id="dashboard_card_change_milk" class="card-change">N/A</div>
                </div>

                <div class="card card-orange">
                    <div class="card-header">
                        <div class="card-title">Total Revenue</div>
                        <div class="card-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                    </div>
                    <div id="dashboard_card_total_revenue" class="card-value">â‚¹0</div>
                    <div id="dashboard_card_change_revenue" class="card-change">N/A</div>
                </div>

                <div class="card card-green">
                    <div class="card-header">
                        <div class="card-title">Customers</div>
                        <div class="card-icon">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div id="dashboard_card_total_customers" class="card-value">0</div>
                    <div id="dashboard_card_change_customers" class="card-change">N/A</div>
                </div>
            </div>

            <div class="section-title">
                <i class="fas fa-file-invoice-dollar"></i> Sales Records
            </div>

            <div class="form-controls">
                <input type="text" placeholder="Search..." id="dashboard_search" class="form-control">
                <button class="btn btn-success" onclick="dashboard_open_modal()">
                    <i class="fas fa-plus"></i> Add Record
                </button>
            </div>

            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Milk (L)</th>
                        <th>Revenue (â‚¹)</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dashboard_table_body"></tbody>
            </table>

            <div class="charts-container">
                <div class="chart-box">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i> Revenue Trends
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dashboard_trend_chart"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-header">
                        <div class="chart-title">
                            <i class="fas fa-chart-pie"></i> Customer Revenue Distribution
                        </div>
                        <button class="btn btn-outline" onclick="dashboard_export_chart()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dashboard_polar_chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="activity-log">
                <h4>
                    <i class="fas fa-history"></i> Recent Activity
                </h4>
                <ul id="dashboard_activity"></ul>
            </div>

            <div class="modal" id="dashboard_modal">
                <div class="modal-content">
                    <button class="modal-close" onclick="dashboard_close_modal()">&times;</button>
                    <div class="modal-title">
                        <i class="fas fa-plus-circle"></i>
                        <span id="dashboard_modal_title">Add Sale</span>
                    </div>

                    <div id="dashboard_validation_summary" class="validation-summary"></div>

                    <div class="form-group">
                        <label>Customer Name <span class="required">*</span></label>
                        <input type="text" id="dashboard_input_customer" class="form-control" required>
                        <div id="dashboard_customer_error" class="error-message">Customer name is required</div>
                    </div>

                    <div class="form-group">
                        <label>Milk Quantity (L) <span class="required">*</span></label>
                        <input type="number" id="dashboard_input_milk" class="form-control" min="1" step="0.1">
                        <div id="dashboard_milk_error" class="error-message">Milk quantity must be at least 1L</div>
                    </div>

                    <div class="form-group">
                        <label>Revenue (â‚¹) <span class="required">*</span></label>
                        <input type="number" id="dashboard_input_revenue" class="form-control" min="0" step="1">
                        <div id="dashboard_revenue_error" class="error-message">Revenue must be a positive number</div>
                    </div>

                    <div class="form-group">
                        <label>Date <span class="required">*</span></label>
                        <input type="date" id="dashboard_input_date" class="form-control">
                        <div id="dashboard_date_error" class="error-message">Date is required and cannot be in the
                            future</div>
                    </div>

                    <div class="form-group">
                        <label>Status <span class="required">*</span></label>
                        <select id="dashboard_input_status" class="form-control">
                            <option>Completed</option>
                            <option>Pending</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-success" onclick="dashboard_save_record()">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="btn btn-outline" onclick="dashboard_close_modal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="section fade-in" id="farmer-mgmt">
            <div class="container">
                <div class="banner">
                    <i class="fas fa-tractor"></i> Farmer Management System
                </div>

                <!-- Summary Cards -->
                <div class="card-grid">
                    <div class="card card-blue">
                        <div class="card-header">
                            <div class="card-title">Total Farmers</div>
                            <i class="fas fa-users card-icon"></i>
                        </div>
                        <div id="farmer_total" class="card-value">8</div>
                        <div class="card-change">
                            <i class="fas fa-arrow-up"></i>
                            <span id="farmer_deliveries-change">5%</span> from last month
                        </div>
                    </div>

                    <div class="card card-emerald">
                        <div class="card-header">
                            <div class="card-title">Total Milk (L)</div>
                            <i class="fas fa-tint card-icon"></i>
                        </div>
                        <div id="farmer_totalMilk" class="card-value">855.0</div>
                        <div class="card-change">
                            <i class="fas fa-arrow-up"></i>
                            <span id="farmer_on-time-change">7%</span> from last month
                        </div>
                    </div>

                    <div class="card card-orange">
                        <div class="card-header">
                            <div class="card-title">Active Regions</div>
                            <i class="fas fa-map-marker-alt card-icon"></i>
                        </div>
                        <div id="farmer_activeRegions" class="card-value">8</div>
                        <div class="card-change">
                            <i class="fas fa-arrow-up"></i>
                            <span id="farmer_fuel-change">3%</span> from last month
                        </div>
                    </div>
                </div>
                <div class="section-title"><i class="fas fa-tractor"></i> Farmer Records</div>
                <!-- Table Section -->
                <div class="table-section">
                    <div class="section-actions change" style="gap: 10px;">
                        <input type="text" id="farmer_searchInput" placeholder="Search by name or region..."
                            class="form-control">
                        <select id="farmer_regionFilter" class="form-control">
                            <option value="">All Regions</option>
                            <option value="Kerala South">Kerala South</option>
                            <option value="Gujarat West">Gujarat West</option>
                            <option value="Uttar Pradesh North">Uttar Pradesh North</option>
                            <option value="Tamil Nadu South">Tamil Nadu South</option>
                            <option value="Rajasthan West">Rajasthan West</option>
                            <option value="Punjab North">Punjab North</option>
                            <option value="Bihar East">Bihar East</option>
                            <option value="Andhra Pradesh South">Andhra Pradesh South</option>
                        </select>
                        <button id="farmer_addBtn" class="btn btn-success">
                            <i class="fas fa-plus"></i> Add New Farmer
                        </button>
                        <button id="farmer_exportBtn" class="btn btn-info">
                            <i class="fas fa-file-export"></i> Export CSV
                        </button>
                        <button id="farmer_pdfBtn" class="btn btn-outline">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>

                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Region</th>
                                <th>Contact</th>
                                <th>Milk (L)</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="farmer_tableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>

                    <div id="farmer_pagination" class="pagination"></div>
                </div>

                <!-- Charts -->
                <div class="charts-containerr">
                    <div class="chart-container">
                        <h2 class="section-title"><i class="fas fa-chart-pie"></i> Milk Distribution by Region</h2>
                        <div class="chart-box">
                            <canvas id="farmer_pieChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h2 class="section-title"><i class="fas fa-chart-line"></i> Milk Production Trend</h2>
                        <div class="chart-box">
                            <canvas id="farmer_lineChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Map -->
                <div class="map-container">
                    <h2 class="section-title"><i class="fas fa-map-marked-alt"></i> Farmers Map</h2>
                    <div id="farmer_map" class="map-placeholder">
                        <i class="fas fa-map"></i>
                        <p>Farmers will appear on the map once data is loaded</p>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="alert-container">
                    <h2><i class="fas fa-history"></i> Recent Activity Log</h2>
                    <ul id="farmer_activityLog">
                        <li><i class="fas fa-user-plus"></i> [10:30 AM] Added new farmer: Rajesh Verma</li>
                        <li><i class="fas fa-user-edit"></i> [09:45 AM] Updated farmer: Lakshmi Nair</li>
                        <li><i class="fas fa-user-minus"></i> [Yesterday] Deleted farmer: Sunil Kumar</li>
                        <li><i class="fas fa-file-export"></i> [Yesterday] Exported farmer data to CSV</li>
                    </ul>
                </div>

                <!-- Modal for form -->
                <div id="farmer_formModal" class="modal">
                    <div class="modal-content">
                        <button class="modal-close" id="farmer_formModalClose">&times;</button>
                        <h2 class="section-title">
                            <i class="fas fa-user-edit"></i> Add/Edit Farmer
                        </h2>
                        <div id="farmer_validationSummary" class="validation-summary"></div>
                        <form id="farmer_form" class="settings-grid" novalidate>
                            <input type="hidden" id="farmer_editIndex" value="-1">

                            <div class="form-group">
                                <label for="farmer_name">Farmer Name <span class="required">*</span></label>
                                <input type="text" id="farmer_name" placeholder="Enter full name" class="form-control"
                                    required>
                                <div class="error-message" id="farmer_name-error">Name is required</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_contact">Contact Number <span class="required">*</span></label>
                                <input type="tel" id="farmer_contact" placeholder="Enter phone number"
                                    class="form-control" required>
                                <div class="error-message" id="farmer_contact-error">Valid 10-digit phone number
                                    required</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_region">Region <span class="required">*</span></label>
                                <select id="farmer_region" class="form-control" required>
                                    <option value="">Select Region</option>
                                    <option value="Kerala South">Kerala South</option>
                                    <option value="Gujarat West">Gujarat West</option>
                                    <option value="Uttar Pradesh North">Uttar Pradesh North</option>
                                    <option value="Tamil Nadu South">Tamil Nadu South</option>
                                    <option value="Rajasthan West">Rajasthan West</option>
                                    <option value="Punjab North">Punjab North</option>
                                    <option value="Bihar East">Bihar East</option>
                                    <option value="Andhra Pradesh South">Andhra Pradesh South</option>
                                </select>
                                <div class="error-message" id="farmer_region-error">Region is required</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_milk">Milk Production (L) <span class="required">*</span></label>
                                <input type="number" id="farmer_milk" placeholder="Enter liters per day"
                                    class="form-control" required min="1" step="0.1">
                                <div class="error-message" id="farmer_milk-error">Valid quantity required (min 1L)</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_latitude">Latitude <span class="required">*</span></label>
                                <input type="number" id="farmer_latitude" placeholder="Enter latitude" step="0.000001"
                                    class="form-control" required min="-90" max="90">
                                <div class="error-message" id="farmer_latitude-error">Valid latitude required (-90 to
                                    90)</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_longitude">Longitude <span class="required">*</span></label>
                                <input type="number" id="farmer_longitude" placeholder="Enter longitude" step="0.000001"
                                    class="form-control" required min="-180" max="180">
                                <div class="error-message" id="farmer_longitude-error">Valid longitude required (-180 to
                                    180)</div>
                            </div>

                            <div class="form-group">
                                <label for="farmer_status">Status</label>
                                <select id="farmer_status" class="form-control" required>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Pending">Pending Verification</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Farmer
                                </button>
                                <button type="button" id="farmer_cancelBtn" class="btn btn-outline">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal for delete confirmation -->
                <div id="farmer_deleteModal" class="modal">
                    <div class="modal-content">
                        <button class="modal-close" id="farmer_deleteModalClose">&times;</button>
                        <h3>Confirm Deletion</h3>
                        <p id="farmer_deleteModalMessage">Are you sure you want to delete this farmer?</p>
                        <div class="form-actions">
                            <button id="farmer_confirmDelete" class="btn btn-danger">Confirm</button>
                            <button id="farmer_cancelDelete" class="btn btn-outline">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Toast Container -->
                <div id="farmer_toastContainer"></div>
            </div>
        </div>

        <div class="section fade-in" id="milk-collection">
            <div class="banner">
                <i class="fas fa-cow"></i> Milk Collection Management
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card-summary total card-indigo">
                    <div class="icon">
                        <i class="fas fa-tint stat-icon"></i>
                    </div>
                    <div id="milkcollection_totalLitresVal" class="card-value">0 L</div>
                    <p>Total Milk Collected</p>
                </div>

                <div class="card-summary capacity card-green">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div id="milkcollection_totalFarmersVal" class="card-value">0</div>
                    <p>Total Farmers</p>
                </div>

                <div class="card-summary active card-yellow">
                    <div class="icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div id="milkcollection_avgFatVal" class="card-value">0%</div>
                    <p>Average Fat %</p>
                </div>

                <div class="card-summary products card-rose">
                    <div class="icon">
                        <i class="fas fa-percent"></i>
                    </div>
                    <div id="milkcollection_avgSNFVal" class="card-value">0%</div>
                    <p>Average SNF %</p>
                </div>
            </div>

            <!-- Add Entry Form -->
            <div>
                <h3 class="section-title">
                    <i class="fas fa-plus-circle"></i> Add Milk Collection Entry
                </h3>

                <form id="milkcollection_entryForm">
                    <div class="form-controls">
                        <input type="text" id="milkcollection_farmer" class="form-control" placeholder="Farmer Name"
                            required>
                        <input type="number" id="milkcollection_qty" class="form-control" placeholder="Qty (L)" min="0"
                            required>
                        <input type="number" id="milkcollection_fat" class="form-control" placeholder="Fat %" min="0"
                            max="10" step="0.1" required>
                        <input type="number" id="milkcollection_snf" class="form-control" placeholder="SNF %" min="0"
                            max="10" step="0.1" required>
                        <input type="number" id="milkcollection_rate" class="form-control" placeholder="Rate â‚¹/L"
                            min="0" required>
                        <input type="datetime-local" id="milkcollection_datetime" class="form-control" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i> Add Entry
                        </button>
                        <button type="reset" class="btn btn-outline">
                            <i class="fas fa-times"></i> Reset Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- Export Buttons -->
            <div class="section-actions" style="display: flex; justify-content: flex-end; gap: 15px;">
                <button id="milkcollection_excelBtn" class="btn btn-outline" style="padding: 0px 20px;">
                    <i class="fas fa-file-excel"></i> Export to Excel
                </button>
                <button id="milkcollection_pdfBtn" class="btn btn-outline">
                    <i class="fas fa-file-pdf"></i> Export to PDF
                </button>
            </div>

            <!-- Data Table -->
            <div>
                <h3 class="section-title">
                    <i class="fas fa-table"></i> Milk Collection Records
                </h3>

                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Farmer</th>
                            <th>Date</th>
                            <th>Qty (L)</th>
                            <th>Fat %</th>
                            <th>SNF %</th>
                            <th>Rate</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="milkcollection_dataTableBody"></tbody>
                </table>
            </div>

            <!-- Charts Section -->
            <div>
                <h3 class="section-title">
                    <i class="fas fa-chart-bar"></i> Milk Collection Analytics
                </h3>

                <div class="charts-container">
                    <div class="chart-box">
                        <div class="chart-title">
                            <i class="fas fa-chart-line"></i> Daily Milk Collection
                        </div>
                        <div id="milkcollection_dailyMilkChart" class="chart-canvas"
                            style="width: 100%; height: 300px;"></div>
                    </div>

                    <div class="chart-box">
                        <div class="chart-title">
                            <i class="fas fa-chart-bar"></i> Farmer-wise Fat & SNF %
                        </div>
                        <div id="milkcollection_fatSNFChart" class="chart-canvas" style="width: 100%; height: 300px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div>
                <h3 class="section-title">
                    <i class="fas fa-history"></i> Recent Activity
                </h3>

                <ul id="milkcollection_recentActivity" class="activity-log">
                    <li><i class="fas fa-info-circle"></i> Dashboard initialized with sample data</li>
                </ul>
            </div>

            <!-- View/Edit Modal -->
            <div id="milkcollection_modal" class="modal">
                <div class="modal-content">
                    <button id="milkcollection_closeModalBtn" class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>

                    <h3 id="milkcollection_modalTitle" class="modal-title">
                        <i class="fas fa-edit"></i> View/Edit Entry
                    </h3>

                    <form id="milkcollection_modalForm">
                        <input type="hidden" id="milkcollection_editId">

                        <div class="form-group">
                            <label for="milkcollection_editFarmer">Farmer Name</label>
                            <input type="text" id="milkcollection_editFarmer" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="milkcollection_editQty">Quantity (Liters)</label>
                            <input type="number" id="milkcollection_editQty" class="form-control" required min="0">
                        </div>

                        <div class="form-group">
                            <label for="milkcollection_editFat">Fat %</label>
                            <input type="number" id="milkcollection_editFat" class="form-control" required min="0"
                                max="10" step="0.1">
                        </div>

                        <div class="form-group">
                            <label for="milkcollection_editSNF">SNF %</label>
                            <input type="number" id="milkcollection_editSNF" class="form-control" required min="0"
                                max="10" step="0.1">
                        </div>

                        <div class="form-group">
                            <label for="milkcollection_editRate">Rate (â‚¹/L)</label>
                            <input type="number" id="milkcollection_editRate" class="form-control" required min="0">
                        </div>

                        <div class="form-group">
                            <label for="milkcollection_editDate">Date & Time</label>
                            <input type="datetime-local" id="milkcollection_editDate" class="form-control" required>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Update Entry
                            </button>
                            <button type="reset" class="btn btn-outline">
                                <i class="fas fa-times"></i> Reset
                            </button>
                            <button type="button" class="btn btn-outline" id="milkcollection_cancelModalBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="section fade-in" id="chilling">

            <!-- Banner -->
            <div class="banner fade-in">
                <i class="fas fa-snowflake"></i> Chilling Centers Management
            </div>

            <!-- Summary Cards -->
            <div class="card-grid">
                <!-- Total Centers - Blue -->
                <div class="card card-blue">
                    <div class="card-header">
                        <div class="card-title">Total Centers</div>
                        <div class="card-icon"><i class="fas fa-building"></i></div>
                    </div>
                    <div class="card-value" id="chilling_summary_totalCenters">0</div>
                    <div class="card-change">Facilities</div>
                </div>

                <!-- Avg. Temperature - Orange -->
                <div class="card card-orange">
                    <div class="card-header">
                        <div class="card-title">Avg. Temperature</div>
                        <div class="card-icon"><i class="fas fa-thermometer-half"></i></div>
                    </div>
                    <div class="card-value" id="chilling_summary_avgTemp">0Â°C</div>
                    <div class="card-change">Daily Average</div>
                </div>

                <!-- Total Capacity - Teal -->
                <div class="card card-teal">
                    <div class="card-header">
                        <div class="card-title">Total Capacity</div>
                        <div class="card-icon"><i class="fas fa-tint"></i></div>
                    </div>
                    <div class="card-value" id="chilling_summary_totalCapacity">0 L</div>
                    <div class="card-change">Installed</div>
                </div>

                <!-- Current Capacity - Violet -->
                <div class="card card-purple">
                    <div class="card-header">
                        <div class="card-title">Current Capacity</div>
                        <div class="card-icon"><i class="fas fa-tint"></i></div>
                    </div>
                    <div class="card-value" id="chilling_summary_currentCapacity">0 L</div>
                    <div class="card-change">Live Status</div>
                </div>

                <!-- Energy Utilization - Amber -->
                <div class="card card-yellow">
                    <div class="card-header">
                        <div class="card-title">Energy Utilization</div>
                        <div class="card-icon"><i class="fas fa-solar-panel"></i></div>
                    </div>
                    <div class="card-value" id="chilling_summary_energyMix">0% Solar</div>
                    <div class="card-change">Renewables Share</div>
                </div>
            </div>


            <!-- Form Container -->
            <div class="profile-form" id="chilling_formContainer" style="display:none;">
                <h3 id="chilling_formTitle"><i class="fa-plus-circle fas"></i> Add New Chilling Center</h3>
                <form class="settings-grid" id="chilling_entryForm">
                    <input id="chilling_editId" type="hidden" />
                    <div class="form-group">
                        <label for="chilling_centerName">Center Name</label>
                        <input class="form-control" id="chilling_centerName" required type="text" />
                        <div class="error-message" id="chilling_nameError">Center name must be at least 2 characters
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_location">Location</label>
                        <input class="form-control" id="chilling_location" required type="text" />
                        <div class="error-message" id="chilling_locationError">Location must be at least 2
                            characters</div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_totalCapacity">Total Capacity (L)</label>
                        <input class="form-control" id="chilling_totalCapacity" min="1000" required type="number"
                            value="1000" />
                        <div class="error-message" id="chilling_totalCapacityError">Capacity must be at least 1,000
                            L</div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_currentCapacity">Current Capacity (L)</label>
                        <input class="form-control" id="chilling_currentCapacity" min="0" required type="number"
                            value="0" />
                        <div class="error-message" id="chilling_currentCapacityError">Current capacity cannot exceed
                            total capacity</div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_temperature">Temperature (Â°C)</label>
                        <input class="form-control" id="chilling_temperature" required step="0.1" type="number"
                            value="4.0" />
                        <div class="error-message" id="chilling_temperatureError">Temperature must be between 0Â°C
                            and 10Â°C</div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_status">Status</label>
                        <select class="form-control" id="chilling_status" required>
                            <option value="">Select Status</option>
                            <option selected value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="Maintenance">Maintenance</option>
                        </select>
                        <div class="error-message" id="chilling_statusError">Please select a status</div>
                    </div>
                    <div class="form-group">
                        <label for="chilling_energyType">Energy Source</label>
                        <select class="form-control" id="chilling_energyType" required>
                            <option value="">Select Energy Source</option>
                            <option value="Grid Power">Grid Power</option>
                            <option selected value="Solar">Solar</option>
                            <option value="Generator">Generator</option>
                            <option value="Battery">Battery</option>
                        </select>
                        <div class="error-message" id="chilling_energyTypeError">Please select an energy source
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-outline" id="chilling_cancelBtn" type="button">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button class="btn btn-success" id="chilling_submitBtn" type="submit">
                            <i class="fa-plus fas"></i> Add Center
                        </button>
                    </div>
                </form>
            </div>

            <!-- Search and Filter -->
            <div class="data-section">
                <div class="section-header"
                    style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                    <h3 class="section-title" style="margin: 0; font-size: 24px;">
                        <i class="fas fa-list"></i> Chilling Centers
                    </h3>

                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="search-container" style="flex: 1;">
                            <input class="form-control" id="chilling_searchInput" placeholder="Search by any field..."
                                type="text" style="width: 100%; max-width: 400px;" />
                        </div>

                        <div class="section-actions" style="margin-left: 10px;">
                            <button class="btn btn-primary" id="chilling_addCenterBtn">
                                <i class="fa-plus fas"></i> Add New Center
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <table class="custom-table" id="chilling_dataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Center Name</th>
                            <th>Location</th>
                            <th>Capacity (L)</th>
                            <th>Temp (Â°C)</th>
                            <th>Status</th>
                            <th>Energy Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="chilling_tableBody"></tbody>
                </table>
            </div>

            <!-- Charts Section -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title"><i class="fa-chart-line fas"></i> Performance Dashboard</h3>
                </div>
                <div class="chart-grid">
                    <div class="chart-wrapper" id="chilling_temperatureChart"></div>
                    <div class="chart-wrapper" id="chilling_capacityChart"></div>
                    <div class="chart-wrapper" id="chilling_energyChart"></div>
                    <div class="chart-wrapper" id="chilling_tempPerformanceChart"></div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-section">
                <div class="section-header">
                    <h3 class="section-title"><i class="fa-history fas"></i> Recent Activity</h3>
                </div>
                <div id="chilling_activityContainer">
                    <!-- Activity items will be added here -->
                </div>
            </div>

        </div>

        <div class="section fade-in" id="processing">
            <div class="banner">
                <i class="fas fa-industry"></i> Processing Plant Management
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card-summary total card-indigo">
                    <div class="card-header">
                        <div class="card-title">Total Plants</div>
                        <div class="card-icon">
                            <i class="fas fa-industry"></i>
                        </div>
                    </div>
                    <div class="card-value" id="processingplants_TotalPlants">0</div>
                    <div class="card-subtitle">Across all locations</div>
                </div>

                <div class="card-summary capacity card-orange">
                    <div class="card-header">
                        <div class="card-title">Total Capacity</div>
                        <div class="card-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                    </div>
                    <div class="card-value" id="processingplants_TotalCapacity">0 L</div>
                    <div class="card-subtitle">Combined processing capacity</div>
                </div>

                <div class="card-summary active card-orange">
                    <div class="card-header">
                        <div class="card-title">Active Plants</div>
                        <div class="card-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                    </div>
                    <div class="card-value" id="processingplants_ActivePlants">0</div>
                    <div class="card-subtitle">Currently operational</div>
                </div>

                <div class="card-summary products card-green">
                    <div class="card-header">
                        <div class="card-title">Total Products</div>
                        <div class="card-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                    </div>
                    <div class="card-value" id="processingplants_TotalProducts">0</div>
                    <div class="card-subtitle">Different dairy products</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Search Plant</label>
                    <input type="text" class="filter-input" id="processingplants_Search"
                        placeholder="Enter plant name...">
                </div>

                <div class="filter-group">
                    <label class="filter-label">Filter by Status</label>
                    <select class="filter-input" id="processingplants_StatusFilter">
                        <option value="">All Statuses</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Maintenance">Maintenance</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-input" id="processingplants_SortBy">
                        <option value="name">Plant Name</option>
                        <option value="capacity">Capacity</option>
                        <option value="date">Recently Added</option>
                    </select>
                </div>
            </div>

            <!-- View Controls -->
            <div class="view-controls">
                <div class="view-buttons">
                    <button class="view-btn active" onclick="processingplants_toggleView('cards')">
                        <i class="fas fa-th-large"></i> Card View
                    </button>
                    <button class="view-btn" onclick="processingplants_toggleView('table')">
                        <i class="fas fa-table"></i> Table View
                    </button>
                </div>
                <button class="btn btn-outline" onclick="processingplants_openModal()">
                    <i class="fas fa-plus"></i> Add Plant
                </button>
            </div>

            <!-- Card View -->
            <div id="processingplants_CardView" class="card-gridd"></div>

            <!-- Table View -->
            <div id="processingplants_TableView" style="display: none">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>Plant</th>
                            <th>Location</th>
                            <th>Capacity (L)</th>
                            <th>Utilization</th>
                            <th>Status</th>
                            <th>Manager</th>
                            <th>Products</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="processingplants_TableBody"></tbody>
                </table>
            </div>

            <!-- Charts Section -->
            <div class="chart-box">
                <div class="chart-header">
                    <h2 class="chart-title">
                        <i class="fas fa-chart-bar"></i> Plant-wise Stacked Products
                    </h2>
                    <div class="chart-actions">
                        <button class="btn btn-outline" onclick="processingplants_toggleChartType()">
                            <i class="fas fa-exchange-alt"></i> Toggle View
                        </button>
                    </div>
                </div>
                <div class="chart-canvas">
                    <canvas id="processingplants_StackedBarChart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-log">
                <h2 class="section-title">
                    <i class="fas fa-history"></i> Recent Processing Activities
                </h2>
                <div class="activity-list" id="processingplants_ActivityLogs"></div>
            </div>

            <!-- Modal Form -->
            <div id="processingplants_Modal" class="modal">
                <div class="modal-content">
                    <button class="modal-close" onclick="processingplants_closeModal()">&times;</button>
                    <h2 class="modal-title" id="processingplants_ModalTitle">
                        <i class="fas fa-industry"></i> Add Processing Plant
                    </h2>
                    <div class="modal-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Plant Name <span class="required">*</span></label>
                                <input type="text" id="processingplants_PlantName" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Location <span class="required">*</span></label>
                                <input type="text" id="processingplants_PlantLocation" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Capacity (L) <span class="required">*</span></label>
                                <input type="number" id="processingplants_PlantCapacity" class="form-control" min="1000"
                                    max="1000000" required>
                                <small class="form-text">Min: 1,000L - Max: 1,000,000L</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Status <span class="required">*</span></label>
                                <select id="processingplants_PlantStatus" class="form-control" required>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Maintenance">Maintenance</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Manager <span class="required">*</span></label>
                                <input type="text" id="processingplants_PlantManager" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Established Date <span class="required">*</span></label>
                                <input type="date" id="processingplants_PlantDate" class="form-control" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Products <span class="required">*</span></label>
                            <div id="processingplants_ProductInputs">
                                <div class="product-row">
                                    <select class="form-control productName">
                                        <option value="">Select Product</option>
                                        <option value="Milk">Milk</option>
                                        <option value="Cheese">Cheese</option>
                                        <option value="Butter">Butter</option>
                                        <option value="Ice Cream">Ice Cream</option>
                                        <option value="Yogurt">Yogurt</option>
                                        <option value="Ghee">Ghee</option>
                                        <option value="Paneer">Paneer</option>
                                        <option value="Cream">Cream</option>
                                        <option value="Milk Powder">Milk Powder</option>
                                        <option value="Condensed Milk">Condensed Milk</option>
                                    </select>
                                    <input type="number" class="form-control productQty" min="0" placeholder="Liters">
                                    <button class="action-btn delete" onclick="processingplants_removeProduct(this)">
                                        <i class="fas fa-trash action-btn delete"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="btn-add" onclick="processingplants_addProduct()">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                            <div id="processingplants_CapacityWarning" class="alert alert-danger"
                                style="display: none;">
                                Total products exceed plant capacity!
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-outline" onclick="processingplants_closeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="processingplants_savePlant()">Save
                                Plant</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="section fade-in" id="inventory">
            <div class="banner"><i class="fas fa-warehouse"></i> Inventory Management</div>

            <!-- Stats Cards -->
            <div class="card-grid">
                <div class="card card-green">
                    <div class="card-header">
                        <div class="card-title">Total Products</div>
                        <div class="card-icon"><i class="fas fa-box"></i></div>
                    </div>
                    <div class="card-value" id="inventory_totalProducts">0</div>
                </div>

                <div class="card card-blue">
                    <div class="card-header">
                        <div class="card-title">Total Stock</div>
                        <div class="card-icon"><i class="fas fa-weight-hanging"></i></div>
                    </div>
                    <div class="card-value" id="inventory_totalStock">0 kg</div>
                </div>

                <div class="card card-purple">
                    <div class="card-header">
                        <div class="card-title">Inventory Value</div>
                        <div class="card-icon"><i class="fas fa-rupee-sign"></i></div>
                    </div>
                    <div class="card-value" id="inventory_inventoryValue">â‚¹0</div>
                </div>

                <div class="card card-orange">
                    <div class="card-header">
                        <div class="card-title">Low Stock Items</div>
                        <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    </div>
                    <div class="card-value" id="inventory_lowStockItems">0</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-containerr">
                <div class="chart-box">
                    <div class="chart-title"><i class="fas fa-chart-pie"></i> Stock Distribution by Category</div>
                    <div class="chart-canvas">
                        <canvas id="inventory_categoryChart"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-title"><i class="fas fa-chart-bar"></i> Inventory Value by Product</div>
                    <div class="chart-canvas">
                        <canvas id="inventory_valueChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tabs Section -->
            <div class="tabs-container">
                <div class="tabs-header">
                    <button class="tab-btn active" data-tab="filters">Filters</button>
                    <button class="tab-btn" data-tab="import-export">Import/Export</button>
                    <button class="tab-btn" data-tab="reports">Reports</button>
                </div>

                <!-- Filters Tab -->
                <div class="tab-content active" id="filters-tab">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label class="filter-label"><i class="fas fa-filter"></i> Product Category</label>
                            <select class="form-control" id="inventory_categoryFilter">
                                <option value="">All Categories</option>
                                <option value="Milk">Milk</option>
                                <option value="Paneer">Paneer</option>
                                <option value="Ghee">Ghee</option>
                                <option value="Curd">Curd</option>
                                <option value="Butter">Butter</option>
                                <option value="Cheese">Cheese</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label"><i class="fas fa-box-open"></i> Stock Status</label>
                            <select class="form-control" id="inventory_statusFilter">
                                <option value="">All Status</option>
                                <option value="in-stock">In Stock</option>
                                <option value="low-stock">Low Stock</option>
                                <option value="out-of-stock">Out of Stock</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label"><i class="fas fa-calendar-times"></i> Expiry Status</label>
                            <select class="form-control" id="inventory_expiryFilter">
                                <option value="">All Expiry Status</option>
                                <option value="expired">Expired Products</option>
                                <option value="7">Expiring in 7 Days</option>
                                <option value="15">Expiring in 15 Days</option>
                                <option value="30">Expiring in 30 Days</option>
                                <option value="safe">Not Expired</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label"><i class="fas fa-industry"></i> Supplier</label>
                            <select class="form-control" id="inventory_supplierFilter">
                                <option value="">All Suppliers</option>
                                <option value="Amul">Amul</option>
                                <option value="Mother Dairy">Mother Dairy</option>
                                <option value="Nestle">Nestle</option>
                                <option value="Local Farm">Local Farm</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary" id="inventory_applyFilters">
                            <i class="fas fa-check"></i> Apply Filters
                        </button>
                        <button class="btn btn-outline" id="inventory_resetFilters">
                            <i class="fas fa-sync"></i> Reset Filters
                        </button>
                    </div>
                </div>

                <!-- Import/Export Tab -->
                <div class="tab-content" id="import-export-tab">
                    <div class="filter-group">
                        <label class="filter-label"><i class="fas fa-file-import"></i> Import Products</label>
                        <p>Upload a CSV file to import products into the inventory</p>
                        <div class="form-actions">
                            <button class="btn btn-success">
                                <i class="fas fa-file-csv"></i> Download Template
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-upload"></i> Upload CSV File
                            </button>
                        </div>
                    </div>

                    <div class="filter-group" style="margin-top: 25px;">
                        <label class="filter-label"><i class="fas fa-file-export"></i> Export Products</label>
                        <p>Export current inventory to CSV format</p>
                        <div class="form-actions">
                            <button class="btn btn-primary">
                                <i class="fas fa-download"></i> Export to CSV
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-print"></i> Print Inventory
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-content" id="reports-tab">
                    <div class="filter-group">
                        <label class="filter-label"><i class="fas fa-chart-line"></i> Generate Reports</label>
                        <p>Select report type and date range</p>

                        <div class="filters-grid">
                            <div class="filter-group">
                                <label>Report Type</label>
                                <select class="form-control">
                                    <option>Stock Summary</option>
                                    <option>Expiry Report</option>
                                    <option>Low Stock Alert</option>
                                    <option>Sales Report</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label>Date Range</label>
                                <select class="form-control">
                                    <option>Last 7 Days</option>
                                    <option>Last 30 Days</option>
                                    <option>Last Quarter</option>
                                    <option>Custom Range</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions" style="margin-top: 25px;">
                            <button class="btn btn-primary">
                                <i class="fas fa-download"></i> Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table Section -->
            <div>
                <div class="view-controls" style="margin-bottom: 10px;">
                    <div class="section-title" style="font-size: 24px; margin-bottom: 10px;">
                        <i class="fas fa-list"></i> Dairy Products Inventory
                    </div>
                </div>

                <div class="form-controls" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <div class="search-box" style="flex: 1;">
                        <input type="text" class="form-control" id="inventory_searchInput"
                            placeholder="Search products..." style="width: 100%; max-width: 400px;">
                    </div>

                    <button class="btn btn-primary" id="inventory_addProductBtn" style="margin-left: 10px;">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>


                <div class="table-container">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Quantity (kg)</th>
                                <th>Price (â‚¹)</th>
                                <th>Value (â‚¹)</th>
                                <th>Manufacture Date</th>
                                <th>Expiry Date</th>
                                <th>Stock Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory_inventoryBody">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-log">
                <h4><i class="fas fa-history"></i> Recent Activity</h4>
                <ul class="activity-list" id="inventory_activityList">
                    <!-- Activity items will be populated by JavaScript -->
                </ul>
            </div>


            <!-- Add/Edit Product Modal -->
            <div class="modal" id="inventory_productModal">
                <div class="modal-content">
                    <button class="modal-close" id="inventory_closeModal">&times;</button>
                    <div class="modal-title" id="inventory_modalTitle"><i class="fas fa-cube"></i> Add New Product</div>
                    <div class="modal-body">
                        <form id="inventory_productForm">
                            <input type="hidden" id="inventory_productId">

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inventory_productName" class="required">Product Name</label>
                                    <input type="text" class="form-control" id="inventory_productName" required>
                                </div>
                                <div class="form-group">
                                    <label for="inventory_productCategory" class="required">Category</label>
                                    <select class="form-control" id="inventory_productCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="Milk">Milk</option>
                                        <option value="Paneer">Paneer</option>
                                        <option value="Ghee">Ghee</option>
                                        <option value="Curd">Curd</option>
                                        <option value="Butter">Butter</option>
                                        <option value="Cheese">Cheese</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inventory_quantity" class="required">Quantity (kg)</label>
                                    <input type="number" class="form-control" id="inventory_quantity" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="inventory_price" class="required">Price (â‚¹ per kg)</label>
                                    <input type="number" class="form-control" id="inventory_price" min="0" step="0.01"
                                        required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inventory_manufactureDate" class="required">Manufacture Date</label>
                                    <input type="date" class="form-control" id="inventory_manufactureDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="inventory_expiryDate" class="required">Expiry Date</label>
                                    <input type="date" class="form-control" id="inventory_expiryDate" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="inventory_supplier">Supplier</label>
                                <input type="text" class="form-control" id="inventory_supplier">
                            </div>
                        </form>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-outline" id="inventory_cancelBtn">Cancel</button>
                        <button class="btn btn-primary" id="inventory_saveProductBtn">Save Product</button>
                    </div>
                </div>
            </div>

            <!-- Toast Container -->
            <div class="toast-container" id="inventory_toastContainer"></div>

        </div>

        <div class="section fade-in" id="logistics">
            <div class="banner">
                <i class="fas fa-truck"></i>
                Distribution & Logistics Dashboard
            </div>

            <!-- Delivery Summary Cards -->
            <div class="card-grid">
                <!-- Total Deliveries - Blue -->
                <div class="card card-blue">
                    <div class="card-header">
                        <div class="card-title">Total Deliveries</div>
                        <div class="card-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dandl_total_deliveries">0</div>
                    <div class="card-change">
                        <i class="fas fa-arrow-up"></i>
                        <span id="dandl_deliveries_change">0%</span> from last month
                    </div>
                </div>

                <!-- On-time Delivery Rate - Green -->
                <div class="card card-green">
                    <div class="card-header">
                        <div class="card-title">On-time Delivery Rate</div>
                        <div class="card-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dandl_on_time_rate">0%</div>
                    <div class="card-change">
                        <i class="fas fa-arrow-up"></i>
                        <span id="dandl_on_time_change">0%</span> from last month
                    </div>
                </div>

                <!-- Avg. Delivery Time - Amber -->
                <div class="card card-orange">
                    <div class="card-header">
                        <div class="card-title">Avg. Delivery Time</div>
                        <div class="card-icon">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dandl_avg_delivery_time">0 hrs</div>
                    <div class="card-change down">
                        <i class="fas fa-arrow-down"></i>
                        <span id="dandl_delivery_time_change">0 hrs</span> from last month
                    </div>
                </div>

                <!-- Fuel Efficiency - Purple -->
                <div class="card card-purple">
                    <div class="card-header">
                        <div class="card-title">Fuel Efficiency</div>
                        <div class="card-icon">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dandl_fuel_efficiency">0 km/L</div>
                    <div class="card-change">
                        <i class="fas fa-arrow-up"></i>
                        <span id="dandl_fuel_change">0 km/L</span> from last month
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-container">
                <div class="chart-box">
                    <div class="chart-header">
                        <h4 class="chart-title">Delivery Volume by Product</h4>
                        <select id="dandl_time_filter" class="form-control">
                            <option value="7">Last 7 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dandl_deliveryVolumeChart"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-header">
                        <h4 class="chart-title">Delivery Status Distribution</h4>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dandl_statusDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- New Charts -->
            <div class="charts-container">
                <div class="chart-box">
                    <div class="chart-header">
                        <h4 class="chart-title">Regional Delivery Performance</h4>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dandl_regionPerformanceChart"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-header">
                        <h4 class="chart-title">Delivery Time Analysis</h4>
                        <select id="dandl_region_filter" class="form-control">
                            <option value="">All Regions</option>
                            <option>Hyderabad</option>
                            <option>Vijayawada</option>
                            <option>Guntur</option>
                            <option>Visakhapatnam</option>
                            <option>Nellore</option>
                        </select>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dandl_deliveryTimeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Delivery Table -->
            <div>
                <div class="section-header"
                    style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                    <div class="section-title" style="font-size: 24px; margin-bottom: 5px;">
                        <i class="fas fa-clipboard-list"></i>
                        Delivery Management
                    </div>

                    <div class="form-controls" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <input type="text" class="form-control" id="dandl_search_input" placeholder="Search..."
                            style="width: 100%; max-width: 200px;">

                        <select class="form-control" id="dandl_status_filter" style="max-width: 160px; width: 100%;">
                            <option value="">All Status</option>
                            <option>Pending</option>
                            <option>In Transit</option>
                            <option>Delivered</option>
                            <option>Cancelled</option>
                        </select>

                        <select class="form-control" id="dandl_region_table_filter"
                            style="max-width: 180px; width: 100%;">
                            <option value="">All Regions</option>
                            <option>Hyderabad</option>
                            <option>Vijayawada</option>
                            <option>Guntur</option>
                            <option>Visakhapatnam</option>
                            <option>Nellore</option>
                        </select>

                        <button class="btn btn-primary" id="dandl_add_delivery_btn" style="margin-left: 10px;">
                            <i class="fas fa-plus"></i> Add Delivery
                        </button>
                    </div>
                </div>

                <table class="custom-table" id="dandl_deliveries_table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Date</th>
                            <th>Address</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dandl_deliveries_table_body"></tbody>
                </table>
            </div>


            <!-- Delivery Modal -->
            <div class="modal" id="dandl_delivery_modal">
                <div class="modal-content">
                    <button class="modal-close">&times;</button>
                    <h3 class="modal-title" id="dandl_modal_title">Add New Delivery</h3>
                    <form id="dandl_delivery_form">
                        <input type="hidden" id="dandl_edit_id">

                        <div class="form-group">
                            <label for="dandl_customer">Customer</label>
                            <input type="text" id="dandl_customer" class="form-control">
                            <div class="error" id="dandl_customer_error">Customer name is required</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_product">Product</label>
                            <select id="dandl_product" class="form-control">
                                <option value="">Select Product</option>
                                <option>Full Cream Milk</option>
                                <option>Toned Milk</option>
                                <option>Paneer</option>
                                <option>Butter</option>
                                <option>Ghee</option>
                                <option>Yogurt</option>
                            </select>
                            <div class="error" id="dandl_product_error">Please select a product</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_quantity">Quantity</label>
                            <input type="text" id="dandl_quantity" class="form-control">
                            <div class="error" id="dandl_quantity_error">Please enter a valid quantity (e.g., 500L or
                                80kg)</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_date">Delivery Date</label>
                            <input type="date" id="dandl_date" class="form-control">
                            <div class="error" id="dandl_date_error">Please select a valid date</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_address">Address</label>
                            <input type="text" id="dandl_address" class="form-control">
                            <div class="error" id="dandl_address_error">Address is required</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_amount">Amount (â‚¹)</label>
                            <input type="number" id="dandl_amount" class="form-control" min="1">
                            <div class="error" id="dandl_amount_error">Please enter a valid amount</div>
                        </div>

                        <div class="form-group">
                            <label for="dandl_status">Status</label>
                            <select id="dandl_status" class="form-control">
                                <option value="Pending">Pending</option>
                                <option value="In Transit">In Transit</option>
                                <option value="Delivered">Delivered</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">Save Delivery</button>
                            <button type="button" class="btn btn-outline" id="dandl_cancel_btn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="section fade-in" id="retail">
            <div class="banner">
                <i class="fas fa-store"></i> Retail & Franchise Management Hub
            </div>

            <div class="card-grid" id="randf_dashboard_kpis"></div>

            <div class="section-title">
                <i class="fas fa-map-marked-alt"></i>
                <span>Zone Distribution</span>
            </div>
            <div class="card-grid" id="randf_region_blocks"></div>

            <div class="section-title">
                <i class="fas fa-filter"></i>
                <span>Search & Filters</span>
            </div>
            <div class="section-header">
                <input type="text" id="randf_search_input" placeholder="Search by name, owner or phone"
                    class="form-control" />
                <select id="randf_filter_type" class="form-control">
                    <option value="all">All Types</option>
                    <option value="retail">Retail</option>
                    <option value="franchise">Franchise</option>
                </select>
                <select id="randf_filter_zone" class="form-control">
                    <option value="all">All Zones</option>
                    <option value="north">North</option>
                    <option value="south">South</option>
                    <option value="east">East</option>
                    <option value="west">West</option>
                </select>
                <select id="randf_filter_status" class="form-control">
                    <option value="all">All Status</option>
                    <option value="setup">Setup</option>
                    <option value="pending">Pending</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
                <button id="randf_open_add_modal" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Outlet
                </button>
                <div class="section-actions">
                    <button id="randf_toggle_card" class="btn btn-outline active">
                        <i class="fas fa-th-large"></i> Card View
                    </button>
                    <button id="randf_toggle_table" class="btn btn-outline">
                        <i class="fas fa-table"></i> Table View
                    </button>
                </div>
            </div>

            <div id="randf_outlet_card_list" class="card-grid"></div>

            <div id="randf_outlet_table_container" class="data-section" style="display:none;">
                <div class="section-title">
                    <i class="fas fa-table"></i>
                    <span>Outlet Table</span>
                </div>
                <table class="custom-table" id="randf_outlet_table">
                    <thead>
                        <tr>
                            <th>Outlet Name</th>
                            <th>Type</th>
                            <th>Zone</th>
                            <th>Owner</th>
                            <th>Status</th>
                            <th>Rating</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="section-title">
                <i class="fas fa-history"></i>
                <span>Recent Activity</span>
                <button id="randf_clear_activity" class="clear-btn">
                    <i class="fas fa-trash-alt"></i> Clear
                </button>
            </div>
            <ul class="activity-feed" id="randf_activity_feed"></ul>

            <div class="section-title">
                <i class="fas fa-project-diagram"></i>
                <span>Setup Pipeline</span>
            </div>
            <div class="card-grid" id="randf_pipeline_board"></div>

            <div class="section-title">
                <i class="fas fa-map"></i>
                <span>Outlet Map View (India)</span>
            </div>
            <div class="map-container">
                <iframe id="randf_full_map" width="100%" height="400" loading="lazy" allowfullscreen
                    referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            <!-- Add Outlet Modal -->
            <div class="modal" id="randf_add_outlet_modal">
                <div class="modal-content">
                    <button class="modal-close" id="randf_close_add_modal">&times;</button>
                    <div class="modal-title">
                        <i class="fas fa-store"></i>
                        <span id="randf_modal_title_text">Add New Outlet</span>
                    </div>
                    <form id="randf_add_outlet_form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Outlet Name <span class="required">*</span></label>
                                <input type="text" name="name" placeholder="Outlet Name" class="form-control"
                                    required />
                                <div class="form-error" id="name-error">Please enter a valid outlet name</div>
                            </div>

                            <div class="form-group">
                                <label>Type <span class="required">*</span></label>
                                <select name="type" class="form-control" required>
                                    <option value="">Select Outlet Type</option>
                                    <option value="retail">Retail</option>
                                    <option value="franchise">Franchise</option>
                                </select>
                                <div class="form-error" id="type-error">Please select outlet type</div>
                            </div>

                            <div class="form-group">
                                <label>Zone <span class="required">*</span></label>
                                <select name="zone" class="form-control" required>
                                    <option value="">Select Zone</option>
                                    <option value="north">North</option>
                                    <option value="south">South</option>
                                    <option value="east">East</option>
                                    <option value="west">West</option>
                                </select>
                                <div class="form-error" id="zone-error">Please select a zone</div>
                            </div>

                            <div class="form-group">
                                <label>Owner <span class="required">*</span></label>
                                <input type="text" name="owner" placeholder="Owner Name" class="form-control"
                                    required />
                                <div class="form-error" id="owner-error">Please enter owner name</div>
                            </div>

                            <div class="form-group">
                                <label>Contact <span class="required">*</span></label>
                                <input type="tel" name="contact" placeholder="Contact Number" class="form-control"
                                    required pattern="[0-9]{10}" title="Please enter a 10-digit phone number" />
                                <div class="form-error" id="contact-error">Please enter a valid 10-digit phone
                                    number
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Status <span class="required">*</span></label>
                                <select name="status" class="form-control" required>
                                    <option value="">Select Status</option>
                                    <option value="setup">Setup</option>
                                    <option value="pending">Pending</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <div class="form-error" id="status-error">Please select a status</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="rating">Rating (1-5) <span class="required">*</span></label>
                            <input type="range" name="rating" min="1" max="5" step="0.5" value="3" class="form-control"
                                id="randf_rating_slider" required />
                            <div class="rating-display" id="randf_rating_display">3.0 â­</div>
                            <div class="form-error" id="rating-error">Please set a rating between 1 and 5</div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Monthly Revenue (â‚¹) <span class="required">*</span></label>
                                <input type="number" name="revenue" placeholder="Monthly Revenue" class="form-control"
                                    required min="0" />
                                <div class="form-error" id="revenue-error">Please enter a valid revenue amount</div>
                            </div>

                            <div class="form-group">
                                <label>Monthly Expenses (â‚¹) <span class="required">*</span></label>
                                <input type="number" name="expenses" placeholder="Monthly Expenses" class="form-control"
                                    required min="0" />
                                <div class="form-error" id="expenses-error">Please enter a valid expenses amount
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Latitude <span class="required">*</span></label>
                                <input type="number" name="latitude" step="0.0001" placeholder="Latitude"
                                    class="form-control" required min="-90" max="90" />
                                <div class="form-error" id="latitude-error">Please enter a valid latitude (-90 to
                                    90)
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Longitude <span class="required">*</span></label>
                                <input type="number" name="longitude" step="0.0001" placeholder="Longitude"
                                    class="form-control" required min="-180" max="180" />
                                <div class="form-error" id="longitude-error">Please enter a valid longitude (-180 to
                                    180)</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Location Preview</label>
                            <div class="map-preview" id="randf_map_preview">
                                <div class="map-pin"></div>
                                <div class="map-overlay">Location will appear here</div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save
                            </button>
                            <button type="button" class="btn btn-outline" id="randf_close_modal">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Info Modal -->
            <div class="modal" id="randf_info_modal">
                <div class="modal-content">
                    <button class="modal-close" id="randf_close_info_modal">&times;</button>
                    <div class="modal-title">
                        <i class="fas fa-info-circle"></i>
                        <span>Outlet Details</span>
                    </div>
                    <div id="randf_info_details"></div>
                    <div class="map-container" style="margin: 20px; border-radius: 12px;">
                        <iframe id="randf_info_map" width="100%" height="250" loading="lazy" allowfullscreen></iframe>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-outline" id="randf_close_info">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <div class="section fade-in" id="customers-section">

            <div class="banner"><i class="fas fa-users"></i> Customers</div>

            <!-- Stats Cards -->
            <div class="card-grid">
                <div class="card card-green">
                    <div class="card-header">
                        <div class="card-title">Total Customers</div>
                        <div class="card-icon"><i class="fas fa-users"></i></div>
                    </div>
                    <div class="card-value" id="customers_totalCustomers">0</div>
                </div>

                <div class="card card-blue">
                    <div class="card-header">
                        <div class="card-title">Active Orders</div>
                        <div class="card-icon"><i class="fas fa-shopping-cart"></i></div>
                    </div>
                    <div class="card-value" id="customers_activeOrders">0</div>
                </div>

                <div class="card card-purple">
                    <div class="card-header">
                        <div class="card-title">Total Sales</div>
                        <div class="card-icon"><i class="fas fa-rupee-sign"></i></div>
                    </div>
                    <div class="card-value" id="customers_totalSales">â‚¹0</div>
                </div>

                <div class="card card-orange">
                    <div class="card-header">
                        <div class="card-title">Pending Payments</div>
                        <div class="card-icon"><i class="fas fa-clock"></i></div>
                    </div>
                    <div class="card-value" id="customers_pendingPayments">â‚¹0</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-containerr">
                <div class="chart-box">
                    <div class="chart-title"><i class="fas fa-chart-pie"></i> Product Sales Distribution</div>
                    <div class="chart-canvas">
                        <canvas id="customers_productChart"></canvas>
                    </div>
                </div>

                <div class="chart-box">
                    <div class="chart-title"><i class="fas fa-chart-line"></i> Revenue by Customer Type</div>
                    <div class="chart-canvas">
                        <canvas id="customers_customerTypeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Section -->
            <div>
                <div class="section-title"><i class="fas fa-filter"></i> Filter Customers</div>

                <div class="form-controls">
                    <div class="filter-group" style="flex: 1;">
                        <input type="text" class="form-control" id="customers_searchInput"
                            placeholder="Search customers...">
                    </div>
                </div>

                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Customer Type</label>
                        <select class="form-control" id="customers_filterType">
                            <option value="">All Types</option>
                            <option value="retail">Retail</option>
                            <option value="wholesale">Wholesale</option>
                            <option value="consumer">End Consumer</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select class="form-control" id="customers_statusFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Credit Status</label>
                        <select class="form-control" id="customers_creditFilter">
                            <option value="">All Status</option>
                            <option value="good">Good</option>
                            <option value="warning">Warning</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Location</label>
                        <select class="form-control" id="customers_locationFilter">
                            <option value="">All Locations</option>
                            <option value="delhi">Delhi</option>
                            <option value="mumbai">Mumbai</option>
                            <option value="chennai">Chennai</option>
                            <option value="bangalore">Bangalore</option>
                            <option value="kolkata">Kolkata</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" id="customers_applyFilters">
                        <i class="fas fa-check"></i> Apply Filters
                    </button>
                    <button class="btn btn-outline" id="customers_resetFilters">
                        <i class="fas fa-sync"></i> Reset Filters
                    </button>
                </div>
            </div>

            <!-- Customer Table -->
            <div>
                <div class="view-controls">
                    <div class="section-title"><i class="fas fa-user-friends"></i> Customer Directory</div>
                    <div class="export-buttons">
                        <button class="btn btn-primary" id="customers_addCustomerBtn">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                        <button class="btn btn-success" id="customers_exportCSV">
                            <i class="fas fa-file-csv"></i> Export CSV
                        </button>
                        <button class="btn btn-info" id="customers_exportPDF">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Type</th>
                                <th>Credit Limit</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers_customerTableBody">
                            <!-- Customer rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Orders -->
            <div>
                <div class="view-controls">
                    <div class="section-title"><i class="fas fa-receipt"></i> Recent Orders</div>
                    <select class="form-control" id="customers_orderFilter" style="width: 200px;">
                        <option value="all">All Orders</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="partial">Partial</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="customers_orderList">
                            <!-- Orders will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-log">
                <h4><i class="fas fa-history"></i> Recent Activity</h4>
                <ul class="activity-list" id="customers_activityList">
                    <!-- Activity will be populated by JavaScript -->
                </ul>
            </div>


            <!-- Add/Edit Customer Modal -->
            <div class="modal" id="customers_customerModal">
                <div class="modal-content">
                    <button class="modal-close" id="customers_closeModal">&times;</button>
                    <div class="modal-title" id="customers_modalTitle"><i class="fas fa-user-plus"></i> Add Customer
                    </div>
                    <div class="modal-body">
                        <form id="customers_customerForm">
                            <input type="hidden" id="customers_customerId">

                            <div class="form-group">
                                <label for="customers_customerName" class="required">Full Name</label>
                                <input type="text" class="form-control" id="customers_customerName"
                                    placeholder="Enter customer name" required>
                            </div>

                            <div class="form-group">
                                <label for="customers_customerPhone" class="required">Phone Number</label>
                                <input type="tel" class="form-control" id="customers_customerPhone"
                                    placeholder="Enter 10-digit phone number" pattern="[0-9]{10}" required>
                            </div>

                            <div class="form-group">
                                <label for="customers_customerEmail">Email Address</label>
                                <input type="email" class="form-control" id="customers_customerEmail"
                                    placeholder="Enter email address">
                            </div>

                            <div class="form-group">
                                <label for="customers_customerAddress" class="required">Address</label>
                                <input type="text" class="form-control" id="customers_customerAddress"
                                    placeholder="Enter full address" required>
                            </div>

                            <div class="form-group">
                                <label for="customers_customerType" class="required">Customer Type</label>
                                <select class="form-control" id="customers_customerType" required>
                                    <option value="">Select Type</option>
                                    <option value="retail">Retail</option>
                                    <option value="wholesale">Wholesale</option>
                                    <option value="consumer">End Consumer</option>
                                </select>
                            </div>

                            <div class="form-group" id="customers_creditLimitContainer">
                                <label for="customers_creditLimit">Credit Limit (â‚¹)</label>
                                <input type="number" class="form-control" id="customers_creditLimit" min="0" value="0">
                            </div>
                        </form>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-outline" id="customers_cancelBtn">Cancel</button>
                        <button class="btn btn-primary" id="customers_saveCustomerBtn">Save Customer</button>
                    </div>
                </div>
            </div>

            <!-- Order Placement Modal -->
            <div class="modal" id="customers_orderModal">
                <div class="modal-content">
                    <button class="modal-close" id="customers_closeOrderModal">&times;</button>
                    <div class="modal-title"><i class="fas fa-shopping-cart"></i> Place New Order</div>
                    <div class="modal-body">
                        <form id="customers_orderForm">
                            <div class="form-group">
                                <label>Customer</label>
                                <input type="text" class="form-control" id="customers_orderCustomer" readonly>
                            </div>

                            <div class="form-group">
                                <label>Order Date</label>
                                <input type="date" class="form-control" id="customers_orderDate" value="">
                            </div>

                            <h3 style="margin: 20px 0 15px; color: var(--primary);">Select Products</h3>

                            <div class="order-item">
                                <div class="item-info">
                                    <h4>Fresh Milk <span class="item-price">(MRP: â‚¹45/liter)</span></h4>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn customers_minusBtn" data-product="milk"><i
                                            class="fas fa-minus"></i></button>
                                    <input type="number" class="qty-input" id="customers_milkQty" min="0" value="0"
                                        data-price="45">
                                    <button type="button" class="qty-btn customers_plusBtn" data-product="milk"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </div>

                            <div class="order-item">
                                <div class="item-info">
                                    <h4>Homemade Curd <span class="item-price">(MRP: â‚¹40/500g)</span></h4>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn customers_minusBtn" data-product="curd"><i
                                            class="fas fa-minus"></i></button>
                                    <input type="number" class="qty-input" id="customers_curdQty" min="0" value="0"
                                        data-price="40">
                                    <button type="button" class="qty-btn customers_plusBtn" data-product="curd"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </div>

                            <div class="order-item">
                                <div class="item-info">
                                    <h4>Farm Paneer <span class="item-price">(MRP: â‚¹200/kg)</span></h4>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn customers_minusBtn" data-product="paneer"><i
                                            class="fas fa-minus"></i></button>
                                    <input type="number" class="qty-input" id="customers_paneerQty" min="0" value="0"
                                        data-price="200">
                                    <button type="button" class="qty-btn customers_plusBtn" data-product="paneer"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </div>

                            <div class="order-item">
                                <div class="item-info">
                                    <h4>Artisan Cheese <span class="item-price">(MRP: â‚¹300/kg)</span></h4>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn customers_minusBtn" data-product="cheese"><i
                                            class="fas fa-minus"></i></button>
                                    <input type="number" class="qty-input" id="customers_cheeseQty" min="0" value="0"
                                        data-price="300">
                                    <button type="button" class="qty-btn customers_plusBtn" data-product="cheese"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </div>

                            <div class="order-summary">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="customers_orderSubtotal">â‚¹0.00</span>
                                </div>
                                <div class="summary-row">
                                    <span>Discount:</span>
                                    <span id="customers_orderDiscount">â‚¹0.00</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Total:</span>
                                    <span id="customers_orderTotal">â‚¹0.00</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Payment Method</label>
                                <select class="form-control" id="customers_paymentMethod" required>
                                    <option value="">Select Payment</option>
                                    <option value="cash">Cash</option>
                                    <option value="upi">UPI</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="credit">Credit (30 days)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Payment Status</label>
                                <select class="form-control" id="customers_paymentStatus" required>
                                    <option value="paid">Paid</option>
                                    <option value="pending">Pending</option>
                                    <option value="partial">Partial Payment</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-outline" id="customers_cancelOrderBtn">Cancel</button>
                        <button class="btn btn-primary" id="customers_placeOrderBtn">Place Order</button>
                    </div>
                </div>
            </div>

            <!-- Toast Container -->
            <div class="toast-container" id="customers_toastContainer"></div>
        </div>

        <div class="section fade-in" id="deliveries-section">
            <div class="container">
                <div class="banner">
                    <i class="fas fa-truck"></i>
                    Delivery Management
                </div>

                <div class="form-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="filter-input" id="deliveries_searchInput"
                            placeholder="Search deliveries...">
                    </div>
                    <div class="filter-group">
                        <select class="filter-input" id="deliveries_vehicleFilter">
                            <option value="">All Vehicles</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select class="filter-input" id="deliveries_productFilter">
                            <option value="">All Products</option>
                            <option value="Whole Milk">Whole Milk</option>
                            <option value="Skim Milk">Skim Milk</option>
                            <option value="Chocolate Milk">Chocolate Milk</option>
                            <option value="Yogurt">Yogurt</option>
                            <option value="Cheese">Cheese</option>
                            <option value="Butter">Butter</option>
                            <option value="Cream">Cream</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="deliveries_addVehicleBtn">
                        <i class="fas fa-plus"></i> Add Vehicle
                    </button>
                </div>

                <div class="view-controls">
                    <div class="view-buttons">
                        <button class="view-btn active" data-view="table"><i class="fas fa-table"></i> Table
                            View</button>
                        <button class="view-btn" data-view="calendar"><i class="fas fa-calendar"></i> Calendar
                            View</button>
                        <button class="view-btn" data-view="map"><i class="fas fa-map-marker-alt"></i> Map View</button>
                    </div>
                </div>

                <div class="card-grid">
                    <div class="card card-blue">
                        <div class="card-header">
                            <div class="card-title">Total Deliveries</div>
                            <div class="card-icon"><i class="fas fa-truck-loading"></i></div>
                        </div>
                        <div class="card-value" id="deliveries_totalDeliveries">0</div>
                        <div class="card-change">This Week</div>
                    </div>
                    <div class="card card-green">
                        <div class="card-header">
                            <div class="card-title">Total Volume</div>
                            <div class="card-icon"><i class="fas fa-weight-hanging"></i></div>
                        </div>
                        <div class="card-value" id="deliveries_totalVolume">0</div>
                        <div class="card-change">Liters</div>
                    </div>
                    <div class="card card-orange">
                        <div class="card-header">
                            <div class="card-title">On-Time Rate</div>
                            <div class="card-icon"><i class="fas fa-stopwatch"></i></div>
                        </div>
                        <div class="card-value" id="deliveries_onTimeRate">0%</div>
                        <div class="card-change">Completed on time</div>
                    </div>
                    <div class="card card-purple">
                        <div class="card-header">
                            <div class="card-title">Fuel Efficiency</div>
                            <div class="card-icon"><i class="fas fa-gas-pump"></i></div>
                        </div>
                        <div class="card-value" id="deliveries_fuelEfficiency">0.0</div>
                        <div class="card-change">km/L average</div>
                    </div>
                </div>

                <!-- Table View -->
                <div class="dashboard-view" id="deliveries_tableView">
                    <div>
                        <h3 class="section-title"><i class="fas fa-calendar-alt"></i> Weekly Delivery Schedule</h3>

                        <div class="tabs-container">
                            <div class="tabs-header">
                                <button class="tab-btn active" data-day="monday">Monday</button>
                                <button class="tab-btn" data-day="tuesday">Tuesday</button>
                                <button class="tab-btn" data-day="wednesday">Wednesday</button>
                                <button class="tab-btn" data-day="thursday">Thursday</button>
                                <button class="tab-btn" data-day="friday">Friday</button>
                                <button class="tab-btn" data-day="saturday">Saturday</button>
                                <button class="tab-btn" data-day="sunday">Sunday</button>
                            </div>

                            <div class="tab-content active" id="deliveries_monday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_monday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addMondayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_tuesday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_tuesday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addTuesdayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_wednesday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_wednesday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addWednesdayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_thursday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_thursday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addThursdayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_friday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_friday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addFridayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_saturday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_saturday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addSaturdayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>

                            <div class="tab-content" id="deliveries_sunday_content">
                                <table class="custom-table">
                                    <thead>
                                        <tr>
                                            <th data-sort="customer">Customer</th>
                                            <th data-sort="product">Product</th>
                                            <th data-sort="quantity">Qty (L)</th>
                                            <th data-sort="time">Delivery Time</th>
                                            <th data-sort="vehicle">Vehicle</th>
                                            <th data-sort="status">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries_sunday_table"></tbody>
                                </table>
                                <button class="btn btn-outline" id="deliveries_addSundayBtn">
                                    <i class="fas fa-plus"></i> Add Delivery
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="dashboard-view" id="deliveries_calendarView" style="display:none;">
                    <div>
                        <h3 class="section-title"><i class="fas fa-calendar-alt"></i> Weekly Delivery Calendar</h3>
                        <div class="calendar-grid" id="deliveries_calendarGrid"></div>
                    </div>
                </div>

                <!-- Map View -->
                <div class="dashboard-view" id="deliveries_mapView" style="display:none;">
                    <div>
                        <h3 class="section-title"><i class="fas fa-map-marked-alt"></i> Delivery Route Map</h3>
                        <div class="map-placeholder">
                            <i class="fas fa-map"></i>
                            <h3>Delivery Route Visualization</h3>
                            <p>Interactive map showing all delivery routes for the week</p>
                        </div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-box">
                        <div class="chart-header">
                            <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Delivery Volume by Day</h3>
                            <div style="display:flex;">
                                <button class="view-btn active" data-chart="volume">Volume</button>
                                <button class="view-btn" data-chart="count">Count</button>
                            </div>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="deliveries_deliveryChart"></canvas>
                        </div>
                    </div>
                    <div class="charts-containerr">
                    <div class="chart-box">
                        <div class="chart-header">
                            <h3 class="chart-title"><i class="fas fa-truck"></i> Vehicle Utilization</h3>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="deliveries_vehicleChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <div class="chart-header">
                            <h3 class="chart-title"><i class="fas fa-boxes"></i> Product Distribution</h3>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="deliveries_productChart"></canvas>
                        </div>
                    </div>
                    </div>
                </div>

                <div>
                    <div>
                        <h3 class="section-title"><i class="fas fa-truck-moving"></i> Vehicle Management</h3>
                        <div id="deliveries_vehicleManagement"
                            style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 25px; border:none"></div>
                    </div>
                    <div>
                        <h3 class="section-title"><i class="fas fa-history"></i> Recent Activity</h3>
                        <div class="activity-log">
                            <ul id="deliveries_activityList"></ul>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Modal -->
                <div class="modal" id="deliveries_vehicleModal">
                    <div class="modal-content">
                        <button class="modal-close">&times;</button>
                        <h3 class="modal-title" id="deliveries_vehicleModalTitle">Add New Vehicle</h3>

                        <div class="form-group">
                            <label for="deliveries_vehicleName">Vehicle Name <span class="required">*</span></label>
                            <input type="text" class="form-control" id="deliveries_vehicleName"
                                placeholder="e.g., Truck 3" required>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_vehicleType">Vehicle Type <span class="required">*</span></label>
                            <select class="form-control" id="deliveries_vehicleType" required>
                                <option value="">Select Type</option>
                                <option value="Truck">Truck</option>
                                <option value="Van">Van</option>
                                <option value="Refrigerated Truck">Refrigerated Truck</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_vehicleCapacity">Capacity (Liters) <span
                                    class="required">*</span></label>
                            <input type="number" class="form-control" id="deliveries_vehicleCapacity" min="100"
                                max="2000" placeholder="e.g., 500" required>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-danger" id="deliveries_cancelVehicle">Cancel</button>
                            <button class="btn btn-success" id="deliveries_saveVehicle">Save Vehicle</button>
                        </div>
                    </div>
                </div>

                <!-- Delivery Modal -->
                <div class="modal" id="deliveries_deliveryModal">
                    <div class="modal-content">
                        <button class="modal-close">&times;</button>
                        <h3 class="modal-title" id="deliveries_deliveryModalTitle">Delivery Details</h3>

                        <div class="form-group">
                            <label for="deliveries_deliveryCustomer">Customer <span class="required">*</span></label>
                            <input type="text" class="form-control" id="deliveries_deliveryCustomer" required>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryProduct">Product <span class="required">*</span></label>
                            <select class="form-control" id="deliveries_deliveryProduct" required>
                                <option value="Whole Milk">Whole Milk</option>
                                <option value="Skim Milk">Skim Milk</option>
                                <option value="Chocolate Milk">Chocolate Milk</option>
                                <option value="Yogurt">Yogurt</option>
                                <option value="Cheese">Cheese</option>
                                <option value="Butter">Butter</option>
                                <option value="Cream">Cream</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryQuantity">Quantity (Liters) <span
                                    class="required">*</span></label>
                            <input type="number" class="form-control" id="deliveries_deliveryQuantity" min="1" required>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryTime">Delivery Time <span class="required">*</span></label>
                            <input type="time" class="form-control" id="deliveries_deliveryTime" required>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryVehicle">Vehicle <span class="required">*</span></label>
                            <select class="form-control" id="deliveries_deliveryVehicle" required></select>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryStatus">Status <span class="required">*</span></label>
                            <select class="form-control" id="deliveries_deliveryStatus" required>
                                <option value="Scheduled">Scheduled</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="Delayed">Delayed</option>
                                <option value="Canceled">Canceled</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="deliveries_deliveryNotes">Notes</label>
                            <textarea class="form-control" id="deliveries_deliveryNotes" rows="3"></textarea>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-danger" id="deliveries_cancelDelivery">Cancel</button>
                            <button class="btn btn-success" id="deliveries_saveDelivery">Save Delivery</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section fade-in" id="payments-section">
            <div class="container">
                <div class="banner">
                    <i class="fas fa-credit-card"></i>
                    Payments Management
                </div>

                <!-- Cards Section -->
                <div>
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Total Payments</div>
                                    <div class="card-value" id="payments_total">0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                            </div>
                            <div class="card-meta">
                                <i class="fas fa-chart-line"></i>
                                <span>+12% from last month</span>
                            </div>
                        </div>

                        <div class="card card-green">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Total Amount</div>
                                    <div class="card-value" id="payments_amount">â‚¹0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>

                            </div>
                            <div class="card-meta">
                                <i class="fas fa-university"></i>
                                <span>All transactions</span>
                            </div>
                        </div>

                        <div class="card card-blue">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Average Payment</div>
                                    <div class="card-value" id="payments_avg">â‚¹0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>

                            </div>
                            <div class="card-meta">
                                <i class="fas fa-balance-scale"></i>
                                <span>Per transaction</span>
                            </div>
                        </div>

                        <div class="card card-orange">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Highest Payment</div>
                                    <div class="card-value" id="payments_max">â‚¹0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-arrow-up"></i>
                                </div>

                            </div>
                            <div class="card-meta">
                                <i class="fas fa-calendar-alt"></i>
                                <span>This month</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table Section -->

                <div class="filters-grid">
                    <input type="text" class="form-control" id="payments_search" placeholder="Search..." />
                    <select class="form-control" id="payments_filter_type">
                        <option value="">All Types</option>
                        <option value="Customer">Customer</option>
                        <option value="Farmer">Farmer</option>
                        <option value="Supplier">Supplier</option>
                    </select>
                    <select class="form-control" id="payments_filter_status">
                        <option value="">All Statuses</option>
                        <option value="Paid">Paid</option>
                        <option value="Partially Paid">Partially Paid</option>
                        <option value="Unpaid">Unpaid</option>
                    </select>
                    <select class="form-control" id="payments_filter_method">
                        <option value="">All Methods</option>
                        <option>Cash</option>
                        <option>Bank Transfer</option>
                        <option>UPI</option>
                        <option>Cheque</option>
                        <option>Other</option>
                    </select>
                    <input type="date" class="form-control" id="payments_filter_start" />
                    <input type="date" class="form-control" id="payments_filter_end" />

                    <button class="btn btn-outline" id="payments_export_csv">
                        <i class="fas fa-download"></i>
                        Export CSV
                    </button>
                    <button class="btn btn-outline" id="payments_export_pdf">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                    <button class="btn btn-success" id="payments_add_btn">
                        <i class="fas fa-plus"></i> Add Payment
                    </button>
                </div>
                <div class="data-section">
                    <table class="custom-table" id="payments_table">
                        <thead>
                            <tr>
                                <th>Transaction ID</th>
                                <th>Type</th>
                                <th>Party</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Method</th>
                                <th>Invoice</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="payments_table_body"></tbody>
                    </table>
                </div>

                <div class="pagination" id="payments_pagination"></div>

                <!-- Charts Section -->
                <div>
                    <h2 class="section-title">Payment Analytics</h2>
                    <div class="charts-container">
                        <div class="charts-containerr">
                            <div class="chart-box">
                                <h4 class="chart-title">
                                    <i class="fas fa-chart-pie"></i>
                                    Payment Type Distribution
                                </h4>
                                <canvas id="payments_chart_type"></canvas>
                            </div>
                            <div class="chart-box">
                                <h4 class="chart-title">
                                    <i class="fas fa-chart-pie"></i>
                                    Payment Status
                                </h4>
                                <canvas id="payments_chart_status"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4 class="chart-title">
                                <i class="fas fa-credit-card"></i>
                                Payment Trends
                            </h4>
                            <canvas id="payments_chart_trend"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Section -->
                <div>
                    <h2 class="section-title">Recent Payment Activity</h2>
                    <div class="activity-log">
                        <ul id="payments_recent_list"></ul>
                    </div>
                </div>
            </div>

            <!-- Add/Edit Payment Modal -->
            <div class="modal" id="payments_modal">
                <div class="modal-content">
                    <button class="modal-close" id="payments_modal_close">&times;</button>
                    <h3 class="modal-title">
                        <i class="fas fa-credit-card"></i>
                        <span id="payments_modal_title">Add New Payment</span>
                    </h3>

                    <form id="payments_form">
                        <input type="hidden" id="payments_edit_id">

                        <div class="form-group">
                            <label for="payments_type">Payment Type <span class="required">*</span></label>
                            <select class="form-control" id="payments_type" required>
                                <option value="">Select Type</option>
                                <option value="Customer">Customer</option>
                                <option value="Farmer">Farmer</option>
                                <option value="Supplier">Supplier</option>
                            </select>
                            <div class="error-message" id="payments_type_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_party">Party Name <span class="required">*</span></label>
                            <input type="text" class="form-control" id="payments_party" required>
                            <div class="error-message" id="payments_party_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_date">Date <span class="required">*</span></label>
                            <input type="date" class="form-control" id="payments_date" required>
                            <div class="error-message" id="payments_date_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_amount">Amount (â‚¹) <span class="required">*</span></label>
                            <input type="number" class="form-control" id="payments_amount_input" min="0" step="0.01"
                                required>
                            <div class="error-message" id="payments_amount_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_status">Status <span class="required">*</span></label>
                            <select class="form-control" id="payments_status" required>
                                <option value="">Select Status</option>
                                <option value="Paid">Paid</option>
                                <option value="Partially Paid">Partially Paid</option>
                                <option value="Unpaid">Unpaid</option>
                            </select>
                            <div class="error-message" id="payments_status_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_method">Payment Method <span class="required">*</span></label>
                            <select class="form-control" id="payments_method" required>
                                <option value="">Select Method</option>
                                <option>Cash</option>
                                <option>Bank Transfer</option>
                                <option>UPI</option>
                                <option>Cheque</option>
                                <option>Other</option>
                            </select>
                            <div class="error-message" id="payments_method_error"></div>
                        </div>

                        <div class="form-group">
                            <label for="payments_invoice">Invoice ID</label>
                            <input type="text" class="form-control" id="payments_invoice">
                        </div>

                        <div class="form-group">
                            <label for="payments_remarks">Remarks</label>
                            <textarea class="form-control" id="payments_remarks" rows="3"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="payments_form_cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="payments_form_submit">Save
                                Payment</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Notification -->
            <div class="notification" id="payments_notification">
                <i class="fas fa-check-circle"></i>
                <div class="notification-content">
                    <h4 id="payments_notification_title">Success</h4>
                    <p id="payments_notification_message">Operation completed successfully</p>
                </div>
            </div>
        </div>

        <div class="section fade-in" id="reports-section">
            <div class="banner"><i class="fas fa-file-alt"></i> Reports Management</div>

            <!-- Tabs - Emojis replaced with Font Awesome icons -->
            <div class="tabs">
                <div class="tab active" onclick="reports_switch_tab('table')"><i class="fas fa-file-alt"></i> All
                    Reports
                </div>
                <div class="tab" onclick="reports_switch_tab('cards')"><i class="fas fa-th-large"></i> Card View</div>
                <div class="tab" onclick="reports_switch_tab('charts')"><i class="fas fa-chart-bar"></i> Charts</div>
                <div class="tab" onclick="reports_switch_tab('form')"><i class="fas fa-plus"></i> Add Report</div>
            </div>

            <!-- Filters -->
            <div class="section-actions">
                <input type="text" id="reports_search" class="form-control" placeholder="ðŸ” Search reports..." />
                <select id="reports_type_filter" class="form-control">
                    <option value="">All Types</option>
                    <option value="Sales">Sales</option>
                    <option value="Inventory">Inventory</option>
                    <option value="Logistics">Logistics</option>
                </select>
                <button class="btn btn-outline" onclick="reports_export_csv()">Export CSV</button>
                <button class="btn btn-outline" onclick="reports_export_pdf()">Export PDF</button>
            </div>

            <!-- Table View -->
            <div id="reports_tab_table">
                <div class="data-section">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Author</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reports_table_body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Card View -->
            <div id="reports_tab_cards" style="display:none;">
                <div class="card-grid" id="reports_card_container"></div>
            </div>

            <!-- Charts View -->
            <div id="reports_tab_charts" style="display:none;">
                <div class="charts-containerr">
                    <!-- Pie Chart: Reports by Type -->
                    <div class="chart-box">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Reports by Type</h3>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="reports_type_chart"></canvas>
                        </div>
                    </div>

                    <!-- Bar Chart: Monthly Report Trend -->
                    <div class="chart-box">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Monthly Report Trend</h3>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="reports_trend_chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div id="reports_tab_form" style="display:none;">
                <form onsubmit="return reports_save(event)" class="settings-grid" style="margin-top: 1rem;">
                    <input type="hidden" id="reports_edit_index" />
                    <div class="form-group">
                        <label>Title</label>
                        <input id="reports_title" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="reports_type" class="form-control">
                            <option value="Sales">Sales</option>
                            <option value="Inventory">Inventory</option>
                            <option value="Logistics">Logistics</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="reports_date" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Author</label>
                        <input id="reports_author" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="reports_status" class="form-control">
                            <option value="Draft">Draft</option>
                            <option value="Finalized">Finalized</option>
                        </select>
                    </div>
                    <div class="form-actions" style="grid-column: span 2;">
                        <button type="submit" class="btn btn-outline"><i class="fas fa-save"></i> Save Report</button>
                        <button type="button" class="btn btn-outline"
                            onclick="reports_switch_tab('table')">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Activity Log -->
            <div class="activity-log">
                <h3><i class="fas fa-history"></i> Recent Report Activity</h3>
                <ul id="reports_activity_log"></ul>
            </div>
        </div>

        <div class="section fade-in" id="settings-section">

            <div class="banner">Settings </div>

            <div class="card-grid">
                <div class="card" style="border: none; line-height: 2;">
                    <h3 class="setting-title">Appearance</h3>
                    <p class="setting-description">
                        Customize the look and feel of your dashboard
                    </p>
                    <div class="form-group">
                        <label for="theme-mode">Theme Mode</label>
                        <div style="display: flex; gap: 3px;">
                            <div class="switch">
                                <input id="theme-mode"
                                    style="width: 20px; height: 20px; accent-color: green; cursor: pointer;"
                                    onchange="toggleThemeMode()" type="checkbox" />
                                <span class="slider"></span>
                            </div>
                            <span id="theme-mode-label" style="margin-left: 10px">Dark Mode</span>
                        </div>
                    </div>
                </div>
                <div class="card" style="border:none; line-height: 2;">
                    <h3 class="setting-title">Notifications</h3>
                    <p class="setting-description" style="margin-bottom: 12px;">
                        Configure how you receive notifications
                    </p>
                    <div class="form-group" style="display: flex; gap: 13px;">
                        <div class="switch">
                            <input checked="" style="width: 20px; height: 20px; accent-color: green; cursor: pointer;"
                                id="email-notifications" type="checkbox" />
                            <span class="slider"></span>
                        </div>
                        <label for="email-notifications">Email Notifications</label>
                    </div>
                    <div class="form-group" style="display: flex; gap: 13px;">
                        <div class="switch">
                            <input checked="" style="width: 20px; height: 20px; accent-color: green; cursor: pointer;"
                                id="app-notifications" type="checkbox" />
                            <span class="slider"></span>
                        </div>
                        <label for="app-notifications">App Notifications</label>
                    </div>
                </div>
                <div class="card" style="border: none; line-height: 2;">
                    <h3 class="setting-title">Data Management</h3>
                    <p class="setting-description">Manage your data and backups</p>
                    <div class="setting-actions" style="margin-top: 12px;">
                        <button class="btn btn-outline" onclick="backupData()">
                            <i class="fas fa-database"></i>
                            Backup Data
                        </button>
                        <button class="btn btn-outline" onclick="restoreData()">
                            <i class="fas fa-undo"></i>
                            Restore Data
                        </button>
                    </div>
                </div>
                <div class="card" style="border: none; line-height: 2;">
                    <h3 class="setting-title">System Information</h3>
                    <p class="setting-description">View system details and version</p>
                    <div class="form-group">
                        <label>Version</label>
                        <p>DairyMaster Pro v2.1.0</p>
                    </div>
                    <div class="form-group">
                        <label>Last Updated</label>
                        <p>July 25, 2023</p>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-primary" onclick="checkForUpdates()">
                            <i class="fas fa-sync-alt"></i>
                            Check for Updates
                        </button>
                    </div>
                </div>
                <div class="card" style="border: none;">
                    <button class="btn btn-outline" onclick="logoutUser()">Log out</button>
                </div>
            </div>


        </div>

        <div class="section fade-in" id="profile">
            <div class="banner">Profile Settings</div>
            <form class="profile-form" onsubmit="saveProfile();return false;">
                <label>Name:</label>
                <input id="pName" placeholder="John Smith" type="text" />
                <label>Email:</label>
                <input id="pEmail" placeholder="Enter your email" type="email" />
                <label>Phone:</label>
                <input id="pPhone" pattern="[6-9][0-9]{9}" placeholder="Enter 10-digit Indian number" required=""
                    title="Phone number must be 10 digits starting with 6,7,8 or 9" type="tel" />
                <label>Address:</label>
                <textarea id="pAddress" placeholder="Enter your address" rows="3"></textarea>
                <label>Language Preference:</label>
                <select id="pLanguage">
                    <option value="en">English</option>
                    <option value="hi">Hindi</option>
                    <option value="te">Telugu</option>
                    <option value="de">German</option>
                </select>
                <label>Work Mode:</label>
                <select id="pWorkMode">
                    <option value="active">Active</option>
                    <option value="away">Away</option>
                    <option value="dnd">Do Not Disturb</option>
                </select>
                <button class="btn btn-outline" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
    <script>
        function logoutUser() {
            // Clear user session
            localStorage.removeItem('currentUser');

            // Redirect to login page
            window.location.href = 'login.html';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const themeToggle = document.getElementById('theme-toggle');
            const icon = themeToggle.querySelector('i');
            const body = document.body;

            // Initialize dark mode
            function initTheme() {
                const isDark = localStorage.getItem('darkMode') === 'true' ||
                    (!localStorage.getItem('darkMode') &&
                        window.matchMedia('(prefers-color-scheme: dark)').matches);

                if (isDark) {
                    body.classList.add('dark-mode');
                    icon.className = 'fas fa-sun';
                    localStorage.setItem('darkMode', 'true');
                }
            }

            // Toggle theme
            themeToggle.addEventListener('click', function () {
                const isDark = body.classList.toggle('dark-mode');
                icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
                localStorage.setItem('darkMode', isDark);
            });

            // Watch for system color scheme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('darkMode')) {
                    const isDark = e.matches;
                    body.classList.toggle('dark-mode', isDark);
                    icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
                }
            });

            // Initialize
            initTheme();
        });
    </script>
    <script>
        // â€”â€” Sidebar toggle â€”â€”
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const main = document.getElementById("main");
            sidebar.classList.toggle("collapsed");
            main.classList.toggle("collapsed");
        }

        // â€”â€” Navigation â€”â€”
        function activateNav(el, sectionId) {
            document.querySelectorAll(".sidebar li").forEach((li) => li.classList.remove("active"));
            el.classList.add("active");
            document.querySelectorAll(".section").forEach((sec) => sec.classList.remove("active"));
            document.getElementById(sectionId).classList.add("active");
            window.scrollTo(0, 0);
        }

        function showSection(sectionId) {
            const navItem = document.querySelector(`.sidebar li[onclick*="${sectionId}"]`);
            if (navItem) activateNav(navItem, sectionId);
        }

        // â€”â€” Language & Work Mode â€”â€”
        function setLanguage(lang) {
            const languages = { en: "English", hi: "Hindi", te: "Telugu", de: "German" };
            const btn = document.querySelector(".hdr-right .dropdown:first-child .dropdown-btn");
            btn.innerHTML = `${languages[lang]}`;
            localStorage.setItem("language", lang);
        }

        function setWorkMode(mode) {
            const modes = { active: "Active", away: "Away", dnd: "Do Not Disturb" };
            const dotColor = mode === "active" ? "green" : mode === "away" ? "gray" : "red";
            const btn = document.querySelector(".hdr-right .dropdown:nth-child(4) .dropdown-btn");
            btn.innerHTML = `<span class="dot ${dotColor}"></span> ${modes[mode]}`;
            localStorage.setItem("workMode", mode);
        }

        // â€”â€” Profile Save/Load â€”â€”
        function saveProfile() {
            const phoneInput = document.getElementById("pPhone");
            const phoneValue = phoneInput.value.replace(/\D/g, ''); // Remove non-digits

            // Validate phone number
            if (!/^[6-9]\d{9}$/.test(phoneValue)) {
                alert("âŒ Invalid Indian number! Must be 10 digits starting with 6,7,8 or 9");
                phoneInput.focus();
                return false;
            }

            const profile = {
                name: document.getElementById("pName").value,
                email: document.getElementById("pEmail").value,
                phone: "+91 " + phoneValue, // Format as +91 XXXXXXXXXX
                address: document.getElementById("pAddress").value,
                language: document.getElementById("pLanguage").value,
                workMode: document.getElementById("pWorkMode").value,
            };

            localStorage.setItem("profile", JSON.stringify(profile));
            document.querySelector(".profile-name").textContent = profile.name;
            setLanguage(profile.language);
            setWorkMode(profile.workMode);
            alert("âœ… Profile saved successfully!");
            return false; // Prevent form submission
        }

        function loadProfile() {
            const profile = JSON.parse(localStorage.getItem("profile")) || {};
            if (profile.name) {
                document.getElementById("pName").value = profile.name;
                document.getElementById("pEmail").value = profile.email || "";
                document.getElementById("pPhone").value = profile.phone || "";
                document.getElementById("pAddress").value = profile.address || "";
                document.getElementById("pLanguage").value = profile.language || "en";
                document.getElementById("pWorkMode").value = profile.workMode || "active";
                document.querySelector(".profile-name").textContent = profile.name;
                setLanguage(profile.language || "en");
                setWorkMode(profile.workMode || "active");
            }
        }

        // Auto-format phone input (prevents non-numbers and limits to 10 digits)
        document.getElementById("pPhone").addEventListener("input", function (e) {
            this.value = this.value.replace(/\D/g, '').substring(0, 10);
        });

        // Load profile on page load
        document.addEventListener("DOMContentLoaded", function () {
            loadProfile();
        });
    </script>
    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and tab contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab
                tab.classList.add('active');

                // Show corresponding tab content
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        // User modal functionality
        const addUserBtn = document.getElementById('add-user-btn');
        const userModal = document.getElementById('user-modal');
        const modalClose = document.querySelector('.modal-close');

        addUserBtn.addEventListener('click', () => {
            userModal.classList.add('active');
        });

        modalClose.addEventListener('click', () => {
            userModal.classList.remove('active');
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === userModal) {
                userModal.classList.remove('active');
            }
        });

        // Permission toggles
        document.querySelectorAll('.switch input').forEach(sw => {
            sw.addEventListener('change', function () {
                const label = this.nextElementSibling.nextElementSibling;
                if (this.checked) {
                    label.textContent = 'Enabled';
                } else {
                    label.textContent = 'Disabled';
                }
            });
        });

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', function () {
            if (confirm('Are you sure you want to log out?')) {
                // In a real app, this would redirect to login page
                alert('You have been logged out successfully.');
                // window.location.href = '/login';
            }
        });


        // Simulate other button actions
        function backupData() {
            alert('Data backup process started. This may take a few minutes.');
        }

        function restoreData() {
            alert('Please select a backup file to restore.');
        }

        function checkForUpdates() {
            alert('Checking for updates...\nYour system is up to date!');
        }
    </script>

    <!--dashboard-->
    <script>
        // Sample data
        let dashboard_data = [
            { customer: "Ravi Kumar", milk: 420, revenue: 680, date: "2025-06-01", status: "Completed" },
            { customer: "Anjali Dairy", milk: 700, revenue: 1000, date: "2025-06-02", status: "Pending" },
            { customer: "Govind Traders", milk: 300, revenue: 600, date: "2025-06-03", status: "Completed" },
            { customer: "Lakshmi Dairy", milk: 250, revenue: 1500, date: "2025-06-04", status: "Completed" },
            { customer: "Sharma Milk Center", milk: 310, revenue: 820, date: "2025-06-05", status: "Completed" },
            { customer: "Patel Dairy Farm", milk: 200, revenue: 500, date: "2025-06-06", status: "Pending" }
        ];

        let dashboard_edit_index = -1;
        let dashboard_trend_chart = null;
        let dashboard_polar_chart = null;

        // Initialize the dashboard
        function dashboard_init() {
            dashboard_render_table();
            dashboard_update_cards();
            dashboard_render_trend_chart();
            dashboard_render_polar_chart();
            dashboard_log_activity("Dashboard initialized with sample data");

            // Add event listeners
            document.getElementById("dashboard_search").addEventListener("input", dashboard_render_table);
            document.getElementById("dashboard_modal").addEventListener("click", function (e) {
                if (e.target === this) dashboard_close_modal();
            });
        }

        // Render the sales table
        function dashboard_render_table() {
            const tbody = document.getElementById("dashboard_table_body");
            const search = document.getElementById("dashboard_search").value.toLowerCase();
            tbody.innerHTML = "";

            dashboard_data.forEach((r, i) => {
                if (
                    r.customer.toLowerCase().includes(search) ||
                    r.status.toLowerCase().includes(search) ||
                    r.date.includes(search)
                ) {
                    const row = document.createElement("tr");

                    row.innerHTML = `
                <td>${r.customer}</td>
                <td>${r.milk.toFixed(1)}</td>
                <td>â‚¹${r.revenue.toFixed(2)}</td>
                <td>${dashboard_format_date(r.date)}</td>
                <td><span class="status ${r.status === "Completed" ? "status-active" : "status-inactive"}">${r.status}</span></td>
                <td class="actions" style="display:flex; gap:6px">
                    <div class="action-btn edit" onclick="dashboard_open_modal(${i})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="action-btn delete" onclick="dashboard_delete_record(${i})" title="Delete">
                        <i class="fas fa-trash"></i>
                    </div>
                </td>
            `;

                    tbody.appendChild(row);
                }
            });
        }

        // Format date for display
        function dashboard_format_date(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // Update dashboard cards
        function dashboard_update_cards() {
            const totalMilk = dashboard_data.reduce((sum, r) => sum + r.milk, 0);
            const totalRevenue = dashboard_data.reduce((sum, r) => sum + r.revenue, 0);
            const customerSet = new Set(dashboard_data.map(r => r.customer));
            const totalCustomers = customerSet.size;

            document.getElementById("dashboard_card_total_milk").textContent = totalMilk.toFixed(1);
            document.getElementById("dashboard_card_total_revenue").textContent = "â‚¹" + totalRevenue.toFixed(2);
            document.getElementById("dashboard_card_total_customers").textContent = totalCustomers;

            // Calculate changes
            const prevTotalMilk = parseFloat(document.getElementById("dashboard_card_total_milk").dataset.prev) || 0;
            const prevTotalRevenue = parseFloat(document.getElementById("dashboard_card_total_revenue").dataset.prev) || 0;
            const prevTotalCustomers = parseInt(document.getElementById("dashboard_card_total_customers").dataset.prev) || 0;

            // Save current values for next calculation
            document.getElementById("dashboard_card_total_milk").dataset.prev = totalMilk;
            document.getElementById("dashboard_card_total_revenue").dataset.prev = totalRevenue;
            document.getElementById("dashboard_card_total_customers").dataset.prev = totalCustomers;

            // Calculate and display changes
            const milkChange = totalMilk - prevTotalMilk;
            const revenueChange = totalRevenue - prevTotalRevenue;
            const customerChange = totalCustomers - prevTotalCustomers;

            function formatChange(value, prefix = "") {
                if (value === 0) return "No change";
                const sign = value > 0 ? "+" : "";
                return `${prefix}${sign}${Math.abs(value).toFixed(2)}`;
            }

            document.getElementById("dashboard_card_change_milk").textContent = formatChange(milkChange, "L");
            document.getElementById("dashboard_card_change_milk").className = milkChange >= 0 ?
                "card-change positive" : "card-change negative";

            document.getElementById("dashboard_card_change_revenue").textContent = formatChange(revenueChange, "â‚¹");
            document.getElementById("dashboard_card_change_revenue").className = revenueChange >= 0 ?
                "card-change positive" : "card-change negative";

            document.getElementById("dashboard_card_change_customers").textContent = formatChange(customerChange);
            document.getElementById("dashboard_card_change_customers").className = customerChange >= 0 ?
                "card-change positive" : "card-change negative";
        }

        // Render the revenue trends chart
        function dashboard_render_trend_chart() {
            const ctx = document.getElementById('dashboard_trend_chart').getContext('2d');

            // Destroy existing chart if it exists
            if (dashboard_trend_chart) dashboard_trend_chart.destroy();

            if (dashboard_data.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#999';
                ctx.textAlign = 'center';
                ctx.fillText('No data available for chart', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            // Aggregate data by date
            const dataByDate = {};
            dashboard_data.forEach(r => {
                if (!dataByDate[r.date]) {
                    dataByDate[r.date] = { milk: 0, revenue: 0 };
                }
                dataByDate[r.date].milk += r.milk;
                dataByDate[r.date].revenue += r.revenue;
            });

            const dates = Object.keys(dataByDate).sort();
            const milkData = dates.map(date => dataByDate[date].milk);
            const revenueData = dates.map(date => dataByDate[date].revenue);

            dashboard_trend_chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Milk (L)',
                            data: milkData,
                            backgroundColor: 'rgba(74, 111, 203, 0.7)',
                            borderColor: 'rgba(74, 111, 203, 1)',
                            borderWidth: 1,
                            borderRadius: 5,
                            order: 2
                        },
                        {
                            label: 'Revenue (â‚¹)',
                            data: revenueData,
                            borderColor: 'rgba(255, 154, 60, 1)',
                            backgroundColor: 'rgba(255, 154, 60, 0.1)',
                            borderWidth: 3,
                            type: 'line',
                            pointRadius: 5,
                            pointBackgroundColor: 'rgba(255, 154, 60, 1)',
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        if (context.datasetIndex === 0) {
                                            label += context.parsed.y.toFixed(1) + 'L';
                                        } else {
                                            label += 'â‚¹' + context.parsed.y.toFixed(2);
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Render the polar area chart for customer revenue
        function dashboard_render_polar_chart() {
            const ctx = document.getElementById('dashboard_polar_chart').getContext('2d');

            // Destroy existing chart if it exists
            if (dashboard_polar_chart) dashboard_polar_chart.destroy();

            if (dashboard_data.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#999';
                ctx.textAlign = 'center';
                ctx.fillText('No data available for chart', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            // Aggregate data by customer
            const dataByCustomer = {};
            dashboard_data.forEach(r => {
                if (!dataByCustomer[r.customer]) {
                    dataByCustomer[r.customer] = 0;
                }
                dataByCustomer[r.customer] += r.revenue;
            });

            const customers = Object.keys(dataByCustomer);
            const revenueData = customers.map(customer => dataByCustomer[customer]);

            // Generate vibrant colors
            const colors = dashboard_generate_colors(customers.length);

            dashboard_polar_chart = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: customers,
                    datasets: [{
                        data: revenueData,
                        backgroundColor: colors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 12
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: â‚¹${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                display: false,
                                backdropColor: 'transparent'
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true
                    }
                }
            });
        }

        // Generate vibrant colors for charts
        function dashboard_generate_colors(count) {
            const colors = [];
            const goldenRatio = 0.618033988749895;
            let hue = 0;

            for (let i = 0; i < count; i++) {
                hue = (hue + goldenRatio * 360) % 360;
                const saturation = 80 + Math.random() * 20;
                const lightness = 50 + Math.random() * 10;
                colors.push(`hsl(${hue}, ${saturation}%, ${lightness}%)`);
            }

            return colors;
        }

        // Log activity
        function dashboard_log_activity(message) {
            const log = document.getElementById("dashboard_activity");
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const item = document.createElement("li");
            item.innerHTML = `
            <span class="activity-time">${time}</span>
            <span class="activity-message">${message}</span>
        `;

            // Add fade-in animation
            item.style.opacity = '0';
            item.style.transition = 'opacity 0.5s';

            log.prepend(item);

            // Trigger animation
            setTimeout(() => {
                item.style.opacity = '1';
            }, 10);

            // Limit to 10 items
            if (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }

        // Open modal for new or existing entry
        function dashboard_open_modal(index = -1) {
            dashboard_edit_index = index;
            const modal = document.getElementById("dashboard_modal");
            modal.classList.add("active");

            // Set modal title
            document.getElementById('dashboard_modal_title').textContent = index >= 0 ? "Edit Sale" : "Add Sale";

            // Reset validation
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            document.getElementById('dashboard_validation_summary').style.display = 'none';

            if (index >= 0) {
                const row = dashboard_data[index];
                document.getElementById("dashboard_input_customer").value = row.customer;
                document.getElementById("dashboard_input_milk").value = row.milk;
                document.getElementById("dashboard_input_revenue").value = row.revenue;
                document.getElementById("dashboard_input_date").value = row.date;
                document.getElementById("dashboard_input_status").value = row.status;
            } else {
                // Reset form
                document.getElementById("dashboard_input_customer").value = "";
                document.getElementById("dashboard_input_milk").value = "";
                document.getElementById("dashboard_input_revenue").value = "";
                document.getElementById("dashboard_input_status").value = "Completed";

                // Set today as default date
                const today = new Date();
                const formattedDate = today.toISOString().split('T')[0];
                document.getElementById("dashboard_input_date").value = formattedDate;
            }
        }

        // Close modal
        function dashboard_close_modal() {
            const modal = document.getElementById("dashboard_modal");
            modal.classList.remove("active"); // Use class instead of style
            dashboard_edit_index = -1;
        }

        // Validate form
        function dashboard_validate_form() {
            const customer = document.getElementById("dashboard_input_customer").value.trim();
            const milk = document.getElementById("dashboard_input_milk").value;
            const revenue = document.getElementById("dashboard_input_revenue").value;
            const date = document.getElementById("dashboard_input_date").value;

            let isValid = true;
            const errors = [];

            // Reset errors
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

            // Validate customer
            if (!customer) {
                document.getElementById('dashboard_customer_error').style.display = 'block';
                isValid = false;
                errors.push("Customer name is required");
            }

            // Validate milk
            if (!milk || parseFloat(milk) < 1) {
                document.getElementById('dashboard_milk_error').style.display = 'block';
                isValid = false;
                errors.push("Milk quantity must be at least 1L");
            }

            // Validate revenue
            if (!revenue || parseFloat(revenue) <= 0) {
                document.getElementById('dashboard_revenue_error').style.display = 'block';
                isValid = false;
                errors.push("Revenue must be a positive number");
            }

            // Validate date
            const today = new Date().toISOString().split('T')[0];
            if (!date || date > today) {
                document.getElementById('dashboard_date_error').style.display = 'block';
                isValid = false;
                errors.push("Date is required and cannot be in the future");
            }

            // Show validation summary if errors exist
            if (errors.length > 0) {
                const summary = document.getElementById('dashboard_validation_summary');
                summary.innerHTML = `
                <div style="background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Please fix the following errors:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        ${errors.map(e => `<li>${e}</li>`).join('')}
                    </ul>
                </div>
            `;
                summary.style.display = 'block';
            }

            return isValid;
        }

        // Save record
        function dashboard_save_record() {
            if (!dashboard_validate_form()) return;

            const customer = document.getElementById("dashboard_input_customer").value.trim();
            const milk = parseFloat(document.getElementById("dashboard_input_milk").value);
            const revenue = parseFloat(document.getElementById("dashboard_input_revenue").value);
            const date = document.getElementById("dashboard_input_date").value;
            const status = document.getElementById("dashboard_input_status").value;

            const record = { customer, milk, revenue, date, status };

            if (dashboard_edit_index >= 0) {
                // Edit existing record
                dashboard_data[dashboard_edit_index] = record;
                dashboard_log_activity(`Edited record for <b>${customer}</b>`);
            } else {
                // Add new record
                dashboard_data.push(record);
                dashboard_log_activity(`Added new record for <b>${customer}</b>`);
            }

            dashboard_close_modal();
            dashboard_render_table();
            dashboard_update_cards();
            dashboard_render_trend_chart();
            dashboard_render_polar_chart();
        }

        // Delete record
        function dashboard_delete_record(index) {
            const customer = dashboard_data[index].customer;
            if (confirm(`Delete record for ${customer}?`)) {
                dashboard_data.splice(index, 1);
                dashboard_log_activity(`Deleted record for <b>${customer}</b>`);
                dashboard_render_table();
                dashboard_update_cards();
                dashboard_render_trend_chart();
                dashboard_render_polar_chart();
            }
        }

        // Export chart
        function dashboard_export_chart() {
            if (!dashboard_polar_chart) {
                alert("No chart data to export");
                return;
            }

            const canvas = document.getElementById("dashboard_polar_chart");
            const url = canvas.toDataURL("image/png");

            const a = document.createElement('a');
            a.href = url;
            a.download = 'customer-revenue-distribution.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Initialize the dashboard on page load
        window.addEventListener('DOMContentLoaded', dashboard_init);
    </script>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!--farmer management-->
    <script>
        // Sample farmer data
        let farmers = [
            { id: 1, name: "Lakshmi Nair", contact: "9876543210", region: "Kerala South", milk: 320, latitude: 9.9312, longitude: 76.2673, status: "Active" },
            { id: 2, name: "Ramesh Patel", contact: "8765432109", region: "Gujarat West", milk: 95, latitude: 22.3072, longitude: 73.1812, status: "Active" },
            { id: 3, name: "Anita Singh", contact: "7654321098", region: "Uttar Pradesh North", milk: 110, latitude: 26.8467, longitude: 80.9462, status: "Active" },
            { id: 4, name: "Suresh Kumar", contact: "6543210987", region: "Tamil Nadu South", milk: 130, latitude: 13.0827, longitude: 80.2707, status: "Pending" },
            { id: 5, name: "Geeta Sharma", contact: "5432109876", region: "Rajasthan West", milk: 805, latitude: 26.9124, longitude: 75.7873, status: "Active" },
            { id: 6, name: "Rajesh Verma", contact: "4321098765", region: "Punjab North", milk: 105, latitude: 31.6340, longitude: 74.8723, status: "Inactive" },
            { id: 7, name: "Meena Devi", contact: "3210987654", region: "Bihar East", milk: 900, latitude: 25.0961, longitude: 85.3131, status: "Active" },
            { id: 8, name: "Vikram Reddy", contact: "2109876543", region: "Andhra Pradesh South", milk: 1015, latitude: 17.3850, longitude: 78.4867, status: "Active" }
        ];

        // DOM Elements
        const farmerForm = document.getElementById('farmer_form');
        const farmerAddBtn = document.getElementById('farmer_addBtn');
        const farmerTableBody = document.getElementById('farmer_tableBody');
        const farmerSearchInput = document.getElementById('farmer_searchInput');
        const farmerRegionFilter = document.getElementById('farmer_regionFilter');
        const farmerActivityLog = document.getElementById('farmer_activityLog');
        const farmerValidationSummary = document.getElementById('farmer_validationSummary');
        const farmerCancelBtn = document.getElementById('farmer_cancelBtn');
        const farmerExportBtn = document.getElementById('farmer_exportBtn');
        const farmerPdfBtn = document.getElementById('farmer_pdfBtn');

        // Modal elements
        const farmerFormModal = document.getElementById('farmer_formModal');
        const farmerFormModalClose = document.getElementById('farmer_formModalClose');
        const farmerDeleteModal = document.getElementById('farmer_deleteModal');
        const farmerDeleteModalClose = document.getElementById('farmer_deleteModalClose');
        const farmerDeleteModalMessage = document.getElementById('farmer_deleteModalMessage');
        const farmerConfirmDelete = document.getElementById('farmer_confirmDelete');
        const farmerCancelDelete = document.getElementById('farmer_cancelDelete');

        // State variables
        let currentPage = 1;
        const rowsPerPage = 5;
        let markers = [];
        let map;
        let deleteIndex = null;
        let pieChart, lineChart;

        // Initialize the page
        function init() {
            renderFarmers();
            updateSummary();
            renderCharts();
            initMap();

            // Event listeners
            farmerForm.addEventListener('submit', handleFormSubmit);
            farmerAddBtn.addEventListener('click', () => openModal('form'));
            farmerCancelBtn.addEventListener('click', () => closeModal('form'));
            farmerSearchInput.addEventListener('input', filterFarmers);
            farmerRegionFilter.addEventListener('change', filterFarmers);
            farmerFormModalClose.addEventListener('click', () => closeModal('form'));
            farmerDeleteModalClose.addEventListener('click', () => closeModal('delete'));
            farmerCancelDelete.addEventListener('click', () => closeModal('delete'));
            farmerConfirmDelete.addEventListener('click', deleteFarmer);
            farmerExportBtn.addEventListener('click', exportToCSV);
            farmerPdfBtn.addEventListener('click', exportToPDF);
        }

        // Open modal
        function openModal(type) {
            if (type === 'form') {
                resetForm();
                farmerFormModal.classList.add('active');
            } else if (type === 'delete') {
                farmerDeleteModal.classList.add('active');
            }
        }

        // Close modal
        function closeModal(type) {
            if (type === 'form') {
                farmerFormModal.classList.remove('active');
            } else if (type === 'delete') {
                farmerDeleteModal.classList.remove('active');
            }
        }

        // Reset form
        function resetForm() {
            farmerForm.reset();
            document.getElementById('farmer_editIndex').value = '-1';
            clearErrors();
            farmerValidationSummary.style.display = 'none';
        }

        // Clear validation errors
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('.form-control').forEach(input => {
                input.classList.remove('input-error');
            });
        }

        // Validate form
        function validateForm() {
            let isValid = true;
            clearErrors();
            const errors = [];

            // Validate name
            const name = document.getElementById('farmer_name').value.trim();
            if (!name) {
                showError('farmer_name', 'Name is required');
                errors.push('Name is required');
                isValid = false;
            }

            // Validate contact
            const contact = document.getElementById('farmer_contact').value.trim();
            if (!contact || !/^\d{10}$/.test(contact)) {
                showError('farmer_contact', 'Valid 10-digit phone number required');
                errors.push('Valid contact number is required');
                isValid = false;
            }

            // Validate region
            const region = document.getElementById('farmer_region').value;
            if (!region) {
                showError('farmer_region', 'Region is required');
                errors.push('Region is required');
                isValid = false;
            }

            // Validate milk
            const milk = document.getElementById('farmer_milk').value;
            if (!milk || isNaN(milk) || milk <= 0) {
                showError('farmer_milk', 'Valid milk quantity required (min 1L)');
                errors.push('Valid milk quantity is required');
                isValid = false;
            }

            // Validate latitude
            const latitude = document.getElementById('farmer_latitude').value;
            if (!latitude || isNaN(latitude) || latitude < -90 || latitude > 90) {
                showError('farmer_latitude', 'Valid latitude required (-90 to 90)');
                errors.push('Valid latitude is required');
                isValid = false;
            }

            // Validate longitude
            const longitude = document.getElementById('farmer_longitude').value;
            if (!longitude || isNaN(longitude) || longitude < -180 || longitude > 180) {
                showError('farmer_longitude', 'Valid longitude required (-180 to 180)');
                errors.push('Valid longitude is required');
                isValid = false;
            }

            // Show validation summary if errors
            if (errors.length > 0) {
                farmerValidationSummary.innerHTML = `
                    <strong>Please fix the following errors:</strong>
                    <ul>${errors.map(e => `<li>${e}</li>`).join('')}</ul>
                `;
                farmerValidationSummary.style.display = 'block';
            } else {
                farmerValidationSummary.style.display = 'none';
            }

            return isValid;
        }

        // Show validation error
        function showError(fieldId, message) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            const inputElement = document.getElementById(fieldId);

            errorElement.textContent = message;
            errorElement.style.display = 'block';
            inputElement.classList.add('input-error');
        }

        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();

            if (!validateForm()) return;

            const editIndex = parseInt(document.getElementById('farmer_editIndex').value);
            const farmer = {
                name: document.getElementById('farmer_name').value.trim(),
                contact: document.getElementById('farmer_contact').value.trim(),
                region: document.getElementById('farmer_region').value,
                milk: parseFloat(document.getElementById('farmer_milk').value),
                latitude: parseFloat(document.getElementById('farmer_latitude').value),
                longitude: parseFloat(document.getElementById('farmer_longitude').value),
                status: document.getElementById('farmer_status').value
            };

            if (editIndex >= 0) {
                // Update existing farmer - preserve the original ID
                farmer.id = farmers[editIndex].id;
                farmers[editIndex] = farmer;
                logActivity(`Updated farmer: ${farmer.name}`);
                showToast('Farmer updated successfully!', 'success');
            } else {
                // Add new farmer
                farmer.id = farmers.length > 0 ? Math.max(...farmers.map(f => f.id)) + 1 : 1;
                farmers.push(farmer);
                logActivity(`Added new farmer: ${farmer.name}`);
                showToast('Farmer added successfully!', 'success');
            }

            resetForm();
            renderFarmers();
            updateSummary();
            renderCharts();
            updateMapMarkers();
            closeModal('form');
        }

        // Edit farmer
        function editFarmer(id) {
            const index = farmers.findIndex(f => f.id === id);
            if (index !== -1) {
                const farmer = farmers[index];

                document.getElementById('farmer_editIndex').value = index;
                document.getElementById('farmer_name').value = farmer.name;
                document.getElementById('farmer_contact').value = farmer.contact;
                document.getElementById('farmer_region').value = farmer.region;
                document.getElementById('farmer_milk').value = farmer.milk;
                document.getElementById('farmer_latitude').value = farmer.latitude;
                document.getElementById('farmer_longitude').value = farmer.longitude;
                document.getElementById('farmer_status').value = farmer.status;

                openModal('form');
            }
        }

        // Confirm delete
        function confirmDelete(id) {
            const index = farmers.findIndex(f => f.id === id);
            if (index !== -1) {
                const farmer = farmers[index];
                deleteIndex = index;
                farmerDeleteModalMessage.textContent = `Are you sure you want to delete farmer: ${farmer.name}?`;
                openModal('delete');
            }
        }

        // Delete farmer
        function deleteFarmer() {
            if (deleteIndex !== null) {
                const farmer = farmers[deleteIndex];
                farmers.splice(deleteIndex, 1);
                logActivity(`Deleted farmer: ${farmer.name}`);
                showToast('Farmer deleted successfully!', 'success');
                renderFarmers();
                updateSummary();
                renderCharts();
                updateMapMarkers();
                deleteIndex = null;
            }
            closeModal('delete');
        }

        // Render farmers table
        function renderFarmers() {
            const filteredFarmers = getFilteredFarmers();
            const startIndex = (currentPage - 1) * rowsPerPage;
            const paginatedFarmers = filteredFarmers.slice(startIndex, startIndex + rowsPerPage);

            let tableHTML = '';

            if (paginatedFarmers.length === 0) {
                tableHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            No farmers found matching your criteria
                        </td>
                    </tr>
                `;
            } else {
                paginatedFarmers.forEach(farmer => {
                    let statusClass = '';
                    if (farmer.status === 'Active') statusClass = 'status-active';
                    else if (farmer.status === 'Inactive') statusClass = 'status-inactive';
                    else statusClass = 'status-pending';

                    tableHTML += `
                        <tr>
                            <td>${farmer.id}</td>
                            <td>${farmer.name}</td>
                            <td>${farmer.region}</td>
                            <td>${farmer.contact}</td>
                            <td>${farmer.milk.toFixed(1)}</td>
                            <td><span class="${statusClass}">${farmer.status}</span></td>
                            <td>
                                <button class="btn-edit" onclick="editFarmer(${farmer.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-delete" onclick="confirmDelete(${farmer.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }

            farmerTableBody.innerHTML = tableHTML;
            renderPagination(filteredFarmers.length);
        }

        // Get filtered farmers
        function getFilteredFarmers() {
            const searchTerm = farmerSearchInput.value.toLowerCase();
            const region = farmerRegionFilter.value;

            return farmers.filter(farmer => {
                const matchesSearch = farmer.name.toLowerCase().includes(searchTerm) ||
                    farmer.region.toLowerCase().includes(searchTerm) ||
                    farmer.contact.includes(searchTerm);
                const matchesRegion = region === '' || farmer.region === region;

                return matchesSearch && matchesRegion;
            });
        }

        // Filter farmers
        function filterFarmers() {
            currentPage = 1;
            renderFarmers();
            updateMapMarkers();
        }

        // Render pagination
        function renderPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / rowsPerPage);
            let paginationHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }

            document.getElementById('farmer_pagination').innerHTML = paginationHTML;
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            renderFarmers();
        }

        // Update summary cards
        function updateSummary() {
            document.getElementById('farmer_total').textContent = farmers.length;

            const totalMilk = farmers.reduce((sum, farmer) => sum + farmer.milk, 0);
            document.getElementById('farmer_totalMilk').textContent = totalMilk.toFixed(1);

            const regions = new Set(farmers.map(farmer => farmer.region));
            document.getElementById('farmer_activeRegions').textContent = regions.size;
        }

        // Render charts
        function renderCharts() {
            // Destroy existing charts
            if (pieChart) pieChart.destroy();
            if (lineChart) lineChart.destroy();

            // Milk distribution by region
            const regions = {};
            farmers.forEach(farmer => {
                regions[farmer.region] = (regions[farmer.region] || 0) + farmer.milk;
            });

            const pieCtx = document.getElementById('farmer_pieChart').getContext('2d');
            pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(regions),
                    datasets: [{
                        data: Object.values(regions),
                        backgroundColor: [
                            '#2c6e49', '#4c956c', '#f8961e', '#457b9d', '#e63946',
                            '#8d99ae', '#43aa8b', '#6a4c93', '#2a9d8f', '#d68c45'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Milk Distribution by Region'
                        }
                    }
                }
            });

            // Milk production trend
            const sortedFarmers = [...farmers].sort((a, b) => a.name.localeCompare(b.name));
            const lineCtx = document.getElementById('farmer_lineChart').getContext('2d');
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: sortedFarmers.map(f => f.name),
                    datasets: [{
                        label: 'Milk Production (L)',
                        data: sortedFarmers.map(f => f.milk),
                        borderColor: '#4c956c',
                        backgroundColor: 'rgba(76, 149, 108, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Liters'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Farmers'
                            }
                        }
                    }
                }
            });
        }

        // Initialize Google Maps
        function initMap() {
            const mapElement = document.getElementById('farmer_map');
            if (!mapElement) return;

            try {
                // Default center (India)
                const center = { lat: 20.5937, lng: 78.9629 };

                // Create map
                map = new google.maps.Map(mapElement, {
                    zoom: 5,
                    center: center,
                    mapTypeId: 'roadmap',
                    styles: [
                        {
                            featureType: "poi",
                            stylers: [{ visibility: "off" }]
                        }
                    ]
                });

                updateMapMarkers();
            } catch (e) {
                console.error('Error initializing map:', e);
                mapElement.innerHTML = `<p>Error loading map: ${e.message}</p>`;
            }
        }

        // Update map markers
        function updateMapMarkers() {
            if (!map) return;

            // Clear existing markers
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            const filteredFarmers = getFilteredFarmers();

            if (filteredFarmers.length === 0) return;

            // Create bounds to fit all markers
            const bounds = new google.maps.LatLngBounds();

            filteredFarmers.forEach(f => {
                if (typeof f.latitude === 'number' && !isNaN(f.latitude) &&
                    (typeof f.longitude === 'number' && !isNaN(f.longitude))) {
                    const position = { lat: f.latitude, lng: f.longitude };
                    const marker = new google.maps.Marker({
                        position: position,
                        map: map,
                        title: f.name
                    });

                    // Add info window
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<b>${f.name}</b><br>${f.region}<br>Milk: ${f.milk} L`
                    });

                    marker.addListener('click', () => {
                        infoWindow.open(map, marker);
                    });

                    markers.push(marker);
                    bounds.extend(position);
                }
            });

            // Fit map to bounds if we have markers
            if (markers.length > 0) {
                if (markers.length === 1) {
                    map.setCenter(bounds.getCenter());
                    map.setZoom(10);
                } else {
                    map.fitBounds(bounds);
                }
            }
        }

        // Export to CSV
        function exportToCSV() {
            const headers = ['ID', 'Name', 'Contact', 'Region', 'Milk (L)', 'Status', 'Latitude', 'Longitude'];
            const rows = farmers.map(f => [
                f.id, f.name, f.contact, f.region, f.milk, f.status, f.latitude, f.longitude
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');

            a.href = url;
            a.download = 'farmers_export.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logActivity('Exported farmer data to CSV');
            showToast('Data exported to CSV successfully!', 'success');
        }

        // Export to PDF
        function exportToPDF() {
            logActivity('Exported farmer data to PDF');
            showToast('PDF export functionality would be implemented here!', 'info');
        }

        // Log activity
        function logActivity(message) {
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const icon = message.includes('Added') ? 'fa-user-plus' :
                message.includes('Updated') ? 'fa-user-edit' :
                    message.includes('Deleted') ? 'fa-user-minus' :
                        message.includes('Exported') ? 'fa-file-export' : 'fa-info-circle';

            const li = document.createElement('li');
            li.innerHTML = `<i class="fas ${icon}"></i> [${time}] ${message}`;

            farmerActivityLog.insertBefore(li, farmerActivityLog.firstChild);

            // Keep only last 10 items
            if (farmerActivityLog.children.length > 10) {
                farmerActivityLog.removeChild(farmerActivityLog.lastChild);
            }
        }

        // Show toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' :
                    type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <div class="toast-content">
                    <h4>${type === 'success' ? 'Success!' :
                    type === 'error' ? 'Error!' : 'Info!'}</h4>
                    <p>${message}</p>
                </div>
            `;

            const container = document.getElementById('farmer_toastContainer');
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>


    <!-- Load Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?callback=initMap" async defer></script>

    <!--milk collection-->
    <script>
        // Initialize milk collection data
        let milkcollection_entries = [
            { id: 1, farmer: 'Farmer A', date: '2025-06-07T08:00', qty: 20, fat: 4.2, snf: 8.5, rate: 30, amount: 600 },
            { id: 2, farmer: 'Farmer B', date: '2025-06-08T09:15', qty: 15, fat: 3.8, snf: 8.2, rate: 28, amount: 420 },
            { id: 3, farmer: 'Farmer C', date: '2025-06-09T07:30', qty: 25, fat: 4.5, snf: 8.7, rate: 32, amount: 800 },
            { id: 4, farmer: 'Farmer D', date: '2025-06-10T10:00', qty: 18, fat: 4.0, snf: 8.4, rate: 29, amount: 522 },
            { id: 5, farmer: 'Farmer E', date: '2025-06-11T06:45', qty: 22, fat: 4.3, snf: 8.6, rate: 31, amount: 682 },
        ];

        let milkcollection_nextId = 6;

        // Load Google Charts
        google.charts.load('current', { 'packages': ['corechart', 'bar'] });
        google.charts.setOnLoadCallback(milkcollection_initDashboard);

        function milkcollection_initDashboard() {
            milkcollection_renderTable();
            milkcollection_updateDashboard();
            milkcollection_setupEventListeners();

            // Force charts to render at full width initially
            setTimeout(() => {
                milkcollection_drawDailyMilkChart();
                milkcollection_drawFatSNFChart();
            }, 100);
        }

        function milkcollection_renderTable() {
            const tbody = document.getElementById('milkcollection_dataTableBody');
            tbody.innerHTML = '';

            milkcollection_entries.forEach(entry => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${entry.id}</td>
                <td>${entry.farmer}</td>
                <td>${new Date(entry.date).toLocaleString()}</td>
                <td class="text-right">${entry.qty.toFixed(2)}</td>
                <td class="text-right">${entry.fat.toFixed(2)}</td>
                <td class="text-right">${entry.snf.toFixed(2)}</td>
                <td class="text-right">â‚¹${entry.rate.toFixed(2)}</td>
                <td class="text-right">â‚¹${entry.amount.toFixed(2)}</td>
                <td class="text-center" style="display:flex; gap:6px">
                    <button class="action-btn edit" data-id="${entry.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" data-id="${entry.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
                tbody.appendChild(tr);
            });

            // Add event listeners to action buttons
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    milkcollection_openModalEdit(id);
                });
            });

            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    milkcollection_deleteEntry(id);
                });
            });
        }

        function milkcollection_updateDashboard() {
            // Calculate aggregates
            const totalQty = milkcollection_entries.reduce((sum, e) => sum + e.qty, 0);
            const totalFat = milkcollection_entries.reduce((sum, e) => sum + e.fat, 0) / (milkcollection_entries.length || 1);
            const totalSNF = milkcollection_entries.reduce((sum, e) => sum + e.snf, 0) / (milkcollection_entries.length || 1);
            const uniqueFarmers = new Set(milkcollection_entries.map(e => e.farmer)).size;

            // Update cards values
            document.getElementById('milkcollection_totalLitresVal').textContent = `${totalQty.toFixed(2)} L`;
            document.getElementById('milkcollection_totalFarmersVal').textContent = uniqueFarmers;
            document.getElementById('milkcollection_avgFatVal').textContent = `${totalFat.toFixed(2)} %`;
            document.getElementById('milkcollection_avgSNFVal').textContent = `${totalSNF.toFixed(2)} %`;

            // Draw charts
            milkcollection_drawDailyMilkChart();
            milkcollection_drawFatSNFChart();
        }

        function milkcollection_drawDailyMilkChart() {
            const dailyTotals = {};
            milkcollection_entries.forEach(e => {
                const day = new Date(e.date).toLocaleDateString();
                dailyTotals[day] = (dailyTotals[day] || 0) + e.qty;
            });

            const chartData = [['Date', 'Total Milk (L)']];
            Object.entries(dailyTotals).forEach(([day, total]) => {
                chartData.push([day, total]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                title: 'Daily Milk Collection',
                hAxis: { title: 'Date' },
                vAxis: { title: 'Litres' },
                legend: 'none',
                colors: ['#3f51b5'],
                height: 300,
                chartArea: { width: '85%' }
            };

            const chart = new google.visualization.ColumnChart(
                document.getElementById('milkcollection_dailyMilkChart')
            );
            chart.draw(data, options);
        }

        function milkcollection_drawFatSNFChart() {
            const chartData = [['Farmer', 'Fat %', 'SNF %']];
            milkcollection_entries.forEach(e => {
                chartData.push([e.farmer, e.fat, e.snf]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                title: 'Farmer-wise Fat & SNF %',
                chartArea: { width: '60%' },
                hAxis: { title: 'Percentage (%)', minValue: 0 },
                vAxis: { title: 'Farmer' },
                bars: 'horizontal',
                colors: ['#e91e63', '#00bcd4'],
                height: 300
            };

            const chart = new google.visualization.BarChart(
                document.getElementById('milkcollection_fatSNFChart')
            );
            chart.draw(data, options);
        }

        function milkcollection_addRecentActivity(message) {
            const ul = document.getElementById('milkcollection_recentActivity');
            const li = document.createElement('li');
            const timestamp = new Date().toLocaleString();
            li.innerHTML = `<i class="fas fa-info-circle"></i> [${timestamp}] ${message}`;
            ul.prepend(li);
        }

        function milkcollection_deleteEntry(id) {
            if (!confirm('Are you sure you want to delete this entry?')) return;

            const entry = milkcollection_entries.find(e => e.id === id);
            if (!entry) return;

            milkcollection_entries = milkcollection_entries.filter(e => e.id !== id);
            milkcollection_renderTable();
            milkcollection_updateDashboard();
            milkcollection_addRecentActivity(`Deleted entry for ${entry.farmer}`);
        }

        function milkcollection_openModalEdit(id) {
            const entry = milkcollection_entries.find(e => e.id === id);
            if (!entry) return;

            document.getElementById('milkcollection_editId').value = entry.id;
            document.getElementById('milkcollection_editFarmer').value = entry.farmer;
            document.getElementById('milkcollection_editQty').value = entry.qty;
            document.getElementById('milkcollection_editFat').value = entry.fat;
            document.getElementById('milkcollection_editSNF').value = entry.snf;
            document.getElementById('milkcollection_editRate').value = entry.rate;
            document.getElementById('milkcollection_editDate').value = entry.date;

            document.getElementById('milkcollection_modal').classList.add('active');
        }

        function milkcollection_closeModal() {
            document.getElementById('milkcollection_modal').classList.remove('active');
            document.getElementById('milkcollection_modalForm').reset();
        }

        function milkcollection_downloadExcel() {
            const wb = XLSX.utils.book_new();
            const wsData = [
                ['ID', 'Farmer', 'Date', 'Qty (L)', 'Fat %', 'SNF %', 'Rate â‚¹/L', 'Amount â‚¹']
            ];

            milkcollection_entries.forEach(e => {
                wsData.push([
                    e.id,
                    e.farmer,
                    new Date(e.date).toLocaleString(),
                    e.qty,
                    e.fat,
                    e.snf,
                    e.rate,
                    e.amount
                ]);
            });

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'MilkCollection');
            XLSX.writeFile(wb, 'MilkCollectionData.xlsx');
            milkcollection_addRecentActivity('Exported data to Excel');
        }

        function milkcollection_downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text("Milk Collection Records", 14, 20);
            doc.setFontSize(10);

            const rows = milkcollection_entries.map(e => [
                e.id,
                e.farmer,
                new Date(e.date).toLocaleString(),
                e.qty.toFixed(2),
                e.fat.toFixed(2),
                e.snf.toFixed(2),
                `â‚¹${e.rate.toFixed(2)}`,
                `â‚¹${e.amount.toFixed(2)}`
            ]);

            doc.autoTable({
                head: [['ID', 'Farmer', 'Date', 'Qty', 'Fat', 'SNF', 'Rate', 'Amount']],
                body: rows,
                startY: 25,
                theme: 'striped',
                styles: { fontSize: 8 },
            });

            doc.save('MilkCollectionData.pdf');
            milkcollection_addRecentActivity('Exported data to PDF');
        }

        function milkcollection_setupEventListeners() {
            // Add entry form
            document.getElementById('milkcollection_entryForm').addEventListener('submit', e => {
                e.preventDefault();

                const newEntry = {
                    id: milkcollection_nextId++,
                    farmer: document.getElementById('milkcollection_farmer').value.trim(),
                    date: document.getElementById('milkcollection_datetime').value,
                    qty: parseFloat(document.getElementById('milkcollection_qty').value),
                    fat: parseFloat(document.getElementById('milkcollection_fat').value),
                    snf: parseFloat(document.getElementById('milkcollection_snf').value),
                    rate: parseFloat(document.getElementById('milkcollection_rate').value),
                };

                newEntry.amount = newEntry.qty * newEntry.rate;
                milkcollection_entries.push(newEntry);

                milkcollection_renderTable();
                milkcollection_updateDashboard();
                milkcollection_addRecentActivity(`Added entry for ${newEntry.farmer}`);
                document.getElementById('milkcollection_entryForm').reset();
            });

            // Edit entry form
            document.getElementById('milkcollection_modalForm').addEventListener('submit', e => {
                e.preventDefault();

                const id = parseInt(document.getElementById('milkcollection_editId').value);
                const index = milkcollection_entries.findIndex(e => e.id === id);
                if (index === -1) return;

                const updatedEntry = {
                    id: id,
                    farmer: document.getElementById('milkcollection_editFarmer').value.trim(),
                    qty: parseFloat(document.getElementById('milkcollection_editQty').value),
                    fat: parseFloat(document.getElementById('milkcollection_editFat').value),
                    snf: parseFloat(document.getElementById('milkcollection_editSNF').value),
                    rate: parseFloat(document.getElementById('milkcollection_editRate').value),
                    date: document.getElementById('milkcollection_editDate').value
                };

                updatedEntry.amount = updatedEntry.qty * updatedEntry.rate;
                milkcollection_entries[index] = updatedEntry;

                milkcollection_renderTable();
                milkcollection_updateDashboard();
                milkcollection_addRecentActivity(`Updated entry for ${updatedEntry.farmer}`);
                milkcollection_closeModal();
            });

            // Export buttons
            document.getElementById('milkcollection_excelBtn').addEventListener('click', milkcollection_downloadExcel);
            document.getElementById('milkcollection_pdfBtn').addEventListener('click', milkcollection_downloadPDF);

            // Modal close buttons
            document.getElementById('milkcollection_closeModalBtn').addEventListener('click', milkcollection_closeModal);
            document.getElementById('milkcollection_cancelModalBtn').addEventListener('click', milkcollection_closeModal);

            // Close modal when clicking outside
            document.getElementById('milkcollection_modal').addEventListener('click', e => {
                if (e.target === document.getElementById('milkcollection_modal')) {
                    milkcollection_closeModal();
                }
            });

            // Reset form button in modal
            document.querySelector('#milkcollection_modalForm button[type="reset"]').addEventListener('click', function (e) {
                e.preventDefault();
                const id = document.getElementById('milkcollection_editId').value;
                milkcollection_openModalEdit(parseInt(id));
            });
        }
    </script>

    <!--chilling centers-->
    <script>
        // Initialize Google Charts
        google.charts.load('current', { packages: ['corechart', 'line'] });
        google.charts.setOnLoadCallback(chilling_init);

        // Sample data for chilling centers
        let chilling_centersData = [
            {
                id: 'CC-1001',
                name: 'Mumbai Central',
                location: 'Mumbai',
                totalCapacity: 15000,
                currentCapacity: 12000,
                temperature: 3.5,
                status: 'Active',
                energyType: 'Solar',
                lastUpdated: '2023-06-15T08:30:00'
            },
            {
                id: 'CC-1002',
                name: 'Delhi North',
                location: 'Delhi',
                totalCapacity: 25000,
                currentCapacity: 18000,
                temperature: 4.2,
                status: 'Active',
                energyType: 'Grid Power',
                lastUpdated: '2023-06-15T09:15:00'
            },
            {
                id: 'CC-1003',
                name: 'Chennai South',
                location: 'Chennai',
                totalCapacity: 18000,
                currentCapacity: 15000,
                temperature: 2.8,
                status: 'Maintenance',
                energyType: 'Generator',
                lastUpdated: '2023-06-14T14:20:00'
            },
            {
                id: 'CC-1004',
                name: 'Kolkata East',
                location: 'Kolkata',
                totalCapacity: 22000,
                currentCapacity: 19500,
                temperature: 3.9,
                status: 'Active',
                energyType: 'Solar',
                lastUpdated: '2023-06-15T10:45:00'
            },
            {
                id: 'CC-1005',
                name: 'Bangalore Tech',
                location: 'Bangalore',
                totalCapacity: 30000,
                currentCapacity: 28000,
                temperature: 4.5,
                status: 'Active',
                energyType: 'Battery',
                lastUpdated: '2023-06-15T11:30:00'
            }
        ];

        // Recent activity log
        let chilling_activities = [
            {
                id: 'A-1001',
                type: 'add',
                message: 'Added new center: Bangalore Tech',
                timestamp: '2023-06-15T11:30:00'
            },
            {
                id: 'A-1002',
                type: 'update',
                message: 'Updated center: Kolkata East',
                timestamp: '2023-06-15T10:45:00'
            },
            {
                id: 'A-1003',
                type: 'add',
                message: 'Added new center: Chennai South',
                timestamp: '2023-06-14T14:20:00'
            }
        ];

        // Initialize app
        function chilling_init() {
            chilling_renderTable();
            chilling_updateSummary();
            chilling_drawAllCharts();
            chilling_renderActivity();
            chilling_setupEventListeners();
        }

        // Set up event listeners
        function chilling_setupEventListeners() {
            document.getElementById('chilling_entryForm').addEventListener('submit', chilling_handleFormSubmit);
            document.getElementById('chilling_addCenterBtn').addEventListener('click', () => chilling_showForm());
            document.getElementById('chilling_cancelBtn').addEventListener('click', chilling_closeForm);
            document.getElementById('chilling_searchInput').addEventListener('input', chilling_filterTable);

            // Add input validation listeners
            document.getElementById('chilling_totalCapacity').addEventListener('input', chilling_validateCapacity);
            document.getElementById('chilling_currentCapacity').addEventListener('input', chilling_validateCapacity);
        }

        // Show the form (add/edit)
        function chilling_showForm(id = null) {
            document.getElementById('chilling_formContainer').style.display = 'block';
            const formTitle = document.getElementById('chilling_formTitle');
            const submitBtn = document.getElementById('chilling_submitBtn');

            chilling_resetFormErrors();

            if (id) {
                const center = chilling_centersData.find(c => c.id === id);
                if (!center) return;

                formTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Chilling Center';
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Center';
                document.getElementById('chilling_editId').value = center.id;
                document.getElementById('chilling_centerName').value = center.name;
                document.getElementById('chilling_location').value = center.location;
                document.getElementById('chilling_totalCapacity').value = center.totalCapacity;
                document.getElementById('chilling_currentCapacity').value = center.currentCapacity;
                document.getElementById('chilling_temperature').value = center.temperature;
                document.getElementById('chilling_status').value = center.status;
                document.getElementById('chilling_energyType').value = center.energyType;
            } else {
                formTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Add New Chilling Center';
                submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Center';
                document.getElementById('chilling_editId').value = '';
                // Reset form fields
                document.getElementById('chilling_centerName').value = '';
                document.getElementById('chilling_location').value = '';
                document.getElementById('chilling_totalCapacity').value = 0;
                document.getElementById('chilling_currentCapacity').value = 0;
                document.getElementById('chilling_temperature').value = 0;
                document.getElementById('chilling_status').value = '';
                document.getElementById('chilling_energyType').value = '';
            }

            // Scroll to form
            document.getElementById('chilling_formContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // Close the form and reset
        function chilling_closeForm() {
            document.getElementById('chilling_formContainer').style.display = 'none';
            chilling_resetFormErrors();
        }

        // Reset form error messages
        function chilling_resetFormErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
            });
        }

        // Validate capacity inputs
        function chilling_validateCapacity() {
            const totalCapacity = parseInt(document.getElementById('chilling_totalCapacity').value, 10);
            const currentCapacity = parseInt(document.getElementById('chilling_currentCapacity').value, 10);
            const error = document.getElementById('chilling_currentCapacityError');

            if (isNaN(currentCapacity)) {
                error.textContent = 'Please enter a valid number';
                error.style.display = 'block';
                return false;
            }

            if (currentCapacity > totalCapacity) {
                error.textContent = 'Current capacity cannot exceed total capacity';
                error.style.display = 'block';
                return false;
            }

            error.style.display = 'none';
            return true;
        }

        // Validate form inputs
        function chilling_validateForm() {
            let isValid = true;
            chilling_resetFormErrors();

            const name = document.getElementById('chilling_centerName').value.trim();
            const location = document.getElementById('chilling_location').value.trim();
            const totalCapacity = parseInt(document.getElementById('chilling_totalCapacity').value, 10);
            const currentCapacity = parseInt(document.getElementById('chilling_currentCapacity').value, 10);
            const temperature = parseFloat(document.getElementById('chilling_temperature').value);
            const status = document.getElementById('chilling_status').value;
            const energyType = document.getElementById('chilling_energyType').value;

            if (!name || name.length < 2) {
                document.getElementById('chilling_nameError').style.display = 'block';
                isValid = false;
            }

            if (!location || location.length < 2) {
                document.getElementById('chilling_locationError').style.display = 'block';
                isValid = false;
            }

            if (isNaN(totalCapacity) || totalCapacity < 1000) {
                document.getElementById('chilling_totalCapacityError').style.display = 'block';
                isValid = false;
            }

            if (isNaN(currentCapacity) || currentCapacity < 0 || currentCapacity > totalCapacity) {
                document.getElementById('chilling_currentCapacityError').style.display = 'block';
                isValid = false;
            }

            if (isNaN(temperature) || temperature < 0 || temperature > 10) {
                document.getElementById('chilling_temperatureError').style.display = 'block';
                isValid = false;
            }

            if (!status) {
                document.getElementById('chilling_statusError').style.display = 'block';
                isValid = false;
            }

            if (!energyType) {
                document.getElementById('chilling_energyTypeError').style.display = 'block';
                isValid = false;
            }

            return isValid;
        }

        // Handle add/edit form submit
        function chilling_handleFormSubmit(e) {
            e.preventDefault();

            if (!chilling_validateForm()) return;

            const id = document.getElementById('chilling_editId').value || 'CC-' + (1000 + Math.floor(Math.random() * 9000));
            const name = document.getElementById('chilling_centerName').value.trim();
            const location = document.getElementById('chilling_location').value.trim();
            const totalCapacity = parseInt(document.getElementById('chilling_totalCapacity').value, 10);
            const currentCapacity = parseInt(document.getElementById('chilling_currentCapacity').value, 10);
            const temperature = parseFloat(document.getElementById('chilling_temperature').value);
            const status = document.getElementById('chilling_status').value;
            const energyType = document.getElementById('chilling_energyType').value;

            const existingIndex = chilling_centersData.findIndex(c => c.id === id);
            const actionType = existingIndex >= 0 ? 'update' : 'add';

            if (existingIndex >= 0) {
                // Update existing center
                chilling_centersData[existingIndex] = {
                    ...chilling_centersData[existingIndex],
                    name,
                    location,
                    totalCapacity,
                    currentCapacity,
                    temperature,
                    status,
                    energyType,
                    lastUpdated: new Date().toISOString()
                };
                chilling_logActivity('update', `Updated center: ${name}`);
            } else {
                // Add new center
                chilling_centersData.push({
                    id,
                    name,
                    location,
                    totalCapacity,
                    currentCapacity,
                    temperature,
                    status,
                    energyType,
                    lastUpdated: new Date().toISOString()
                });
                chilling_logActivity('add', `Added new center: ${name}`);
            }

            chilling_closeForm();
            chilling_renderTable();
            chilling_updateSummary();
            chilling_drawAllCharts();
        }

        // Render table rows with progress bars
        function chilling_renderTable() {
            const tbody = document.getElementById('chilling_tableBody');
            tbody.innerHTML = '';

            chilling_centersData.sort((a, b) => b.lastUpdated.localeCompare(a.lastUpdated));

            chilling_centersData.forEach(center => {
                const tr = document.createElement('tr');

                // Calculate percentage for progress bar
                const percentage = Math.min(100, Math.round((center.currentCapacity / center.totalCapacity) * 100));

                // Format capacity with commas
                const formattedTotalCapacity = center.totalCapacity.toLocaleString();
                const formattedCurrentCapacity = center.currentCapacity.toLocaleString();

                tr.innerHTML = `
                    <td>${center.id}</td>
                    <td>${center.name}</td>
                    <td>${center.location}</td>
                    <td>
                        <div class="progress-label">${formattedCurrentCapacity} / ${formattedTotalCapacity} L</div>
                        <div class="capacity-progress">
                            <div class="capacity-progress-bar" style="width: ${percentage}%"></div>
                        </div>
                    </td>
                    <td>${center.temperature.toFixed(1)}Â°C</td>
                    <td><span class="status-badge status-${center.status.toLowerCase()}">${center.status}</span></td>
                    <td>${center.energyType}</td>
                    <td style="display:flex; gap:6px">
                        <button class="action-btn edit" onclick="chilling_showForm('${center.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="chilling_deleteCenter('${center.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Delete center
        function chilling_deleteCenter(id) {
            if (confirm('Are you sure you want to delete this chilling center?')) {
                const center = chilling_centersData.find(c => c.id === id);
                if (center) {
                    chilling_logActivity('delete', `Deleted center: ${center.name}`);
                }

                chilling_centersData = chilling_centersData.filter(c => c.id !== id);
                chilling_renderTable();
                chilling_updateSummary();
                chilling_drawAllCharts();
            }
        }

        // Update summary cards
        function chilling_updateSummary() {
            const totalCenters = chilling_centersData.length;
            const avgTemp = totalCenters
                ? (chilling_centersData.reduce((acc, c) => acc + c.temperature, 0) / totalCenters).toFixed(1)
                : 0;
            const totalCapacity = chilling_centersData.reduce((acc, c) => acc + c.totalCapacity, 0);
            const currentCapacity = chilling_centersData.reduce((acc, c) => acc + c.currentCapacity, 0);

            // Calculate energy mix
            const energyCounts = chilling_centersData.reduce((acc, c) => {
                acc[c.energyType] = (acc[c.energyType] || 0) + 1;
                return acc;
            }, {});

            let energyMix = "N/A";
            if (totalCenters > 0) {
                const solarPercentage = Math.round((energyCounts['Solar'] || 0) / totalCenters * 100);
                energyMix = `${solarPercentage}% Solar`;
            }

            document.getElementById('chilling_summary_totalCenters').textContent = totalCenters;
            document.getElementById('chilling_summary_avgTemp').textContent = `${avgTemp}Â°C`;
            document.getElementById('chilling_summary_totalCapacity').textContent = totalCapacity.toLocaleString() + ' L';
            document.getElementById('chilling_summary_currentCapacity').textContent = currentCapacity.toLocaleString() + ' L';
            document.getElementById('chilling_summary_energyMix').textContent = energyMix;
        }

        // Filter table rows by search input
        function chilling_filterTable() {
            const filter = document.getElementById('chilling_searchInput').value.toLowerCase();
            const rows = document.getElementById('chilling_tableBody').getElementsByTagName('tr');

            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            }
        }

        // Draw all charts
        function chilling_drawAllCharts() {
            chilling_drawTemperatureChart();
            chilling_drawCapacityChart();
            chilling_drawEnergyChart();
            chilling_drawTemperaturePerformanceChart();
        }

        // Draw Temperature Chart
        function chilling_drawTemperatureChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Center');
            data.addColumn('number', 'Temperature (Â°C)');

            chilling_centersData.forEach(c => {
                data.addRow([c.name, c.temperature]);
            });

            const options = {
                title: 'Current Temperatures',
                height: 300,
                colors: ['#4285F4'],
                hAxis: {
                    title: 'Chilling Centers',
                    slantedText: true,
                    slantedTextAngle: 45
                },
                vAxis: {
                    title: 'Temperature (Â°C)',
                    minValue: 0,
                    maxValue: 10
                },
                legend: { position: 'none' },
                chartArea: { width: '85%', height: '75%' }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chilling_temperatureChart'));
            chart.draw(data, options);
        }

        // Draw Capacity Chart
        function chilling_drawCapacityChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Center');
            data.addColumn('number', 'Total Capacity (L)');
            data.addColumn('number', 'Current Capacity (L)');

            chilling_centersData.forEach(c => {
                data.addRow([c.name, c.totalCapacity, c.currentCapacity]);
            });

            const options = {
                title: 'Capacity Utilization',
                height: 300,
                colors: ['#34A853', '#EA4335'],
                hAxis: {
                    title: 'Chilling Centers',
                    slantedText: true,
                    slantedTextAngle: 45
                },
                vAxis: { title: 'Capacity (L)' },
                isStacked: false,
                chartArea: { width: '85%', height: '75%' }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chilling_capacityChart'));
            chart.draw(data, options);
        }

        // Draw Energy Chart
        function chilling_drawEnergyChart() {
            const energyCounts = chilling_centersData.reduce((acc, c) => {
                acc[c.energyType] = (acc[c.energyType] || 0) + 1;
                return acc;
            }, {});

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Energy Source');
            data.addColumn('number', 'Count');

            for (const [energyType, count] of Object.entries(energyCounts)) {
                data.addRow([energyType, count]);
            }

            const options = {
                title: 'Energy Source Distribution',
                height: 300,
                pieHole: 0.4,
                colors: ['#4285F4', '#34A853', '#FBBC05', '#EA4335'],
                chartArea: { width: '90%', height: '90%' },
                pieSliceText: 'value',
                legend: { position: 'labeled' }
            };

            const chart = new google.visualization.PieChart(document.getElementById('chilling_energyChart'));
            chart.draw(data, options);
        }

        // Draw Temperature Performance Chart
        function chilling_drawTemperaturePerformanceChart() {
            // Generate mock temperature data for a day
            const times = ['6am', '8am', '10am', '12pm', '2pm', '4pm', '6pm'];
            const avgTemps = [4.2, 3.8, 3.5, 4.0, 4.5, 4.2, 3.9];

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Time');
            data.addColumn('number', 'Temperature (Â°C)');

            times.forEach((time, i) => {
                data.addRow([time, avgTemps[i]]);
            });

            const options = {
                title: 'Temperature Performance (24h)',
                height: 300,
                colors: ['#EA4335'],
                hAxis: { title: 'Time' },
                vAxis: {
                    title: 'Temperature (Â°C)',
                    minValue: 0,
                    maxValue: 5
                },
                curveType: 'function',
                legend: { position: 'none' },
                chartArea: { width: '85%', height: '75%' }
            };

            const chart = new google.visualization.LineChart(document.getElementById('chilling_tempPerformanceChart'));
            chart.draw(data, options);
        }

        // Log activity
        function chilling_logActivity(type, message) {
            const activity = {
                id: 'A-' + (1000 + Math.floor(Math.random() * 9000)),
                type,
                message,
                timestamp: new Date().toISOString()
            };

            chilling_activities.unshift(activity);
            chilling_renderActivity();

            // Highlight the activity container
            const container = document.getElementById('chilling_activityContainer');
            container.classList.add('highlight');
            setTimeout(() => container.classList.remove('highlight'), 1500);
        }

        // Render activity
        function chilling_renderActivity() {
            const container = document.getElementById('chilling_activityContainer');
            container.innerHTML = '';

            // Show latest 5 activities
            const recentActivities = chilling_activities.slice(0, 5);

            recentActivities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';

                let iconClass = 'fas fa-plus-circle';
                let iconColor = '#34a853';

                if (activity.type === 'update') {
                    iconClass = 'fas fa-edit';
                    iconColor = '#4285f4';
                } else if (activity.type === 'delete') {
                    iconClass = 'fas fa-trash-alt';
                    iconColor = '#ea4335';
                }

                const date = new Date(activity.timestamp);
                const timeString = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateString = date.toLocaleDateString();

                item.innerHTML = `
                    <div class="activity-icon" style="background-color: ${iconColor}20; color: ${iconColor}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.message}</div>
                        <div class="activity-time">${dateString} at ${timeString}</div>
                    </div>
                `;

                container.appendChild(item);
            });

            if (recentActivities.length === 0) {
                container.innerHTML = '<div class="activity-item"><div class="activity-content">No recent activity</div></div>';
            }
        }

        // Redraw charts on window resize for responsiveness
        window.addEventListener('resize', chilling_drawAllCharts);

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', chilling_init);
    </script>

    <!--processing plants-->
    <script>
        // Product options for dropdown
        const processingplants_PRODUCT_OPTIONS = [
            "Milk", "Cheese", "Butter", "Ice Cream",
            "Yogurt", "Ghee", "Paneer", "Cream",
            "Milk Powder", "Condensed Milk"
        ];

        // Sample initial data for processing section
        let processingplants_plantData = [
            {
                id: 1,
                name: "Alpha Milk Processing",
                location: "Delhi",
                capacity: 40000,
                status: "Active",
                manager: "Ajay Kumar",
                date: "2023-01-15",
                products: {
                    "Milk": 18000,
                    "Cheese": 8000,
                    "Butter": 6000,
                    "Ice Cream": 8000
                },
                activity: "New pasteurization line installed",
                timestamp: new Date('2023-01-15').getTime()
            },
            {
                id: 2,
                name: "Beta Dairy Complex",
                location: "Pune",
                capacity: 50000,
                status: "Active",
                manager: "Rita Sen",
                date: "2022-11-20",
                products: {
                    "Yogurt": 22000,
                    "Ice Cream": 15000,
                    "Ghee": 8000,
                    "Paneer": 5000
                },
                activity: "Increased production capacity",
                timestamp: new Date('2023-02-20').getTime()
            },
            {
                id: 3,
                name: "Gamma Agro Foods",
                location: "Lucknow",
                capacity: 45000,
                status: "Maintenance",
                manager: "Suresh Yadav",
                date: "2023-03-10",
                products: {
                    "Milk": 25000,
                    "Ghee": 10000,
                    "Paneer": 10000
                },
                activity: "Scheduled maintenance underway",
                timestamp: new Date('2023-03-10').getTime()
            },
            {
                id: 4,
                name: "Delta Dairy Processing",
                location: "Ahmedabad",
                capacity: 60000,
                status: "Active",
                manager: "Pooja Mehta",
                date: "2022-09-05",
                products: {
                    "Milk": 30000,
                    "Butter": 15000,
                    "Yogurt": 10000,
                    "Cream": 5000
                },
                activity: "New product line launched",
                timestamp: new Date('2023-04-05').getTime()
            },
            {
                id: 5,
                name: "Omega Milk Industries",
                location: "Bangalore",
                capacity: 55000,
                status: "Active",
                manager: "Rahul Desai",
                date: "2023-02-18",
                products: {
                    "Milk": 28000,
                    "Cheese": 15000,
                    "Ice Cream": 12000
                },
                activity: "Automation upgrade completed",
                timestamp: new Date('2023-05-18').getTime()
            },
            {
                id: 6,
                name: "Zeta Milk Products",
                location: "Chennai",
                capacity: 35000,
                status: "Inactive",
                manager: "Vikram Singh",
                date: "2022-12-01",
                products: {
                    "Milk Powder": 15000,
                    "Condensed Milk": 10000,
                    "Ghee": 10000
                },
                activity: "Facility temporarily closed",
                timestamp: new Date('2023-01-10').getTime()
            }
        ];

        let processingplants_editingPlantId = null;
        let processingplants_stackedBarChart = null;
        let processingplants_chartType = 'bar'; // 'bar' or 'horizontal'

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            processingplants_renderAll();
            document.getElementById('processingplants_Search').addEventListener('input', processingplants_renderAll);
            document.getElementById('processingplants_StatusFilter').addEventListener('change', processingplants_renderAll);
            document.getElementById('processingplants_SortBy').addEventListener('change', processingplants_renderAll);
            document.getElementById('processingplants_PlantCapacity').addEventListener('input', processingplants_validateCapacity);
        });

        function processingplants_renderAll() {
            processingplants_renderCards();
            processingplants_renderTable();
            processingplants_updateSummaryCards();
            processingplants_renderChart();
            processingplants_renderActivityLogs();
        }

        function processingplants_getFilteredPlants() {
            const name = document.getElementById('processingplants_Search').value.toLowerCase();
            const status = document.getElementById('processingplants_StatusFilter').value;
            const sortBy = document.getElementById('processingplants_SortBy').value;

            let filtered = processingplants_plantData.filter(p => {
                const matchName = !name || p.name.toLowerCase().includes(name);
                const matchStatus = !status || p.status === status;
                return matchName && matchStatus;
            });

            // Sorting
            filtered.sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name);
                } else if (sortBy === 'capacity') {
                    return b.capacity - a.capacity;
                } else {
                    return b.timestamp - a.timestamp;
                }
            });

            return filtered;
        }

        function processingplants_renderCards() {
            const container = document.getElementById('processingplants_CardView');
            container.innerHTML = '';
            const data = processingplants_getFilteredPlants();

            if (data.length === 0) {
                container.innerHTML = '<div class="no-data" style="text-align: center; padding: 2rem; color: #95a5a6;">No plants found matching your criteria</div>';
                return;
            }

            data.forEach(p => {
                const totalProducts = Object.values(p.products).reduce((a, b) => a + b, 0);
                const utilization = Math.min(100, Math.round((totalProducts / p.capacity) * 100));

                const card = document.createElement('div');
                card.className = 'plant-card';
                card.innerHTML = `
                    <div class="plant-header">
                        <div style="display:flex; justify-content:space-between;">
                        <h3 class="plant-name">${p.name}</h3>
                        <div class="plant-status ${processingplants_getStatusClass(p.status)}">${p.status}</div>
                        </div>
                        <div class="plant-location">
                            <i class="fas fa-map-marker-alt"></i> ${p.location}
                        </div>
                    </div>
                    <div class="plant-details">
                        <div class="plant-detail">
                            <span class="detail-label">Capacity</span>
                            <span class="detail-value">${p.capacity.toLocaleString()} L</span>
                        </div>
                        <div class="plant-detail">
                            <span class="detail-label">Utilization</span>
                            <span class="detail-value">${utilization}%</span>
                        </div>
                        <div class="plant-detail">
                            <span class="detail-label">Manager</span>
                            <span class="detail-value">${p.manager}</span>
                        </div>
                        <div class="plant-detail">
                            <span class="detail-label">Established</span>
                            <span class="detail-value">${processingplants_formatDate(p.date, true)}</span>
                        </div>
                    </div>
                    <div class="plant-products">
                        ${Object.entries(p.products).map(([k, v]) =>
                    `<span class="product-tag">${k}: ${v.toLocaleString()}L</span>`
                ).join('')}
                    </div>
                    <div class="plant-actions" style="display:flex; justify-content:space-around">
                        <button class="btn btn-edit" onclick="processingplants_editPlant(${p.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-delete" onclick="processingplants_deletePlant(${p.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function processingplants_getStatusClass(status) {
            switch (status) {
                case 'Active': return 'status-active';
                case 'Inactive': return 'status-inactive';
                case 'Maintenance': return 'status-maintenance';
                default: return '';
            }
        }

        function processingplants_renderTable() {
            const body = document.getElementById('processingplants_TableBody');
            body.innerHTML = '';
            const data = processingplants_getFilteredPlants();

            if (data.length === 0) {
                body.innerHTML = `<tr><td colspan="8" class="text-center" style="padding: 2rem; text-align: center; color: #95a5a6;">No plants found</td></tr>`;
                return;
            }

            data.forEach(p => {
                const totalProducts = Object.values(p.products).reduce((a, b) => a + b, 0);
                const utilization = Math.min(100, Math.round((totalProducts / p.capacity) * 100));

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-industry" style="color: #3498db;"></i>
                            <span>${p.name}</span>
                        </div>
                    </td>
                    <td>${p.location}</td>
                    <td>${p.capacity.toLocaleString()}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 60px; height: 6px; background: #ecf0f1; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${utilization}%; height: 100%; background: ${utilization > 90 ? '#e74c3c' : utilization > 75 ? '#f39c12' : '#2ecc71'};"></div>
                            </div>
                            <span>${utilization}%</span>
                        </div>
                    </td>
                    <td><span class="status ${processingplants_getStatusClass(p.status)}">${p.status}</span></td>
                    <td>${p.manager}</td>
                    <td>${Object.keys(p.products).length} products</td>
                    <td>
                        <div class="table-actions"  style="display:flex; gap:6px">
                            <button class="action-btn edit" onclick="processingplants_editPlant(${p.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="processingplants_deletePlant(${p.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                body.appendChild(row);
            });
        }

        function processingplants_updateSummaryCards() {
            // Always show overall stats, not filtered stats
            document.getElementById('processingplants_TotalPlants').textContent = processingplants_plantData.length;
            document.getElementById('processingplants_TotalCapacity').textContent =
                processingplants_plantData.reduce((a, b) => a + b.capacity, 0).toLocaleString() + ' L';
            document.getElementById('processingplants_ActivePlants').textContent =
                processingplants_plantData.filter(p => p.status === 'Active').length;
            document.getElementById('processingplants_TotalProducts').textContent =
                [...new Set(processingplants_plantData.flatMap(p => Object.keys(p.products)))].length;
        }

        function processingplants_toggleView(view) {
            document.getElementById('processingplants_CardView').style.display = view === 'cards' ? 'grid' : 'none';
            document.getElementById('processingplants_TableView').style.display = view === 'table' ? 'block' : 'none';
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.view-btn')[view === 'cards' ? 0 : 1].classList.add('active');
        }

        function processingplants_toggleChartType() {
            processingplants_chartType = processingplants_chartType === 'bar' ? 'horizontal' : 'bar';
            processingplants_renderChart();
        }

        function processingplants_openModal() {
            processingplants_editingPlantId = null;
            document.getElementById('processingplants_ModalTitle').innerHTML = '<i class="fas fa-industry"></i> Add Processing Plant';
            document.getElementById('processingplants_PlantName').value = '';
            document.getElementById('processingplants_PlantLocation').value = '';
            document.getElementById('processingplants_PlantCapacity').value = '';
            document.getElementById('processingplants_PlantStatus').value = 'Active';
            document.getElementById('processingplants_PlantManager').value = '';
            document.getElementById('processingplants_PlantDate').value = processingplants_formatDate(new Date(), false, true);

            // Reset product inputs
            const container = document.getElementById('processingplants_ProductInputs');
            container.innerHTML = `
                <div class="product-row">
                    <select class="form-control productName">
                        <option value="">Select Product</option>
                        ${processingplants_PRODUCT_OPTIONS.map(p => `<option value="${p}">${p}</option>`).join('')}
                    </select>
                    <input type="number" class="form-control productQty" min="0" placeholder="Liters">
                    <button class="btn-remove" onclick="processingplants_removeProduct(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            document.getElementById('processingplants_CapacityWarning').style.display = 'none';
            document.getElementById('processingplants_Modal').classList.add('active');
        }

        function processingplants_closeModal() {
            document.getElementById('processingplants_Modal').classList.remove('active');
        }

        function processingplants_addProduct() {
            const div = document.createElement('div');
            div.className = 'product-row';
            div.innerHTML = `
                <select class="form-control productName">
                    <option value="">Select Product</option>
                    ${processingplants_PRODUCT_OPTIONS.map(p => `<option value="${p}">${p}</option>`).join('')}
                </select>
                <input type="number" class="form-control productQty" min="0" placeholder="Liters">
                <button class="btn-remove" onclick="processingplants_removeProduct(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            document.getElementById('processingplants_ProductInputs').appendChild(div);
        }

        function processingplants_removeProduct(btn) {
            btn.parentElement.remove();
            processingplants_validateCapacity();
        }

        function processingplants_validateCapacity() {
            const capacity = parseInt(document.getElementById('processingplants_PlantCapacity').value) || 0;
            let totalProducts = 0;

            document.querySelectorAll('#processingplants_ProductInputs .product-row').forEach(row => {
                const qty = parseInt(row.querySelector('.productQty').value) || 0;
                totalProducts += qty;
            });

            const warning = document.getElementById('processingplants_CapacityWarning');
            if (totalProducts > capacity) {
                warning.style.display = 'block';
                warning.textContent = `Total products (${totalProducts}L) exceed capacity (${capacity}L)!`;
                return false;
            }

            warning.style.display = 'none';
            return true;
        }

        function processingplants_savePlant() {
            const name = document.getElementById('processingplants_PlantName').value.trim();
            const location = document.getElementById('processingplants_PlantLocation').value.trim();
            const capacity = parseInt(document.getElementById('processingplants_PlantCapacity').value);
            const status = document.getElementById('processingplants_PlantStatus').value;
            const manager = document.getElementById('processingplants_PlantManager').value.trim();
            const date = document.getElementById('processingplants_PlantDate').value;

            // Basic validation
            if (!name || !location || !manager || isNaN(capacity) || capacity <= 0) {
                alert('Please fill all required fields with valid values');
                return;
            }

            // Validate product quantities
            if (!processingplants_validateCapacity()) {
                return;
            }

            // Collect products
            const products = {};
            let hasProducts = false;

            document.querySelectorAll('#processingplants_ProductInputs .product-row').forEach(row => {
                const pname = row.querySelector('.productName').value;
                const pqty = parseInt(row.querySelector('.productQty').value) || 0;

                if (pname && pqty > 0) {
                    products[pname] = pqty;
                    hasProducts = true;
                }
            });

            if (!hasProducts) {
                alert('Please add at least one product');
                return;
            }

            // Create plant object
            const plant = {
                id: processingplants_editingPlantId || Date.now(),
                name,
                location,
                capacity,
                status,
                manager,
                date,
                products,
                activity: processingplants_editingPlantId ? 'Plant details updated' : 'New plant created',
                timestamp: Date.now()
            };

            // Save to data
            if (processingplants_editingPlantId) {
                const index = processingplants_plantData.findIndex(p => p.id === processingplants_editingPlantId);
                processingplants_plantData[index] = plant;
            } else {
                processingplants_plantData.push(plant);
            }

            processingplants_closeModal();
            processingplants_renderAll();
        }

        function processingplants_editPlant(id) {
            const p = processingplants_plantData.find(p => p.id === id);
            if (!p) return;

            processingplants_editingPlantId = id;
            document.getElementById('processingplants_ModalTitle').innerHTML = `<i class="fas fa-industry"></i> Edit Plant: ${p.name}`;
            document.getElementById('processingplants_PlantName').value = p.name;
            document.getElementById('processingplants_PlantLocation').value = p.location;
            document.getElementById('processingplants_PlantCapacity').value = p.capacity;
            document.getElementById('processingplants_PlantStatus').value = p.status;
            document.getElementById('processingplants_PlantManager').value = p.manager;
            document.getElementById('processingplants_PlantDate').value = p.date;

            const container = document.getElementById('processingplants_ProductInputs');
            container.innerHTML = '';

            Object.entries(p.products).forEach(([k, v]) => {
                const row = document.createElement('div');
                row.className = 'product-row';
                row.innerHTML = `
                    <select class="form-control productName">
                        <option value="">Select Product</option>
                        ${processingplants_PRODUCT_OPTIONS.map(prod =>
                    `<option value="${prod}" ${prod === k ? 'selected' : ''}>${prod}</option>`
                ).join('')}
                    </select>
                    <input type="number" class="form-control productQty" value="${v}" min="0" placeholder="Liters">
                    <button class="btn-remove" onclick="processingplants_removeProduct(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                container.appendChild(row);
            });

            document.getElementById('processingplants_CapacityWarning').style.display = 'none';
            document.getElementById('processingplants_Modal').classList.add('active');
        }

        function processingplants_deletePlant(id) {
            if (!confirm('Are you sure you want to delete this plant?')) return;

            processingplants_plantData = processingplants_plantData.filter(p => p.id !== id);
            processingplants_renderAll();
        }

        function processingplants_renderActivityLogs() {
            const logs = document.getElementById('processingplants_ActivityLogs');
            logs.innerHTML = '';

            // Sort by timestamp descending
            const recent = [...processingplants_plantData]
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 5);

            if (recent.length === 0) {
                logs.innerHTML = '<div class="no-activity" style="text-align: center; padding: 2rem; color: #95a5a6;">No recent activities</div>';
                return;
            }

            recent.forEach(p => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${p.name}</div>
                        <div class="activity-desc">${p.activity}</div>
                        <div class="activity-time">
                            <i class="far fa-clock"></i> ${processingplants_formatDate(p.timestamp)}
                        </div>
                    </div>
                `;
                logs.appendChild(item);
            });
        }

        function processingplants_formatDate(timestamp, dateOnly = false, inputFormat = false) {
            if (inputFormat) {
                const date = new Date();
                return date.toISOString().split('T')[0];
            }

            const date = new Date(timestamp);

            if (dateOnly) {
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }

            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function processingplants_renderChart() {
            const ctx = document.getElementById('processingplants_StackedBarChart').getContext('2d');

            // Destroy previous chart instance if exists
            if (processingplants_stackedBarChart) {
                processingplants_stackedBarChart.destroy();
            }

            // Prepare data
            const labels = processingplants_plantData.map(p => p.name);
            const products = [...new Set(processingplants_plantData.flatMap(p => Object.keys(p.products)))];

            // Generate colors for products
            const colors = [
                '#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6',
                '#1abc9c', '#d35400', '#c0392b', '#8e44ad', '#27ae60'
            ];

            const datasets = products.map((product, i) => {
                return {
                    label: product,
                    data: processingplants_plantData.map(p => p.products[product] || 0),
                    backgroundColor: colors[i % colors.length],
                    borderWidth: 1
                };
            });

            // Create chart
            processingplants_stackedBarChart = new Chart(ctx, {
                type: processingplants_chartType === 'bar' ? 'bar' : 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    indexAxis: processingplants_chartType === 'bar' ? 'x' : 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: processingplants_chartType === 'bar' ? 'Plants' : 'Liters',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: processingplants_chartType === 'bar' ? 'Liters' : 'Plants',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        title: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}L`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
    </script>

    <!--inventory-->
    <script>
        // Pre-filled inventory data with Indian dairy products
        let inventoryData = [
            { id: 2, name: "Mother Dairy Paneer", category: "Paneer", quantity: 85, price: 320, manufactureDate: "2023-10-20", expiry: "2023-11-10", supplier: "Mother Dairy" },
            { id: 3, name: "Nestle Curd", category: "Curd", quantity: 200, price: 45, manufactureDate: "2023-10-25", expiry: "2023-11-15", supplier: "Nestle" },
            { id: 5, name: "Local Farm Butter", category: "Butter", quantity: 30, price: 480, manufactureDate: "2023-10-10", expiry: "2023-12-10", supplier: "Local Farm" },
            { id: 7, name: "Mother Dairy Milk", category: "Milk", quantity: 95, price: 56, manufactureDate: "2023-10-28", expiry: "2023-11-08", supplier: "Mother Dairy" },
            { id: 8, name: "Nestle Paneer", category: "Paneer", quantity: 65, price: 340, manufactureDate: "2023-10-22", expiry: "2023-11-12", supplier: "Nestle" },
            { id: 9, name: "Local Farm Curd", category: "Curd", quantity: 40, price: 42, manufactureDate: "2023-10-26", expiry: "2023-11-16", supplier: "Local Farm" },
            { id: 10, name: "Mother Dairy Ghee", category: "Ghee", quantity: 75, price: 520, manufactureDate: "2023-09-15", expiry: "2024-01-20", supplier: "Mother Dairy" }
        ];

        // Recent activity log
        let activityLog = [
            { type: 'update', product: "Mother Dairy Paneer", time: "2023-10-29T14:30:00" },
            { type: 'low-stock', product: "Local Farm Butter", time: "2023-10-28T11:20:00" },
            { type: 'delete', product: "Expired Yogurt", time: "2023-10-27T16:45:00" }
        ];

        // DOM elements
        const inventory_inventoryBody = document.getElementById('inventory_inventoryBody');
        const inventory_activityList = document.getElementById('inventory_activityList');
        const inventory_totalProducts = document.getElementById('inventory_totalProducts');
        const inventory_totalStock = document.getElementById('inventory_totalStock');
        const inventory_inventoryValue = document.getElementById('inventory_inventoryValue');
        const inventory_lowStockItems = document.getElementById('inventory_lowStockItems');
        const inventory_searchInput = document.getElementById('inventory_searchInput');
        const inventory_applyFilters = document.getElementById('inventory_applyFilters');
        const inventory_resetFilters = document.getElementById('inventory_resetFilters');
        const inventory_addProductBtn = document.getElementById('inventory_addProductBtn');
        const inventory_productModal = document.getElementById('inventory_productModal');
        const inventory_productForm = document.getElementById('inventory_productForm');
        const inventory_saveProductBtn = document.getElementById('inventory_saveProductBtn');
        const inventory_cancelBtn = document.getElementById('inventory_cancelBtn');
        const inventory_closeModal = document.getElementById('inventory_closeModal');
        const inventory_toastContainer = document.getElementById('inventory_toastContainer');

        // Chart instances
        let inventory_categoryChart, inventory_valueChart;

        // Initialize the dashboard
        function inventory_initDashboard() {
            inventory_calculateInventoryStats();
            inventory_renderInventoryTable();
            inventory_renderActivityLog();
            inventory_renderCharts();
            inventory_setManufactureDate();
            inventory_setupEventListeners();
        }

        // Set manufacture date to today by default
        function inventory_setManufactureDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('inventory_manufactureDate').value = formattedDate;
        }

        // Calculate inventory statistics
        function inventory_calculateInventoryStats() {
            const totalProducts = inventoryData.length;
            const totalStock = inventoryData.reduce((sum, product) => sum + product.quantity, 0);
            const inventoryValue = inventoryData.reduce((sum, product) => sum + (product.quantity * product.price), 0);
            const lowStockItems = inventoryData.filter(p => p.quantity < 20 && p.quantity > 0).length;

            inventory_totalProducts.textContent = totalProducts;
            inventory_totalStock.textContent = `${totalStock} kg`;
            inventory_inventoryValue.textContent = `â‚¹${inventoryValue.toLocaleString('en-IN')}`;
            inventory_lowStockItems.textContent = lowStockItems;
        }

        // Render inventory table
        function inventory_renderInventoryTable() {
            inventory_inventoryBody.innerHTML = '';

            // Apply filters
            let filteredData = [...inventoryData];

            // Search filter
            const searchTerm = inventory_searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredData = filteredData.filter(p =>
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.category.toLowerCase().includes(searchTerm) ||
                    (p.supplier && p.supplier.toLowerCase().includes(searchTerm))
                );
            }

            // Category filter
            const category = document.getElementById('inventory_categoryFilter').value;
            if (category) {
                filteredData = filteredData.filter(p => p.category === category);
            }

            // Status filter
            const status = document.getElementById('inventory_statusFilter').value;
            if (status) {
                filteredData = filteredData.filter(p => {
                    if (status === 'in-stock') return p.quantity >= 20;
                    if (status === 'low-stock') return p.quantity < 20 && p.quantity > 0;
                    if (status === 'out-of-stock') return p.quantity === 0;
                    return true;
                });
            }

            // Expiry filter
            const expiry = document.getElementById('inventory_expiryFilter').value;
            if (expiry) {
                const today = new Date();
                filteredData = filteredData.filter(p => {
                    const expiryDate = new Date(p.expiry);
                    const diffTime = expiryDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (expiry === 'expired') return diffDays < 0;
                    if (expiry === 'safe') return diffDays > 30;
                    return diffDays > 0 && diffDays <= parseInt(expiry);
                });
            }

            // Supplier filter
            const supplier = document.getElementById('inventory_supplierFilter').value;
            if (supplier) {
                filteredData = filteredData.filter(p => p.supplier === supplier);
            }

            // Render rows
            filteredData.forEach(product => {
                const value = product.quantity * product.price;
                const today = new Date();
                const expiryDate = new Date(product.expiry);
                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                // Determine stock status
                let statusClass, statusText;
                if (product.quantity === 0) {
                    statusClass = 'status-out-of-stock';
                    statusText = 'Out of Stock';
                } else if (product.quantity < 20) {
                    statusClass = 'status-inactive';
                    statusText = 'Low Stock';
                } else {
                    statusClass = 'status-active';
                    statusText = 'In Stock';
                }

                // Determine expiry status
                let expiryClass, expiryText;
                if (diffDays < 0) {
                    expiryClass = 'expiry-expired';
                    expiryText = `Expired ${Math.abs(diffDays)} days ago`;
                } else if (diffDays <= 7) {
                    expiryClass = 'expiry-soon';
                    expiryText = `Expiring in ${diffDays} days`;
                } else if (diffDays <= 30) {
                    expiryClass = 'expiry-soon';
                    expiryText = `Expiring in ${diffDays} days`;
                } else {
                    expiryClass = 'expiry-safe';
                    expiryText = `Expires in ${diffDays} days`;
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.quantity}</td>
                    <td>â‚¹${product.price}</td>
                    <td>â‚¹${value.toLocaleString('en-IN')}</td>
                    <td>${inventory_formatDate(product.manufactureDate)}</td>
                    <td>
                        <span class="${expiryClass}">${expiryText}</span>
                        <div style="font-size:13px; margin-top:5px; color:#64748b">${inventory_formatDate(product.expiry)}</div>
                    </td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td style="display:flex; gap:6px">
                        <button class="btn btn-sm btn-outline" onclick="inventory_editProduct(${product.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="inventory_deleteProduct(${product.id}, '${product.name}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                inventory_inventoryBody.appendChild(row);
            });
        }

        // Render activity log
        function inventory_renderActivityLog() {
            inventory_activityList.innerHTML = '';

            activityLog.forEach(activity => {
                const activityDate = new Date(activity.time);
                const timeString = activityDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateString = activityDate.toLocaleDateString();

                let iconClass, icon, bgClass, actionText;

                switch (activity.type) {
                    case 'add':
                        iconClass = 'bg-green';
                        icon = 'fa-plus';
                        actionText = 'New product added';
                        break;
                    case 'update':
                        iconClass = 'bg-blue';
                        icon = 'fa-sync';
                        actionText = 'Product updated';
                        break;
                    case 'delete':
                        iconClass = 'bg-red';
                        icon = 'fa-trash';
                        actionText = 'Product deleted';
                        break;
                    case 'low-stock':
                        iconClass = 'bg-orange';
                        icon = 'fa-exclamation-triangle';
                        actionText = 'Low stock alert';
                        break;
                    default:
                        iconClass = 'bg-blue';
                        icon = 'fa-info-circle';
                        actionText = 'Activity';
                }

                const item = document.createElement('li');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon ${iconClass}">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="activity-content">
                        <h4>${actionText}</h4>
                        <p>${activity.product}</p>
                        <div class="activity-time">${dateString} at ${timeString}</div>
                    </div>
                `;
                inventory_activityList.appendChild(item);
            });
        }

        // Format date as DD/MM/YYYY
        function inventory_formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Render charts
        function inventory_renderCharts() {
            // Destroy existing charts if they exist
            if (inventory_categoryChart) inventory_categoryChart.destroy();
            if (inventory_valueChart) inventory_valueChart.destroy();

            // Group data by category
            const categories = [...new Set(inventoryData.map(p => p.category))];
            const categoryData = {};

            categories.forEach(cat => {
                const products = inventoryData.filter(p => p.category === cat);
                const totalQuantity = products.reduce((sum, p) => sum + p.quantity, 0);
                categoryData[cat] = totalQuantity;
            });

            // Category distribution chart
            const categoryCtx = document.getElementById('inventory_categoryChart').getContext('2d');
            inventory_categoryChart = new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: categories.map(cat => categoryData[cat]),
                        backgroundColor: [
                            '#4a6fa5', '#ff9800', '#4caf50', '#f44336', '#9c27b0', '#00bcd4'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: ${context.raw} kg`;
                                }
                            }
                        }
                    }
                }
            });

            // Top 5 products by value
            const sortedByValue = [...inventoryData]
                .sort((a, b) => (b.quantity * b.price) - (a.quantity * a.price))
                .slice(0, 5);

            const valueCtx = document.getElementById('inventory_valueChart').getContext('2d');
            inventory_valueChart = new Chart(valueCtx, {
                type: 'bar',
                data: {
                    labels: sortedByValue.map(p => p.name),
                    datasets: [{
                        label: 'Inventory Value (â‚¹)',
                        data: sortedByValue.map(p => p.quantity * p.price),
                        backgroundColor: '#3498db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return 'â‚¹' + value.toLocaleString('en-IN');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Set up event listeners
        function inventory_setupEventListeners() {
            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all buttons
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));

                    // Add active class to clicked button
                    btn.classList.add('active');
                    // Show corresponding tab content
                    document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
                });
            });

            // Apply filters
            inventory_applyFilters.addEventListener('click', inventory_renderInventoryTable);

            // Reset filters
            inventory_resetFilters.addEventListener('click', () => {
                document.getElementById('inventory_categoryFilter').value = '';
                document.getElementById('inventory_statusFilter').value = '';
                document.getElementById('inventory_expiryFilter').value = '';
                document.getElementById('inventory_supplierFilter').value = '';
                inventory_searchInput.value = '';
                inventory_renderInventoryTable();
            });

            // Search
            inventory_searchInput.addEventListener('input', inventory_renderInventoryTable);

            // Add product
            inventory_addProductBtn.addEventListener('click', () => {
                inventory_productForm.reset();
                document.getElementById('inventory_productId').value = '';
                document.getElementById('inventory_modalTitle').innerHTML = '<i class="fas fa-cube"></i> Add New Product';
                inventory_setManufactureDate();
                inventory_productModal.classList.add('active');
            });

            // Save product
            inventory_saveProductBtn.addEventListener('click', inventory_saveProduct);

            // Close modal
            inventory_closeModal.addEventListener('click', () => {
                inventory_productModal.classList.remove('active');
            });

            inventory_cancelBtn.addEventListener('click', () => {
                inventory_productModal.classList.remove('active');
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === inventory_productModal) {
                    inventory_productModal.classList.remove('active');
                }
            });
        }

        // Edit product
        function inventory_editProduct(id) {
            const product = inventoryData.find(p => p.id === id);
            if (product) {
                document.getElementById('inventory_productId').value = product.id;
                document.getElementById('inventory_productName').value = product.name;
                document.getElementById('inventory_productCategory').value = product.category;
                document.getElementById('inventory_quantity').value = product.quantity;
                document.getElementById('inventory_price').value = product.price;
                document.getElementById('inventory_manufactureDate').value = product.manufactureDate;
                document.getElementById('inventory_expiryDate').value = product.expiry;
                document.getElementById('inventory_supplier').value = product.supplier || '';

                document.getElementById('inventory_modalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Product';
                inventory_productModal.classList.add('active');
            }
        }

        // Save product (add or update)
        function inventory_saveProduct() {
            if (!inventory_productForm.checkValidity()) {
                inventory_showToast('Please fill in all required fields', 'toast-error');
                return;
            }

            const id = parseInt(document.getElementById('inventory_productId').value) || 0;
            const name = document.getElementById('inventory_productName').value;
            const category = document.getElementById('inventory_productCategory').value;
            const quantity = parseInt(document.getElementById('inventory_quantity').value);
            const price = parseFloat(document.getElementById('inventory_price').value);
            const manufactureDate = document.getElementById('inventory_manufactureDate').value;
            const expiry = document.getElementById('inventory_expiryDate').value;
            const supplier = document.getElementById('inventory_supplier').value;

            // Validate expiry date
            const mfgDate = new Date(manufactureDate);
            const expDate = new Date(expiry);
            if (expDate <= mfgDate) {
                inventory_showToast('Expiry date must be after manufacture date', 'toast-error');
                return;
            }

            if (id) {
                // Update existing product
                const index = inventoryData.findIndex(p => p.id === id);
                if (index !== -1) {
                    inventoryData[index] = {
                        ...inventoryData[index],
                        name, category, quantity, price,
                        manufactureDate, expiry, supplier
                    };

                    // Log activity
                    activityLog.unshift({
                        type: 'update',
                        product: name,
                        time: new Date().toISOString()
                    });

                    inventory_showToast('Product updated successfully!', 'toast-success');
                }
            } else {
                // Add new product
                const newId = Math.max(...inventoryData.map(p => p.id), 0) + 1;
                inventoryData.push({
                    id: newId,
                    name,
                    category,
                    quantity,
                    price,
                    manufactureDate,
                    expiry,
                    supplier
                });

                // Log activity
                activityLog.unshift({
                    type: 'add',
                    product: name,
                    time: new Date().toISOString()
                });

                inventory_showToast('Product added successfully!', 'toast-success');
            }

            // Update UI
            inventory_calculateInventoryStats();
            inventory_renderInventoryTable();
            inventory_renderActivityLog();
            inventory_renderCharts();
            inventory_productModal.classList.remove('active');
        }

        // Delete product
        function inventory_deleteProduct(id, name) {
            if (confirm(`Are you sure you want to delete "${name}"?`)) {
                const index = inventoryData.findIndex(p => p.id === id);
                if (index !== -1) {
                    inventoryData.splice(index, 1);

                    // Log activity
                    activityLog.unshift({
                        type: 'delete',
                        product: name,
                        time: new Date().toISOString()
                    });

                    inventory_showToast('Product deleted successfully!', 'toast-success');

                    // Update UI
                    inventory_calculateInventoryStats();
                    inventory_renderInventoryTable();
                    inventory_renderActivityLog();
                    inventory_renderCharts();
                }
            }
        }

        // Show toast notification
        function inventory_showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'toast-success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <div class="toast-content">
                    <div>${message}</div>
                </div>
            `;
            inventory_toastContainer.appendChild(toast);

            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize the dashboard when page loads
        window.addEventListener('DOMContentLoaded', inventory_initDashboard);
    </script>

    <!--distribution and logistics-->
    <script>
        // Delivery data with unique variable names
        let dandl_deliveries = [
            {
                id: "D001",
                customer: "Ravi Dairy",
                product: "Full Cream Milk",
                quantity: "500L",
                date: "2025-06-21",
                address: "Hyderabad",
                amount: "â‚¹12,000",
                status: "Delivered",
                deliveryTime: 4.2,
                region: "Hyderabad"
            },
            {
                id: "D002",
                customer: "Sujatha Stores",
                product: "Paneer",
                quantity: "80kg",
                date: "2025-06-22",
                address: "Vijayawada",
                amount: "â‚¹6,400",
                status: "Pending",
                deliveryTime: null,
                region: "Vijayawada"
            },
            {
                id: "D003",
                customer: "Milk Magic",
                product: "Toned Milk",
                quantity: "300L",
                date: "2025-06-20",
                address: "Guntur",
                amount: "â‚¹7,500",
                status: "In Transit",
                deliveryTime: 5.8,
                region: "Guntur"
            },
            {
                id: "D004",
                customer: "Fresh Foods",
                product: "Butter",
                quantity: "50kg",
                date: "2025-06-23",
                address: "Visakhapatnam",
                amount: "â‚¹9,000",
                status: "In Transit",
                deliveryTime: 6.3,
                region: "Visakhapatnam"
            },
            {
                id: "D005",
                customer: "Urban Dairy",
                product: "Ghee",
                quantity: "25L",
                date: "2025-06-19",
                address: "Nellore",
                amount: "â‚¹10,500",
                status: "Delivered",
                deliveryTime: 3.7,
                region: "Nellore"
            },
            {
                id: "D006",
                customer: "City Supermarket",
                product: "Yogurt",
                quantity: "200 units",
                date: "2025-06-24",
                address: "Hyderabad",
                amount: "â‚¹8,500",
                status: "Delivered",
                deliveryTime: 4.5,
                region: "Hyderabad"
            },
            {
                id: "D007",
                customer: "Daily Needs",
                product: "Full Cream Milk",
                quantity: "350L",
                date: "2025-06-25",
                address: "Vijayawada",
                amount: "â‚¹9,800",
                status: "In Transit",
                deliveryTime: 5.2,
                region: "Vijayawada"
            },
            {
                id: "D008",
                customer: "Organic Mart",
                product: "Paneer",
                quantity: "60kg",
                date: "2025-06-18",
                address: "Guntur",
                amount: "â‚¹5,400",
                status: "Cancelled",
                deliveryTime: null,
                region: "Guntur"
            }
        ];

        // Chart instances
        let dandl_volumeChart, dandl_statusChart, dandl_regionChart, dandl_deliveryTimeChart;

        // Initialize dashboard
        document.addEventListener("DOMContentLoaded", () => {
            // Set up event listeners
            document.getElementById('dandl_delivery_form').addEventListener('submit', handle_dandl_delivery_submit);
            document.getElementById('dandl_add_delivery_btn').addEventListener('click', open_dandl_delivery_modal);
            document.querySelector('.modal-close').addEventListener('click', close_dandl_delivery_modal);
            document.getElementById('dandl_cancel_btn').addEventListener('click', close_dandl_delivery_modal);
            document.getElementById('dandl_time_filter').addEventListener('change', render_dandl_all_charts);
            document.getElementById('dandl_region_filter').addEventListener('change', render_dandl_delivery_time_chart);
            document.getElementById('dandl_search_input').addEventListener('input', filter_dandl_deliveries);
            document.getElementById('dandl_status_filter').addEventListener('change', filter_dandl_deliveries);
            document.getElementById('dandl_region_table_filter').addEventListener('change', filter_dandl_deliveries);

            // Initialize dashboard
            update_dandl_dashboard();
            render_dandl_deliveries_table();
            render_dandl_all_charts();
        });

        // Update all dashboard components
        function update_dandl_dashboard() {
            // Calculate metrics
            const totalDeliveries = dandl_deliveries.length;
            const deliveredCount = dandl_deliveries.filter(d => d.status === "Delivered").length;
            const onTimeRate = totalDeliveries > 0 ? Math.round((deliveredCount / totalDeliveries) * 100) : 0;

            // Calculate average delivery time for delivered orders
            const deliveredOrders = dandl_deliveries.filter(d => d.status === "Delivered" && d.deliveryTime);
            const totalDeliveryTime = deliveredOrders.reduce((sum, order) => sum + order.deliveryTime, 0);
            const avgDeliveryTime = deliveredOrders.length > 0 ? (totalDeliveryTime / deliveredOrders.length).toFixed(1) : 0;

            // Generate fuel efficiency based on average delivery time
            const fuelEfficiency = (12.5 - (avgDeliveryTime * 0.2)).toFixed(1);

            // Calculate trends (random but plausible)
            const deliveriesChange = (Math.random() * 10).toFixed(1);
            const onTimeChange = (Math.random() * 5).toFixed(1);
            const deliveryTimeChange = (Math.random() * 1.5).toFixed(1);
            const fuelChange = (Math.random() * 0.5).toFixed(1);

            // Update summary cards
            document.getElementById("dandl_total_deliveries").textContent = totalDeliveries;
            document.getElementById("dandl_on_time_rate").textContent = `${onTimeRate}%`;
            document.getElementById("dandl_avg_delivery_time").textContent = `${avgDeliveryTime} hrs`;
            document.getElementById("dandl_fuel_efficiency").textContent = `${fuelEfficiency} km/L`;

            // Update trends
            document.getElementById("dandl_deliveries_change").textContent = `${deliveriesChange}%`;
            document.getElementById("dandl_on_time_change").textContent = `${onTimeChange}%`;
            document.getElementById("dandl_delivery_time_change").textContent = `${deliveryTimeChange} hrs`;
            document.getElementById("dandl_fuel_change").textContent = `${fuelChange} km/L`;
        }

        // Render delivery table
        function render_dandl_deliveries_table() {
            const tbody = document.getElementById("dandl_deliveries_table_body");
            tbody.innerHTML = "";

            dandl_deliveries.forEach(delivery => {
                const row = document.createElement("tr");
                row.dataset.id = delivery.id;

                row.innerHTML = `
                    <td>${delivery.id}</td>
                    <td>${delivery.customer}</td>
                    <td>${delivery.product}</td>
                    <td>${delivery.quantity}</td>
                    <td>${format_dandl_date(delivery.date)}</td>
                    <td>${delivery.address}</td>
                    <td>${delivery.amount}</td>
                    <td><span class="status-${delivery.status.toLowerCase().replace(' ', '-')}">${delivery.status}</span></td>
                    <td class="actions" style="display:flex; gap:6px">
                        <button class="action-btn edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;

                tbody.appendChild(row);
            });

            // Add event listeners to action buttons
            document.querySelectorAll('.edit').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deliveryId = this.closest('tr').dataset.id;
                    edit_dandl_delivery(deliveryId);
                });
            });

            document.querySelectorAll('.delete').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deliveryId = this.closest('tr').dataset.id;
                    delete_dandl_delivery(deliveryId);
                });
            });
        }

        // Format date for display
        function format_dandl_date(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // Render all charts
        function render_dandl_all_charts() {
            render_dandl_volume_chart();
            render_dandl_status_chart();
            render_dandl_region_chart();
            render_dandl_delivery_time_chart();
        }

        // Render delivery volume chart
        function render_dandl_volume_chart() {
            const ctx = document.getElementById("dandl_deliveryVolumeChart").getContext("2d");

            // Destroy existing chart if it exists
            if (dandl_volumeChart) dandl_volumeChart.destroy();

            const range = document.getElementById("dandl_time_filter").value;
            const labels = ["Full Cream Milk", "Toned Milk", "Paneer", "Butter", "Ghee", "Yogurt"];

            // Generate data based on selected range
            const data = labels.map(() => Math.floor(Math.random() * 1000) + 200);

            dandl_volumeChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Volume (L/Kg)",
                        data: data,
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(201, 203, 207, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: `Delivery Volume (Last ${range} Days)`,
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Volume (L/Kg)',
                                font: { size: 14 }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Products',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        // Render status distribution chart
        function render_dandl_status_chart() {
            const ctx = document.getElementById("dandl_statusDistributionChart").getContext("2d");

            // Destroy existing chart if it exists
            if (dandl_statusChart) dandl_statusChart.destroy();

            // Count statuses
            const statusCounts = {
                Delivered: dandl_deliveries.filter(d => d.status === "Delivered").length,
                Pending: dandl_deliveries.filter(d => d.status === "Pending").length,
                "In Transit": dandl_deliveries.filter(d => d.status === "In Transit").length,
                Cancelled: dandl_deliveries.filter(d => d.status === "Cancelled").length
            };

            dandl_statusChart = new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: ["Delivered", "Pending", "In Transit", "Cancelled"],
                    datasets: [{
                        data: [
                            statusCounts.Delivered,
                            statusCounts.Pending,
                            statusCounts["In Transit"],
                            statusCounts.Cancelled
                        ],
                        backgroundColor: ["#10b981", "#f59e0b", "#3b82f6", "#ef4444"]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Delivery Status Distribution',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }

        // Render region performance chart
        function render_dandl_region_chart() {
            const ctx = document.getElementById("dandl_regionPerformanceChart").getContext("2d");

            // Destroy existing chart if it exists
            if (dandl_regionChart) dandl_regionChart.destroy();

            // Group by region
            const regions = {};
            dandl_deliveries.forEach(delivery => {
                if (!regions[delivery.region]) {
                    regions[delivery.region] = 0;
                }
                regions[delivery.region]++;
            });

            const sortedRegions = Object.entries(regions)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const regionLabels = sortedRegions.map(r => r[0]);
            const regionData = sortedRegions.map(r => r[1]);

            dandl_regionChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: regionLabels,
                    datasets: [{
                        label: "Deliveries",
                        data: regionData,
                        backgroundColor: "rgba(74, 108, 247, 0.7)",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Regional Delivery Performance',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Deliveries',
                                font: { size: 14 }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Regions',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        // Render delivery time analysis chart
        function render_dandl_delivery_time_chart() {
            const ctx = document.getElementById("dandl_deliveryTimeChart").getContext("2d");
            const selectedRegion = document.getElementById("dandl_region_filter").value;

            // Destroy existing chart if it exists
            if (dandl_deliveryTimeChart) dandl_deliveryTimeChart.destroy();

            // Filter data
            let filteredDeliveries = dandl_deliveries;
            if (selectedRegion) {
                filteredDeliveries = dandl_deliveries.filter(d => d.region === selectedRegion);
            }

            // Group by product
            const productTimes = {};
            filteredDeliveries.forEach(delivery => {
                if (delivery.deliveryTime) {
                    if (!productTimes[delivery.product]) {
                        productTimes[delivery.product] = {
                            total: 0,
                            count: 0
                        };
                    }
                    productTimes[delivery.product].total += delivery.deliveryTime;
                    productTimes[delivery.product].count++;
                }
            });

            const products = Object.keys(productTimes);
            const avgTimes = products.map(product =>
                (productTimes[product].total / productTimes[product].count).toFixed(1)
            );

            dandl_deliveryTimeChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: products,
                    datasets: [{
                        label: "Avg. Delivery Time (hrs)",
                        data: avgTimes,
                        backgroundColor: "rgba(139, 92, 246, 0.2)",
                        borderColor: "rgba(139, 92, 246, 1)",
                        borderWidth: 3,
                        tension: 0.3,
                        pointRadius: 6,
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: selectedRegion
                                ? `Delivery Times in ${selectedRegion}`
                                : 'Delivery Time Analysis',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            title: {
                                display: true,
                                text: 'Hours',
                                font: { size: 14 }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Products',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        // Filter deliveries
        function filter_dandl_deliveries() {
            const searchTerm = document.getElementById("dandl_search_input").value.toLowerCase();
            const statusFilter = document.getElementById("dandl_status_filter").value;
            const regionFilter = document.getElementById("dandl_region_table_filter").value;

            const filtered = dandl_deliveries.filter(d => {
                const matchesSearch = d.customer.toLowerCase().includes(searchTerm) ||
                    d.product.toLowerCase().includes(searchTerm) ||
                    d.address.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter ? d.status === statusFilter : true;
                const matchesRegion = regionFilter ? d.region === regionFilter : true;
                return matchesSearch && matchesStatus && matchesRegion;
            });

            // Render filtered results
            const tbody = document.getElementById("dandl_deliveries_table_body");
            tbody.innerHTML = "";

            filtered.forEach(delivery => {
                const row = document.createElement("tr");
                row.dataset.id = delivery.id;

                row.innerHTML = `
                    <td>${delivery.id}</td>
                    <td>${delivery.customer}</td>
                    <td>${delivery.product}</td>
                    <td>${delivery.quantity}</td>
                    <td>${format_dandl_date(delivery.date)}</td>
                    <td>${delivery.address}</td>
                    <td>${delivery.amount}</td>
                    <td><span class="status-${delivery.status.toLowerCase().replace(' ', '-')}">${delivery.status}</span></td>
                    <td class="actions">
                        <button class="action-btn edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Reattach event listeners
            document.querySelectorAll('.edit').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deliveryId = this.closest('tr').dataset.id;
                    edit_dandl_delivery(deliveryId);
                });
            });

            document.querySelectorAll('.delete').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deliveryId = this.closest('tr').dataset.id;
                    delete_dandl_delivery(deliveryId);
                });
            });
        }

        // Open delivery modal
        function open_dandl_delivery_modal() {
            document.getElementById("dandl_delivery_modal").classList.add("active");
            document.getElementById("dandl_delivery_form").reset();
            document.getElementById("dandl_edit_id").value = "";
            document.getElementById("dandl_modal_title").textContent = "Add New Delivery";
            document.getElementById("dandl_date").valueAsDate = new Date();

            // Reset error states
            document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.form-control').forEach(el => el.classList.remove('invalid'));
        }

        // Close delivery modal
        function close_dandl_delivery_modal() {
            document.getElementById("dandl_delivery_modal").classList.remove("active");
        }

        // Form validation
        function validate_dandl_form() {
            let isValid = true;

            // Customer validation
            const customer = document.getElementById("dandl_customer").value.trim();
            if (!customer || customer.length < 3) {
                document.getElementById("dandl_customer_error").style.display = 'block';
                document.getElementById("dandl_customer").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_customer_error").style.display = 'none';
                document.getElementById("dandl_customer").classList.remove('invalid');
            }

            // Product validation
            const product = document.getElementById("dandl_product").value;
            if (!product) {
                document.getElementById("dandl_product_error").style.display = 'block';
                document.getElementById("dandl_product").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_product_error").style.display = 'none';
                document.getElementById("dandl_product").classList.remove('invalid');
            }

            // Quantity validation
            const quantity = document.getElementById("dandl_quantity").value.trim();
            const quantityRegex = /^\d+\s*(kg|L|units)$/i;
            if (!quantity || !quantityRegex.test(quantity)) {
                document.getElementById("dandl_quantity_error").style.display = 'block';
                document.getElementById("dandl_quantity").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_quantity_error").style.display = 'none';
                document.getElementById("dandl_quantity").classList.remove('invalid');
            }

            // Date validation
            const date = document.getElementById("dandl_date").value;
            if (!date) {
                document.getElementById("dandl_date_error").style.display = 'block';
                document.getElementById("dandl_date").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_date_error").style.display = 'none';
                document.getElementById("dandl_date").classList.remove('invalid');
            }

            // Address validation
            const address = document.getElementById("dandl_address").value.trim();
            if (!address || address.length < 5) {
                document.getElementById("dandl_address_error").style.display = 'block';
                document.getElementById("dandl_address").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_address_error").style.display = 'none';
                document.getElementById("dandl_address").classList.remove('invalid');
            }

            // Amount validation
            const amount = document.getElementById("dandl_amount").value;
            if (!amount || isNaN(amount) || amount <= 0) {
                document.getElementById("dandl_amount_error").style.display = 'block';
                document.getElementById("dandl_amount").classList.add('invalid');
                isValid = false;
            } else {
                document.getElementById("dandl_amount_error").style.display = 'none';
                document.getElementById("dandl_amount").classList.remove('invalid');
            }

            return isValid;
        }

        // Handle delivery form submission
        function handle_dandl_delivery_submit(e) {
            e.preventDefault();

            if (!validate_dandl_form()) return;

            // Get form values
            const customer = document.getElementById("dandl_customer").value.trim();
            const product = document.getElementById("dandl_product").value;
            const quantity = document.getElementById("dandl_quantity").value.trim();
            const date = document.getElementById("dandl_date").value;
            const address = document.getElementById("dandl_address").value.trim();
            const amount = document.getElementById("dandl_amount").value;
            const status = document.getElementById("dandl_status").value;
            const editId = document.getElementById("dandl_edit_id").value;

            // Extract region from address (simple implementation)
            const regions = ["Hyderabad", "Vijayawada", "Guntur", "Visakhapatnam", "Nellore"];
            const foundRegion = regions.find(region => address.includes(region));
            const region = foundRegion || "Other";

            // Generate delivery time based on region and status
            let deliveryTime = null;
            if (status === "Delivered") {
                // Base time + random variation
                deliveryTime = parseFloat((4 + Math.random() * 3).toFixed(1));
            }

            // Create delivery object
            const delivery = {
                id: editId || `D${String(dandl_deliveries.length + 1).padStart(3, '0')}`,
                customer,
                product,
                quantity,
                date,
                address,
                amount: `â‚¹${parseInt(amount).toLocaleString('en-IN')}`,
                status,
                deliveryTime,
                region
            };

            // Add or update delivery
            if (editId) {
                const index = dandl_deliveries.findIndex(d => d.id === editId);
                if (index !== -1) {
                    dandl_deliveries[index] = delivery;
                }
            } else {
                dandl_deliveries.push(delivery);
            }

            // Update UI
            close_dandl_delivery_modal();
            update_dandl_dashboard();
            render_dandl_deliveries_table();
            render_dandl_all_charts();

            // Highlight the updated row
            const row = document.querySelector(`tr[data-id="${delivery.id}"]`);
            if (row) {
                row.classList.add('highlight-row');
                setTimeout(() => {
                    row.classList.remove('highlight-row');
                }, 2000);
            }
        }

        // Edit delivery
        function edit_dandl_delivery(id) {
            const delivery = dandl_deliveries.find(d => d.id === id);
            if (!delivery) return;

            open_dandl_delivery_modal();
            document.getElementById("dandl_edit_id").value = delivery.id;
            document.getElementById("dandl_customer").value = delivery.customer;
            document.getElementById("dandl_product").value = delivery.product;
            document.getElementById("dandl_quantity").value = delivery.quantity;
            document.getElementById("dandl_date").value = delivery.date;
            document.getElementById("dandl_address").value = delivery.address;
            document.getElementById("dandl_amount").value = delivery.amount.replace('â‚¹', '').replace(/,/g, '');
            document.getElementById("dandl_status").value = delivery.status;
            document.getElementById("dandl_modal_title").textContent = "Edit Delivery";
        }

        // Delete delivery
        function delete_dandl_delivery(id) {
            if (!confirm("Are you sure you want to delete this delivery?")) return;

            dandl_deliveries = dandl_deliveries.filter(d => d.id !== id);
            update_dandl_dashboard();
            render_dandl_deliveries_table();
            render_dandl_all_charts();
        }
    </script>

    <!--retail and franchise-->
    <script>
        // Data
        let randf_outlets = [];
        let randf_recentActivities = [];
        let randf_editId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            randf_loadData();
            randf_setupEventListeners();
            randf_renderAll();
        });

        function randf_loadData() {
            const savedOutlets = localStorage.getItem("randf_outlets");
            const savedActivities = localStorage.getItem("randf_activities");

            randf_outlets = savedOutlets ? JSON.parse(savedOutlets) : randf_getSampleOutlets();
            randf_recentActivities = savedActivities ? JSON.parse(savedActivities) : randf_getSampleActivities();

            if (!savedOutlets) randf_saveData();
            if (!savedActivities) randf_saveActivities();
        }

        function randf_saveData() {
            localStorage.setItem("randf_outlets", JSON.stringify(randf_outlets));
        }

        function randf_saveActivities() {
            localStorage.setItem("randf_activities", JSON.stringify(randf_recentActivities));
        }

        function randf_getSampleOutlets() {
            return [
                {
                    id: randf_generateId(),
                    name: "Mother Dairy Franchise",
                    type: "franchise",
                    zone: "west",
                    owner: "Sunita Sharma",
                    contact: "9823456789",
                    status: "pending",
                    rating: 4.5,
                    revenue: 185000,
                    expenses: 105000,
                    latitude: 19.0760,
                    longitude: 72.8777,
                    created: "2023-07-22"
                },
                {
                    id: randf_generateId(),
                    name: "Dairy Pure Retail",
                    type: "retail",
                    zone: "south",
                    owner: "Vijay Anand",
                    contact: "9834567890",
                    status: "active",
                    rating: 3.5,
                    revenue: 95000,
                    expenses: 55000,
                    latitude: 13.0827,
                    longitude: 80.2707,
                    created: "2023-06-10"
                },
                {
                    id: randf_generateId(),
                    name: "Fresh Farms Franchise",
                    type: "franchise",
                    zone: "east",
                    owner: "Anjali Mehta",
                    contact: "9845678901",
                    status: "setup",
                    rating: 4,
                    revenue: 145000,
                    expenses: 90000,
                    latitude: 22.5726,
                    longitude: 88.3639,
                    created: "2023-08-05"
                },
                {
                    id: randf_generateId(),
                    name: "Organic Dairy Hub",
                    type: "retail",
                    zone: "north",
                    owner: "Rajesh Patel",
                    contact: "9856789012",
                    status: "inactive",
                    rating: 3,
                    revenue: 65000,
                    expenses: 50000,
                    latitude: 26.8467,
                    longitude: 80.9462,
                    created: "2023-04-18"
                },
                {
                    id: randf_generateId(),
                    name: "Golden Milk Retail",
                    type: "retail",
                    zone: "south",
                    owner: "Priya Reddy",
                    contact: "9876543210",
                    status: "active",
                    rating: 4.5,
                    revenue: 210000,
                    expenses: 120000,
                    latitude: 12.9716,
                    longitude: 77.5946,
                    created: "2023-09-12"
                },
                {
                    id: randf_generateId(),
                    name: "Healthy Cow Franchise",
                    type: "franchise",
                    zone: "south",
                    owner: "Karthik Rajan",
                    contact: "9876543214",
                    status: "inactive",
                    rating: 2.5,
                    revenue: 75000,
                    expenses: 85000,
                    latitude: 13.0827,
                    longitude: 80.2707,
                    created: "2023-07-30"
                }
            ];
        }

        function randf_getSampleActivities() {
            return [
                "Added new outlet: Organic Dairy Hub",
                "Updated outlet: Mother Dairy Franchise",
                "Changed status for Dairy Pure Retail to Active",
                "Deleted outlet: Old Dairy Corner",
                "Added new outlet: Fresh Farms Franchise",
            ];
        }

        function randf_generateId() {
            return "_" + Math.random().toString(36).substr(2, 9);
        }

        function randf_formatCurrency(num) {
            return `â‚¹${num.toLocaleString("en-IN")}`;
        }

        function randf_profit(o) {
            return o.revenue - o.expenses;
        }

        function randf_capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function randf_getStatusClass(status) {
            switch (status) {
                case "active": return "status-active";
                case "pending": return "status-pending";
                case "setup": return "status-setup";
                case "inactive": return "status-inactive";
                default: return "";
            }
        }

        function randf_renderStars(n) {
            const fullStars = Math.floor(n);
            const halfStar = n % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;

            let stars = "";
            for (let i = 0; i < fullStars; i++) stars += '<i class="fas fa-star"></i>';
            if (halfStar) stars += '<i class="fas fa-star-half-alt"></i>';
            for (let i = 0; i < emptyStars; i++) stars += '<i class="far fa-star"></i>';

            return stars;
        }

        // Rendering Functions
        function randf_renderDashboard() {
            const dashboardKpisEl = document.getElementById("randf_dashboard_kpis");
            const totalOutlets = randf_outlets.length;
            const activeOutlets = randf_outlets.filter(o => o.status === "active").length;
            const totalRevenue = randf_outlets.reduce((sum, o) => sum + o.revenue, 0);
            const totalExpenses = randf_outlets.reduce((sum, o) => sum + o.expenses, 0);
            const totalProfit = totalRevenue - totalExpenses;
            const avgRating = randf_outlets.length ? (randf_outlets.reduce((sum, o) => sum + o.rating, 0) / randf_outlets.length).toFixed(1) : 0;

            dashboardKpisEl.innerHTML = `
            <div class="card card-green">
                <div class="card-header">
                    <span>Total Outlets</span>
                    <div class="card-icon"><i class="fas fa-store low-contrast"></i></div>
                </div>
                <div class="card-value">${totalOutlets}</div>
                <p>Active: ${activeOutlets}</p>
            </div>
            <div class="card card-blue">
                <div class="card-header">
                    <span>Total Revenue</span>
                    <div class="card-icon"><i class="fas fa-rupee-sign low-contrast"></i></div>
                </div>
                <div class="card-value">${randf_formatCurrency(totalRevenue)}</div>
                <p>Avg/Month: ${randf_formatCurrency(totalRevenue / 12)}</p>
            </div>
            <div class="card card-red">
                <div class="card-header">
                    <span>Total Expenses</span>
                    <div class="card-icon"><i class="fas fa-money-bill-wave low-contrast"></i></div>
                </div>
                <div class="card-value">${randf_formatCurrency(totalExpenses)}</div>
                <p>Avg/Month: ${randf_formatCurrency(totalExpenses / 12)}</p>
            </div>
            <div class="card card-orange">
                <div class="card-header">
                    <span>Total Profit</span>
                    <div class="card-icon"><i class="fas fa-chart-line low-contrast"></i></div>
                </div>
                <div class="card-value" style="color:${totalProfit >= 0 ? 'var(--success)' : 'var(--danger)'}">${randf_formatCurrency(totalProfit)}</div>
                <p>Profit Margin: ${totalRevenue ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0}%</p>
            </div>
            <div class="card card-yellow">
                <div class="card-header">
                    <span>Average Rating</span>
                    <div class="card-icon"><i class="fas fa-star low-contrast"></i></div>
                </div>
                <div class="card-value">${avgRating} <span style="color: var(--warning)">${randf_renderStars(avgRating)}</span></div>
                <p>Based on ${totalOutlets} outlets</p>
            </div>
        `;
        }

        function randf_renderRegionSummary() {
            const regionBlocksEl = document.getElementById("randf_region_blocks");
            const ZONES = ["north", "south", "east", "west"];

            regionBlocksEl.innerHTML = ZONES.map(zone => {
                const outletsInZone = randf_outlets.filter(o => o.zone === zone);
                const count = outletsInZone.length;
                const revenue = outletsInZone.reduce((sum, o) => sum + o.revenue, 0);
                const avgRating = count ? (outletsInZone.reduce((sum, o) => sum + o.rating, 0) / count).toFixed(1) : 0;

                return `
                <div class="card">
                    <div class="card-header">
                        <h3>${randf_capitalize(zone)} Zone</h3>
                        <div class="card-icon"><i class="fas fa-map-marker-alt low-contrast"></i></div>
                    </div>
                    <p><strong><i class="fas fa-store low-contrast"></i> Outlets:</strong> ${count}</p>
                    <p><strong><i class="fas fa-rupee-sign low-contrast"></i> Revenue:</strong> ${randf_formatCurrency(revenue)}</p>
                    <p><strong><i class="fas fa-star low-contrast"></i> Avg. Rating:</strong> 
                        ${avgRating} ${randf_renderStars(avgRating)}
                    </p>
                </div>
            `;
            }).join("");
        }

        function randf_renderOutletCards(list) {
            const outletCardList = document.getElementById("randf_outlet_card_list");
            outletCardList.innerHTML = list.map(o => {
                const profit = randf_profit(o);
                const profitClass = profit >= 0 ? "profit-positive" : "profit-negative";
                const statusIcon = o.status === 'active' ? 'fa-check-circle' :
                    o.status === 'pending' ? 'fa-clock' :
                        o.status === 'setup' ? 'fa-tools' :
                            'fa-times-circle';

                return `
            <div class="card" style="border:none;">
                <h3 class="section-title" style="margin-top:0px;"><i class="fas fa-store"></i> ${o.name}</h3>
                <div class="outlet-details-grid">
                    <div class="change">
                    <div class="detail-label">Type:</div>
                    <div class="detail-value"><i class="${o.type === 'retail' ? 'fas fa-shopping-bag' : 'fas fa-crown'} low-contrast" class="detail-value low-contrast"></i> ${randf_capitalize(o.type)}</div>
                    </div>

                    <div class="change">
                    <div class="detail-label">Zone:</div>
                    <div class="detail-value"><i class="fas fa-map-marker-alt low-contrast"></i> ${randf_capitalize(o.zone)}</div>
                    </div>

                    <div class="change">
                    <div class="detail-label">Owner:</div>
                    <div class="detail-value"><i class="fas fa-user low-contrast"></i> ${o.owner}</div>
                    </div>

                    <div class="change">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value"><span class="status-badge ${randf_getStatusClass(o.status)}"><i class="fas ${statusIcon}"></i> ${randf_capitalize(o.status)}</span></div>
                    </div>

                    <div class="change">
                    <div class="detail-label">Rating:</div>
                    <div class="detail-value low-contrast">${randf_renderStars(o.rating)}</div>
                    </div>

                    <div class="change">
                    <div class="detail-label">Profit:</div>
                    <div class="detail-value ${profitClass}"><i class="fas ${profit >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'}"></i> ${randf_formatCurrency(profit)}</div>
                    </div>

                </div>
                <div class="btn-row">
                    <button class="btn btn-edit" style="padding:11px;" data-id="${o.id}" data-action="edit">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-delete" style="padding:11px;" data-id="${o.id}" data-action="delete">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <button class="btn btn-edit" style="padding:11px;" data-id="${o.id}" data-action="info">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                </div>
            </div>
            `;
            }).join("") || `<div class="card"><h3><i class="fas fa-exclamation-circle"></i> No outlets found</h3><p>Try adjusting your filters</p></div>`;
        }

        function randf_renderOutletTable(list) {
            const outletTableBody = document.querySelector("#randf_outlet_table tbody");
            outletTableBody.innerHTML = list.map(o => {
                const profit = randf_profit(o);
                const profitClass = profit >= 0 ? "profit-positive" : "profit-negative";
                const statusIcon = o.status === 'active' ? 'fa-check-circle' :
                    o.status === 'pending' ? 'fa-clock' :
                        o.status === 'setup' ? 'fa-tools' :
                            'fa-times-circle';

                return `
            <tr>
                <td><i class="fas fa-store low-contrast"></i> ${o.name}</td>
                <td><i class="${o.type === 'retail' ? 'fas fa-shopping-bag' : 'fas fa-crown'} low-contrast"></i> ${randf_capitalize(o.type)}</td>
                <td><i class="fas fa-map-marker-alt low-contrast"></i> ${randf_capitalize(o.zone)}</td>
                <td><i class="fas fa-user low-contrast"></i> ${o.owner}</td>
                <td><span class="status-badge ${randf_getStatusClass(o.status)}"><i class="fas ${statusIcon} low-contrast"></i> ${randf_capitalize(o.status)}</span></td>
                <td class="low-contrast">${randf_renderStars(o.rating)}</td>
                <td class="${profitClass}"><i class="fas ${profit >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'} low-contrast"></i> ${randf_formatCurrency(profit)}</td>
                <td style="display:inline-flex; gap:3px;">
                    <button class="btn btn-edit" data-id="${o.id}" data-action="edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-delete" data-id="${o.id}" data-action="delete">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-edit" data-id="${o.id}" data-action="info">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </td>
            </tr>
            `;
            }).join("") || `<tr><td colspan="8" style="text-align:center;"><i class="fas fa-exclamation-circle"></i> No data found matching your criteria</td></tr>`;
        }

        function randf_renderActivityFeed() {
            const activityFeed = document.getElementById("randf_activity_feed");
            activityFeed.innerHTML = randf_recentActivities.length ?
                randf_recentActivities.slice().reverse().map(a => {
                    let icon = 'fa-history';
                    if (a.includes('Added')) icon = 'fa-plus-circle';
                    if (a.includes('Updated') || a.includes('Changed')) icon = 'fa-edit';
                    if (a.includes('Deleted')) icon = 'fa-trash-alt';

                    return `
                <li>
                    <i class="fas ${icon}"></i>
                    <div class="activity-content">${a}</div>
                    <div class="activity-time">${new Date().toLocaleTimeString()}</div>
                </li>
                `;
                }).join("") :
                `<li><i class="fas fa-info-circle"></i> No recent activity</li>`;
        }

        function randf_renderPipelineBoard() {
            const pipelineBoard = document.getElementById("randf_pipeline_board");
            const STATUSES = ["setup", "pending", "active", "inactive"];

            pipelineBoard.innerHTML = STATUSES.map(status => {
                const items = randf_outlets.filter(o => o.status === status);
                const statusIcon = status === 'active' ? 'fa-check-circle' :
                    status === 'pending' ? 'fa-clock' :
                        status === 'setup' ? 'fa-tools' :
                            'fa-times-circle';

                return `
                <div class="card">
                    <h3><i class="fas ${statusIcon}"></i> ${randf_capitalize(status)} (${items.length})</h3>
                    <div>${items.map(i => `
                        <p>
                            <i class="fas fa-store"></i>
                            ${i.name} (${randf_capitalize(i.type)})
                        </p>
                    `).join("") || "<p><i class='fas fa-ban'></i> No items in this status</p>"}</div>
                </div>
            `;
            }).join("");
        }

        function randf_renderFullMap() {
            const fullMapFrame = document.getElementById("randf_full_map");
            if (randf_outlets.length > 0) {
                // Get center of all locations
                const avgLat = randf_outlets.reduce((sum, o) => sum + o.latitude, 0) / randf_outlets.length;
                const avgLng = randf_outlets.reduce((sum, o) => sum + o.longitude, 0) / randf_outlets.length;

                // Create markers for all outlets
                const markers = randf_outlets.map(o =>
                    `&markers=color:red%7C${o.latitude},${o.longitude}`
                ).join('');

                fullMapFrame.src = `https://maps.google.com/maps?q=${avgLat},${avgLng}&z=5${markers}&output=embed`;
            } else {
                fullMapFrame.src = `https://maps.google.com/maps?q=India&z=5&output=embed`;
            }
        }

        // Modal Functions
        function randf_openAddModal() {
            randf_editId = null;
            document.getElementById("randf_add_outlet_form").reset();
            document.getElementById("randf_modal_title_text").textContent = "Add New Outlet";
            randf_updateRatingDisplay();
            document.getElementById("randf_add_outlet_modal").classList.add('active');
            document.querySelectorAll('.form-error').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.form-control').forEach(el => el.classList.remove('invalid-input'));
        }

        function randf_closeAddModal() {
            document.getElementById("randf_add_outlet_modal").classList.remove('active');
        }

        function randf_openInfoModal(outlet) {
            const infoDetails = document.getElementById("randf_info_details");
            const profit = randf_profit(outlet);
            const profitClass = profit >= 0 ? "profit-positive" : "profit-negative";
            const statusIcon = outlet.status === 'active' ? 'fa-check-circle' :
                outlet.status === 'pending' ? 'fa-clock' :
                    outlet.status === 'setup' ? 'fa-tools' :
                        'fa-times-circle';

            infoDetails.innerHTML = `
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 15px; color: var(--primary);"><i class="fas fa-store low-contrast"></i> ${outlet.name}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <p style="padding-bottom: 10px;"><i class="${outlet.type === 'retail' ? 'fas fa-shopping-bag' : 'fas fa-crown'} low-contrast"></i> Type:</strong> ${randf_capitalize(outlet.type)}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-map-marker-alt low-contrast"></i> Zone: ${randf_capitalize(outlet.zone)}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-user low-contrast"></i> Owner: ${outlet.owner}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-phone low-contrast"></i> Contact: ${outlet.contact}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-calendar-alt low-contrast"></i> Created: ${outlet.created}</p>
                    </div>
                    <div>
                        <p style="padding-bottom: 10px;"><i class="fas ${statusIcon} low-contrast"></i> Status: <span class="status-badge ${randf_getStatusClass(outlet.status)}">${randf_capitalize(outlet.status)}</span></p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-star low-contrast"></i> Rating: ${randf_renderStars(outlet.rating)}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-rupee-sign low-contrast"></i> Revenue: ${randf_formatCurrency(outlet.revenue)}</p>
                        <p style="padding-bottom: 10px;"><i class="fas fa-money-bill-wave low-contrast"></i> Expenses: ${randf_formatCurrency(outlet.expenses)}</p>
                        <p style="padding-bottom: 10px;"><i class="fas ${profit >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'} low-contrast"></i> Profit: <span class="${profitClass}">${randf_formatCurrency(profit)}</span></p>
                    </div>
                </div>
            </div>
        `;
            document.getElementById("randf_info_map").src = `https://maps.google.com/maps?q=${outlet.latitude},${outlet.longitude}&z=15&output=embed`;
            document.getElementById("randf_info_modal").classList.add('active');
        }

        function randf_closeInfoModal() {
            document.getElementById("randf_info_modal").classList.remove('active');
            document.getElementById("randf_info_map").src = "";
        }

        function randf_validateForm() {
            let isValid = true;
            const form = document.getElementById("randf_add_outlet_form");

            // Reset all errors
            document.querySelectorAll('.form-error').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('.form-control').forEach(el => {
                el.classList.remove('invalid-input');
            });

            // Validate required fields
            const requiredFields = ['name', 'type', 'zone', 'owner', 'contact', 'status', 'rating', 'revenue', 'expenses', 'latitude', 'longitude'];
            requiredFields.forEach(field => {
                const element = form.querySelector(`[name="${field}"]`);
                if (!element.value.trim()) {
                    document.getElementById(`${field}-error`).style.display = 'block';
                    element.classList.add('invalid-input');
                    isValid = false;
                }
            });

            // Validate contact number
            const contact = form.querySelector('[name="contact"]').value;
            if (contact && !/^\d{10}$/.test(contact)) {
                document.getElementById('contact-error').style.display = 'block';
                form.querySelector('[name="contact"]').classList.add('invalid-input');
                isValid = false;
            }

            // Validate latitude and longitude
            const latitude = parseFloat(form.querySelector('[name="latitude"]').value);
            const longitude = parseFloat(form.querySelector('[name="longitude"]').value);

            if (isNaN(latitude) || latitude < -90 || latitude > 90) {
                document.getElementById('latitude-error').style.display = 'block';
                form.querySelector('[name="latitude"]').classList.add('invalid-input');
                isValid = false;
            }

            if (isNaN(longitude) || longitude < -180 || longitude > 180) {
                document.getElementById('longitude-error').style.display = 'block';
                form.querySelector('[name="longitude"]').classList.add('invalid-input');
                isValid = false;
            }

            return isValid;
        }

        function randf_handleFormSubmit(e) {
            e.preventDefault();

            if (!randf_validateForm()) {
                return;
            }

            const f = new FormData(document.getElementById("randf_add_outlet_form"));

            const data = {
                name: f.get("name").trim(),
                type: f.get("type"),
                zone: f.get("zone"),
                owner: f.get("owner").trim(),
                contact: f.get("contact").trim(),
                status: f.get("status"),
                rating: +f.get("rating"),
                revenue: +f.get("revenue"),
                expenses: +f.get("expenses"),
                latitude: +f.get("latitude"),
                longitude: +f.get("longitude"),
                created: new Date().toISOString().split('T')[0]
            };

            if (randf_editId) {
                const i = randf_outlets.findIndex(o => o.id === randf_editId);
                randf_outlets[i] = { ...randf_outlets[i], ...data };
                randf_addActivity(`Edited outlet "${data.name}"`);
            } else {
                const id = randf_generateId();
                randf_outlets.push({ id, ...data });
                randf_addActivity(`Added new outlet "${data.name}"`);
            }

            randf_saveData();
            randf_renderAll();
            randf_closeAddModal();
        }

        function randf_handleAction(e) {
            const btn = e.target.closest("button");
            if (!btn) return;

            const id = btn.dataset.id;
            const act = btn.dataset.action;
            const outlet = randf_outlets.find(o => o.id === id);
            if (!outlet) return;

            if (act === "edit") {
                randf_editId = id;
                document.getElementById("randf_modal_title_text").textContent = "Edit Outlet";
                document.getElementById("randf_add_outlet_modal").classList.add('active');
                Object.entries(outlet).forEach(([k, v]) => {
                    const element = document.querySelector(`#randf_add_outlet_form [name="${k}"]`);
                    if (element) element.value = v;
                });
                randf_updateRatingDisplay();
                randf_updateMapPreview();
            } else if (act === "delete") {
                if (confirm(`Are you sure you want to delete outlet "${outlet.name}"?`)) {
                    randf_outlets = randf_outlets.filter(o => o.id !== id);
                    randf_saveData();
                    randf_addActivity(`Deleted outlet "${outlet.name}"`);
                    randf_renderAll();
                }
            } else if (act === "info") {
                randf_openInfoModal(outlet);
            }
        }

        function randf_applyFilters() {
            const search = document.getElementById("randf_search_input").value.toLowerCase();
            const type = document.getElementById("randf_filter_type").value;
            const zone = document.getElementById("randf_filter_zone").value;
            const status = document.getElementById("randf_filter_status").value;

            return randf_outlets.filter(o => {
                return (
                    (o.name.toLowerCase().includes(search) ||
                        o.owner.toLowerCase().includes(search) ||
                        o.contact.includes(search)) &&
                    (type === "all" || o.type === type) &&
                    (zone === "all" || o.zone === zone) &&
                    (status === "all" || o.status === status)
                );
            });
        }

        function randf_renderAll() {
            const filtered = randf_applyFilters();
            randf_renderDashboard();
            randf_renderRegionSummary();
            randf_renderOutletCards(filtered);
            randf_renderOutletTable(filtered);
            randf_renderActivityFeed();
            randf_renderPipelineBoard();
            randf_renderFullMap();
        }

        function randf_addActivity(msg) {
            const time = new Date().toLocaleTimeString();
            randf_recentActivities.push(`${msg} (${time})`);
            if (randf_recentActivities.length > 20) randf_recentActivities.shift();
            randf_saveActivities();
            randf_renderActivityFeed();
        }

        function randf_clearActivities() {
            if (confirm("Clear all recent activities?")) {
                randf_recentActivities = [];
                randf_saveActivities();
                randf_renderActivityFeed();
            }
        }

        function randf_showCardView() {
            document.getElementById("randf_outlet_card_list").style.display = "grid";
            document.getElementById("randf_outlet_table_container").style.display = "none";
            document.getElementById("randf_toggle_card").classList.add("active");
            document.getElementById("randf_toggle_table").classList.remove("active");
        }

        function randf_showTableView() {
            document.getElementById("randf_outlet_card_list").style.display = "none";
            document.getElementById("randf_outlet_table_container").style.display = "block";
            document.getElementById("randf_toggle_table").classList.add("active");
            document.getElementById("randf_toggle_card").classList.remove("active");
        }

        function randf_updateRatingDisplay() {
            const slider = document.getElementById("randf_rating_slider");
            const display = document.getElementById("randf_rating_display");
            display.innerHTML = `${slider.value} ${randf_renderStars(parseFloat(slider.value))}`;
        }

        function randf_updateMapPreview() {
            const lat = document.querySelector('[name="latitude"]').value;
            const lng = document.querySelector('[name="longitude"]').value;
            const preview = document.getElementById('randf_map_preview');

            if (lat && lng) {
                preview.innerHTML = `
                <iframe 
                    width="100%" 
                    height="100%" 
                    frameborder="0" 
                    scrolling="no" 
                    marginheight="0" 
                    marginwidth="0" 
                    src="https://maps.google.com/maps?q=${lat},${lng}&z=15&output=embed"
                ></iframe>
                <div class="map-pin" style="top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
            `;
            } else {
                preview.innerHTML = `
                <div class="map-overlay">Enter coordinates to preview location</div>
            `;
            }
        }

        function randf_setupEventListeners() {
            document.getElementById("randf_open_add_modal").addEventListener("click", randf_openAddModal);
            document.getElementById("randf_close_modal").addEventListener("click", randf_closeAddModal);
            document.getElementById("randf_close_add_modal").addEventListener("click", randf_closeAddModal);
            document.getElementById("randf_close_info").addEventListener("click", randf_closeInfoModal);
            document.getElementById("randf_close_info_modal").addEventListener("click", randf_closeInfoModal);
            document.getElementById("randf_add_outlet_form").addEventListener("submit", randf_handleFormSubmit);
            document.getElementById("randf_clear_activity").addEventListener("click", randf_clearActivities);
            document.getElementById("randf_rating_slider").addEventListener("input", randf_updateRatingDisplay);

            // Search and filter listeners
            [
                document.getElementById("randf_search_input"),
                document.getElementById("randf_filter_type"),
                document.getElementById("randf_filter_zone"),
                document.getElementById("randf_filter_status")
            ].forEach(i => {
                i.addEventListener("input", randf_renderAll);
            });

            // View toggle listeners
            document.getElementById("randf_toggle_card").addEventListener("click", randf_showCardView);
            document.getElementById("randf_toggle_table").addEventListener("click", randf_showTableView);

            // Action button delegates
            document.getElementById("randf_outlet_card_list").addEventListener("click", randf_handleAction);
            document.querySelector("#randf_outlet_table tbody").addEventListener("click", randf_handleAction);

            // Map preview updates
            document.querySelector('[name="latitude"]').addEventListener('input', randf_updateMapPreview);
            document.querySelector('[name="longitude"]').addEventListener('input', randf_updateMapPreview);

            // Real-time validation
            document.querySelectorAll('#randf_add_outlet_form input, #randf_add_outlet_form select').forEach(el => {
                el.addEventListener('blur', () => {
                    randf_validateForm();
                });
            });
        }
    </script>

    <!--customers-->
    <script>
        // Data Models
        let customers_data = [
            {
                id: "CU001",
                name: "Rajesh Dairy Farm",
                phone: "9876543210",
                email: "rajesh@dairy.com",
                address: "123 Milk Colony, Delhi",
                type: "wholesale",
                creditLimit: 50000,
                balance: 0,
                discount: 0.1, // 10% for wholesale
                status: "active",
                location: "delhi"
            },
            {
                id: "CU002",
                name: "Mohan Milk Center",
                phone: "8765432109",
                email: "mohan@milkcenter.com",
                address: "Gandhi Road, Mumbai",
                type: "retail",
                creditLimit: 20000,
                balance: 0,
                discount: 0.05, // 5% for retail
                status: "active",
                location: "mumbai"
            },
            {
                id: "CU003",
                name: "Geeta Groceries",
                phone: "7654321098",
                email: "geeta@groceries.com",
                address: "Market Street, Kolkata",
                type: "retail",
                creditLimit: 15000,
                balance: 0,
                discount: 0.05,
                status: "active",
                location: "kolkata"
            },
            {
                id: "CU004",
                name: "Sunil Kumar",
                phone: "6543210987",
                email: "sunil@gmail.com",
                address: "45/A, MG Road, Bangalore",
                type: "consumer",
                creditLimit: 0, // No credit for consumers
                balance: 0,
                discount: 0,
                status: "inactive",
                location: "bangalore"
            },
            {
                id: "CU005",
                name: "Happy Dairy Products",
                phone: "9432109876",
                email: "happy@dairy.com",
                address: "Industrial Area, Chennai",
                type: "wholesale",
                creditLimit: 75000,
                balance: 0,
                discount: 0.1,
                status: "active",
                location: "chennai"
            }
        ];

        let customers_orders = [
            {
                id: "ORD1001",
                customerId: "CU001",
                date: "2023-09-15",
                items: [
                    { product: "milk", qty: 20, price: 45 },
                    { product: "curd", qty: 10, price: 40 }
                ],
                subtotal: 1300,
                discount: 130,
                total: 1170,
                paymentMethod: "credit",
                paymentStatus: "pending",
                amountPaid: 0
            },
            {
                id: "ORD1002",
                customerId: "CU002",
                date: "2023-09-14",
                items: [
                    { product: "milk", qty: 15, price: 45 },
                    { product: "paneer", qty: 5, price: 200 }
                ],
                subtotal: 1675,
                discount: 83.75,
                total: 1591.25,
                paymentMethod: "credit",
                paymentStatus: "pending",
                amountPaid: 0
            },
            {
                id: "ORD1003",
                customerId: "CU004",
                date: "2023-09-13",
                items: [
                    { product: "milk", qty: 5, price: 45 },
                    { product: "cheese", qty: 2, price: 300 }
                ],
                subtotal: 825,
                discount: 0,
                total: 825,
                paymentMethod: "cash",
                paymentStatus: "paid",
                amountPaid: 825
            }
        ];

        let customers_activityLog = [
            {
                type: "order",
                message: "Rajesh Dairy Farm placed an order for â‚¹1,170",
                timestamp: "2023-09-15T10:30:00"
            },
            {
                type: "customer",
                message: "Sunil Kumar was added to the system",
                timestamp: "2023-09-14T15:45:00"
            },
            {
                type: "payment",
                message: "Geeta Groceries paid â‚¹825 for order #ORD1003",
                timestamp: "2023-09-14T11:20:00"
            },
            {
                type: "update",
                message: "Happy Dairy Products' credit limit was increased to â‚¹75,000",
                timestamp: "2023-09-13T16:15:00"
            }
        ];

        // Current customer for order placement
        let customers_currentCustomer = null;
        let customers_editMode = false;

        // DOM Elements
        const customers_customerTableBody = document.getElementById('customers_customerTableBody');
        const customers_orderList = document.getElementById('customers_orderList');
        const customers_activityList = document.getElementById('customers_activityList');
        const customers_customerModal = document.getElementById('customers_customerModal');
        const customers_orderModal = document.getElementById('customers_orderModal');
        const customers_customerForm = document.getElementById('customers_customerForm');
        const customers_orderForm = document.getElementById('customers_orderForm');
        const customers_saveCustomerBtn = document.getElementById('customers_saveCustomerBtn');
        const customers_placeOrderBtn = document.getElementById('customers_placeOrderBtn');
        const customers_cancelBtn = document.getElementById('customers_cancelBtn');
        const customers_closeModal = document.getElementById('customers_closeModal');
        const customers_closeOrderModal = document.getElementById('customers_closeOrderModal');
        const customers_cancelOrderBtn = document.getElementById('customers_cancelOrderBtn');
        const customers_toastContainer = document.getElementById('customers_toastContainer');

        // Chart instances
        let customers_productChart, customers_customerTypeChart;

        // Initialize the dashboard
        function customers_initDashboard() {
            customers_updateDashboardStats();
            customers_renderCustomerTable();
            customers_renderOrderList();
            customers_renderActivityLog();
            customers_initCharts();
            customers_setupEventListeners();

            // Set today's date as default for order date
            document.getElementById('customers_orderDate').valueAsDate = new Date();
        }

        // Update dashboard statistics
        function customers_updateDashboardStats() {
            // Total customers
            document.getElementById('customers_totalCustomers').textContent = customers_data.length;

            // Active orders (pending and partial)
            const activeOrders = customers_orders.filter(o => o.paymentStatus === 'pending' || o.paymentStatus === 'partial').length;
            document.getElementById('customers_activeOrders').textContent = activeOrders;

            // Total sales
            const totalSales = customers_orders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('customers_totalSales').textContent = 'â‚¹' + totalSales.toLocaleString('en-IN');

            // Pending payments
            const pendingPayments = customers_orders
                .filter(o => o.paymentStatus !== 'paid')
                .reduce((sum, order) => sum + (order.total - order.amountPaid), 0);
            document.getElementById('customers_pendingPayments').textContent = 'â‚¹' + pendingPayments.toLocaleString('en-IN');
        }

        // Render customer table
        function customers_renderCustomerTable() {
            customers_customerTableBody.innerHTML = '';

            // Apply filters
            let filteredData = [...customers_data];

            // Search filter
            const searchTerm = document.getElementById('customers_searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredData = filteredData.filter(c =>
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.phone.toLowerCase().includes(searchTerm) ||
                    (c.email && c.email.toLowerCase().includes(searchTerm))
                );
            }

            // Type filter
            const type = document.getElementById('customers_filterType').value;
            if (type) {
                filteredData = filteredData.filter(c => c.type === type);
            }

            // Status filter
            const status = document.getElementById('customers_statusFilter').value;
            if (status) {
                filteredData = filteredData.filter(c => c.status === status);
            }

            // Credit status filter
            const creditStatus = document.getElementById('customers_creditFilter').value;
            if (creditStatus) {
                filteredData = filteredData.filter(c => {
                    if (c.type === 'consumer') return false;
                    const creditAvailable = c.creditLimit - c.balance;
                    const creditPercentage = (creditAvailable / c.creditLimit) * 100;

                    if (creditStatus === 'good') return creditPercentage > 50;
                    if (creditStatus === 'warning') return creditPercentage <= 50 && creditPercentage > 20;
                    if (creditStatus === 'critical') return creditPercentage <= 20;
                    return true;
                });
            }

            // Location filter
            const location = document.getElementById('customers_locationFilter').value;
            if (location) {
                filteredData = filteredData.filter(c => c.location === location);
            }

            // Render rows
            filteredData.forEach(customer => {
                // Credit status indicator
                let creditStatus = '';
                if (customer.type !== 'consumer') {
                    const creditAvailable = customer.creditLimit - customer.balance;
                    const creditPercentage = (creditAvailable / customer.creditLimit) * 100;

                    if (creditPercentage > 50) {
                        creditStatus = `<span class="status-active">Good</span>`;
                    } else if (creditPercentage > 20) {
                        creditStatus = `<span class="status-inactive">Warning</span>`;
                    } else {
                        creditStatus = `<span class="expiry-expired">Critical</span>`;
                    }
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td><span class="customer-type type-${customer.type}">${customers_capitalize(customer.type)}</span></td>
                    <td>${customer.type !== 'consumer' ? 'â‚¹' + customer.creditLimit.toLocaleString() : 'N/A'}</td>
                    <td>${customer.type !== 'consumer' ? 'â‚¹' + customer.balance.toLocaleString() : 'N/A'}</td>
                    <td>
                        ${customer.status === 'active' ?
                        '<span class="status-active">Active</span>' :
                        '<span class="status-inactive">Inactive</span>'}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline customers_orderBtn" data-id="${customer.id}" title="Place Order">
                            <i class="fas fa-shopping-cart"></i>
                        </button>
                        <button class="btn btn-sm btn-outline customers_editBtn" data-id="${customer.id}" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline customers_deleteBtn" data-id="${customer.id}" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                customers_customerTableBody.appendChild(row);
            });
        }

        // Render order list
        function customers_renderOrderList() {
            customers_orderList.innerHTML = '';
            const filter = document.getElementById('customers_orderFilter').value;

            const filteredOrders = customers_orders.filter(order => {
                if (filter === 'all') return true;
                return order.paymentStatus === filter;
            });

            if (filteredOrders.length === 0) {
                customers_orderList.innerHTML = '<tr><td colspan="6" style="text-align: center;">No orders found</td></tr>';
                return;
            }

            filteredOrders.forEach(order => {
                const customer = customers_data.find(c => c.id === order.customerId);
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${customer ? customer.name : 'Unknown Customer'}</td>
                    <td>${customers_formatDate(order.date)}</td>
                    <td>â‚¹${order.total.toFixed(2)}</td>
                    <td>
                        ${order.paymentStatus === 'paid' ?
                        '<span class="status-active">Paid</span>' :
                        order.paymentStatus === 'pending' ?
                            '<span class="expiry-expired">Pending</span>' :
                            '<span class="status-inactive">Partial</span>'}
                    </td>
                    <td>
                        ${order.paymentStatus === 'pending' || order.paymentStatus === 'partial' ?
                        `<button class="btn btn-sm btn-success customers_markPaidBtn" data-id="${order.id}">Mark Paid</button>` :
                        '<span class="status-active">Completed</span>'}
                    </td>
                `;

                customers_orderList.appendChild(row);
            });
        }

        // Render activity log
        function customers_renderActivityLog() {
            customers_activityList.innerHTML = '';

            customers_activityLog.forEach(activity => {
                let iconClass = '';
                switch (activity.type) {
                    case 'order': iconClass = 'fas fa-shopping-cart bg-blue'; break;
                    case 'customer': iconClass = 'fas fa-user-plus bg-green'; break;
                    case 'payment': iconClass = 'fas fa-money-bill-wave bg-green'; break;
                    case 'update': iconClass = 'fas fa-edit bg-orange'; break;
                    default: iconClass = 'fas fa-info-circle bg-blue';
                }

                const item = document.createElement('li');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon ${iconClass.split(' ')[2]}">
                        <i class="${iconClass.split(' ')[0]} ${iconClass.split(' ')[1]}"></i>
                    </div>
                    <div class="activity-content">
                        <h4>${activity.message}</h4>
                        <div class="activity-time">${customers_formatDateTime(activity.timestamp)}</div>
                    </div>
                `;
                customers_activityList.appendChild(item);
            });
        }

        // Initialize charts
        function customers_initCharts() {
            // Destroy existing charts if they exist
            if (customers_productChart) customers_productChart.destroy();
            if (customers_customerTypeChart) customers_customerTypeChart.destroy();

            // Product sales distribution
            const productCtx = document.getElementById('customers_productChart').getContext('2d');
            const productData = {
                milk: 0,
                curd: 0,
                paneer: 0,
                cheese: 0
            };

            customers_orders.forEach(order => {
                order.items.forEach(item => {
                    productData[item.product] += item.qty;
                });
            });

            customers_productChart = new Chart(productCtx, {
                type: 'pie',
                data: {
                    labels: ['Milk', 'Curd', 'Paneer', 'Cheese'],
                    datasets: [{
                        data: [productData.milk, productData.curd, productData.paneer, productData.cheese],
                        backgroundColor: ['#4caf50', '#2196f3', '#ff9800', '#9c27b0'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Revenue by customer type
            const typeCtx = document.getElementById('customers_customerTypeChart').getContext('2d');
            const typeData = {
                wholesale: 0,
                retail: 0,
                consumer: 0
            };

            customers_orders.forEach(order => {
                const customer = customers_data.find(c => c.id === order.customerId);
                if (customer) {
                    typeData[customer.type] += order.total;
                }
            });

            customers_customerTypeChart = new Chart(typeCtx, {
                type: 'bar',
                data: {
                    labels: ['Wholesale', 'Retail', 'End Consumer'],
                    datasets: [{
                        label: 'Revenue (â‚¹)',
                        data: [typeData.wholesale, typeData.retail, typeData.consumer],
                        backgroundColor: '#4c956c',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Set up event listeners
        function customers_setupEventListeners() {
            // Add customer button
            document.getElementById('customers_addCustomerBtn').addEventListener('click', () => {
                customers_editMode = false;
                document.getElementById('customers_modalTitle').textContent = 'Add Customer';
                customers_customerForm.reset();
                document.getElementById('customers_customerId').value = '';
                document.getElementById('customers_creditLimitContainer').style.display = 'block';
                customers_customerModal.classList.add('active');
            });

            // Save customer
            customers_saveCustomerBtn.addEventListener('click', customers_saveCustomer);

            // Close modals
            customers_closeModal.addEventListener('click', () => {
                customers_customerModal.classList.remove('active');
            });

            customers_closeOrderModal.addEventListener('click', () => {
                customers_orderModal.classList.remove('active');
            });

            customers_cancelBtn.addEventListener('click', () => {
                customers_customerModal.classList.remove('active');
            });

            customers_cancelOrderBtn.addEventListener('click', () => {
                customers_orderModal.classList.remove('active');
            });

            // Apply filters
            document.getElementById('customers_applyFilters').addEventListener('click', () => {
                customers_renderCustomerTable();
            });

            // Reset filters
            document.getElementById('customers_resetFilters').addEventListener('click', () => {
                document.getElementById('customers_filterType').value = '';
                document.getElementById('customers_statusFilter').value = '';
                document.getElementById('customers_creditFilter').value = '';
                document.getElementById('customers_locationFilter').value = '';
                document.getElementById('customers_searchInput').value = '';
                customers_renderCustomerTable();
            });

            // Order filter
            document.getElementById('customers_orderFilter').addEventListener('change', customers_renderOrderList);

            // Customer type change in modal
            document.getElementById('customers_customerType').addEventListener('change', function () {
                document.getElementById('customers_creditLimitContainer').style.display =
                    this.value !== 'consumer' ? 'block' : 'none';
            });

            // Search input
            document.getElementById('customers_searchInput').addEventListener('input', customers_renderCustomerTable);

            // Export CSV
            document.getElementById('customers_exportCSV').addEventListener('click', customers_exportCSV);

            // Customer table actions
            customers_customerTableBody.addEventListener('click', customers_handleCustomerActions);

            // Order list actions
            customers_orderList.addEventListener('click', customers_handleOrderActions);

            // Quantity buttons
            document.querySelectorAll('.customers_plusBtn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const product = this.dataset.product;
                    const input = document.getElementById(`customers_${product}Qty`);
                    input.value = parseInt(input.value) + 1;
                    customers_calculateOrderTotal();
                });
            });

            document.querySelectorAll('.customers_minusBtn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const product = this.dataset.product;
                    const input = document.getElementById(`customers_${product}Qty`);
                    if (parseInt(input.value) > 0) {
                        input.value = parseInt(input.value) - 1;
                        customers_calculateOrderTotal();
                    }
                });
            });

            // Quantity input change
            document.querySelectorAll('.qty-input').forEach(input => {
                input.addEventListener('input', customers_calculateOrderTotal);
            });

            // Place order button
            customers_placeOrderBtn.addEventListener('click', customers_placeOrder);

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === customers_customerModal) {
                    customers_customerModal.classList.remove('active');
                }
                if (e.target === customers_orderModal) {
                    customers_orderModal.classList.remove('active');
                }
            });
        }

        // Handle customer actions
        function customers_handleCustomerActions(e) {
            if (e.target.classList.contains('customers_orderBtn') ||
                e.target.parentElement.classList.contains('customers_orderBtn')) {
                const btn = e.target.classList.contains('customers_orderBtn') ?
                    e.target : e.target.parentElement;
                const customerId = btn.dataset.id;
                customers_placeOrderForCustomer(customerId);
            }
            else if (e.target.classList.contains('customers_editBtn') ||
                e.target.parentElement.classList.contains('customers_editBtn')) {
                const btn = e.target.classList.contains('customers_editBtn') ?
                    e.target : e.target.parentElement;
                const customerId = btn.dataset.id;
                customers_editCustomer(customerId);
            }
            else if (e.target.classList.contains('customers_deleteBtn') ||
                e.target.parentElement.classList.contains('customers_deleteBtn')) {
                const btn = e.target.classList.contains('customers_deleteBtn') ?
                    e.target : e.target.parentElement;
                const customerId = btn.dataset.id;
                customers_deleteCustomer(customerId);
            }
        }

        // Handle order actions
        function customers_handleOrderActions(e) {
            if (e.target.classList.contains('customers_markPaidBtn')) {
                const orderId = e.target.dataset.id;
                customers_markOrderAsPaid(orderId);
            }
        }

        // Place order for a customer
        function customers_placeOrderForCustomer(customerId) {
            customers_currentCustomer = customers_data.find(c => c.id === customerId);
            if (!customers_currentCustomer) return;

            // Reset form
            document.getElementById('customers_orderCustomer').value = customers_currentCustomer.name;
            document.getElementById('customers_orderDate').valueAsDate = new Date();
            document.getElementById('customers_milkQty').value = 0;
            document.getElementById('customers_curdQty').value = 0;
            document.getElementById('customers_paneerQty').value = 0;
            document.getElementById('customers_cheeseQty').value = 0;
            document.getElementById('customers_paymentMethod').value = '';
            document.getElementById('customers_paymentStatus').value = 'paid';

            // Calculate initial total
            customers_calculateOrderTotal();

            // Show modal
            customers_orderModal.classList.add('active');
        }

        // Edit customer
        function customers_editCustomer(customerId) {
            customers_editMode = true;
            const customer = customers_data.find(c => c.id === customerId);
            if (!customer) return;

            document.getElementById('customers_modalTitle').textContent = 'Edit Customer';
            document.getElementById('customers_customerId').value = customer.id;
            document.getElementById('customers_customerName').value = customer.name;
            document.getElementById('customers_customerPhone').value = customer.phone;
            document.getElementById('customers_customerEmail').value = customer.email || '';
            document.getElementById('customers_customerAddress').value = customer.address;
            document.getElementById('customers_customerType').value = customer.type;
            document.getElementById('customers_creditLimit').value = customer.creditLimit;

            document.getElementById('customers_creditLimitContainer').style.display =
                customer.type !== 'consumer' ? 'block' : 'none';

            customers_customerModal.classList.add('active');
        }

        // Delete customer
        function customers_deleteCustomer(customerId) {
            if (!confirm('Are you sure you want to delete this customer?')) return;

            const customerIndex = customers_data.findIndex(c => c.id === customerId);
            if (customerIndex === -1) return;

            const customer = customers_data[customerIndex];

            // Check if customer has pending orders
            const hasOrders = customers_orders.some(o => o.customerId === customerId && o.paymentStatus !== 'paid');
            if (hasOrders) {
                customers_showToast('Cannot delete customer with pending orders!', 'toast-error');
                return;
            }

            customers_data.splice(customerIndex, 1);

            // Log activity
            customers_logActivity(`Deleted customer ${customer.name}`);

            customers_renderCustomerTable();
            customers_updateDashboardStats();
            customers_showToast('Customer deleted successfully!', 'toast-success');
        }

        // Save customer
        function customers_saveCustomer() {
            if (!customers_customerForm.checkValidity()) {
                customers_showToast('Please fill in all required fields', 'toast-error');
                return;
            }

            const id = document.getElementById('customers_customerId').value;
            const name = document.getElementById('customers_customerName').value.trim();
            const phone = document.getElementById('customers_customerPhone').value.trim();
            const email = document.getElementById('customers_customerEmail').value.trim();
            const address = document.getElementById('customers_customerAddress').value.trim();
            const type = document.getElementById('customers_customerType').value;
            const creditLimit = type !== 'consumer' ?
                parseFloat(document.getElementById('customers_creditLimit').value) : 0;

            // Validation
            if (!name || !phone || !address || !type) {
                customers_showToast('Please fill all required fields', 'toast-error');
                return;
            }

            if (phone.length !== 10 || !/^\d+$/.test(phone)) {
                customers_showToast('Please enter a valid 10-digit phone number', 'toast-error');
                return;
            }

            if (customers_editMode) {
                // Update existing customer
                const customer = customers_data.find(c => c.id === id);
                if (customer) {
                    customer.name = name;
                    customer.phone = phone;
                    customer.email = email;
                    customer.address = address;
                    customer.type = type;
                    customer.creditLimit = creditLimit;

                    // Set discount based on type
                    customer.discount = type === 'wholesale' ? 0.1 : type === 'retail' ? 0.05 : 0;

                    customers_logActivity(`Updated customer ${name}`);
                    customers_showToast('Customer updated successfully!', 'toast-success');
                }
            } else {
                // Create new customer
                const newId = 'CU' + (customers_data.length + 1).toString().padStart(3, '0');
                const discount = type === 'wholesale' ? 0.1 : type === 'retail' ? 0.05 : 0;

                customers_data.push({
                    id: newId,
                    name,
                    phone,
                    email,
                    address,
                    type,
                    creditLimit,
                    balance: 0,
                    discount,
                    status: "active",
                    location: "delhi" // Default location
                });

                customers_logActivity(`Added new customer ${name}`);
                customers_showToast('Customer added successfully!', 'toast-success');
            }

            customers_customerModal.classList.remove('active');
            customers_renderCustomerTable();
            customers_updateDashboardStats();
        }

        // Calculate order total
        function customers_calculateOrderTotal() {
            if (!customers_currentCustomer) return;

            const milkQty = parseInt(document.getElementById('customers_milkQty').value) || 0;
            const curdQty = parseInt(document.getElementById('customers_curdQty').value) || 0;
            const paneerQty = parseInt(document.getElementById('customers_paneerQty').value) || 0;
            const cheeseQty = parseInt(document.getElementById('customers_cheeseQty').value) || 0;

            const subtotal =
                (milkQty * 45) +
                (curdQty * 40) +
                (paneerQty * 200) +
                (cheeseQty * 300);

            const discount = subtotal * customers_currentCustomer.discount;
            const total = subtotal - discount;

            document.getElementById('customers_orderSubtotal').textContent = 'â‚¹' + subtotal.toFixed(2);
            document.getElementById('customers_orderDiscount').textContent = 'â‚¹' + discount.toFixed(2);
            document.getElementById('customers_orderTotal').textContent = 'â‚¹' + total.toFixed(2);
        }

        // Place order
        function customers_placeOrder() {
            if (!customers_currentCustomer) return;

            const paymentMethod = document.getElementById('customers_paymentMethod').value;
            const paymentStatus = document.getElementById('customers_paymentStatus').value;

            if (!paymentMethod) {
                customers_showToast('Please select a payment method', 'toast-error');
                return;
            }

            // Get quantities
            const milkQty = parseInt(document.getElementById('customers_milkQty').value) || 0;
            const curdQty = parseInt(document.getElementById('customers_curdQty').value) || 0;
            const paneerQty = parseInt(document.getElementById('customers_paneerQty').value) || 0;
            const cheeseQty = parseInt(document.getElementById('customers_cheeseQty').value) || 0;

            // Create order items
            const items = [];
            if (milkQty > 0) items.push({ product: 'milk', qty: milkQty, price: 45 });
            if (curdQty > 0) items.push({ product: 'curd', qty: curdQty, price: 40 });
            if (paneerQty > 0) items.push({ product: 'paneer', qty: paneerQty, price: 200 });
            if (cheeseQty > 0) items.push({ product: 'cheese', qty: cheeseQty, price: 300 });

            if (items.length === 0) {
                customers_showToast('Please add at least one product to the order', 'toast-error');
                return;
            }

            // Calculate order details
            const subtotal = items.reduce((sum, item) => sum + (item.qty * item.price), 0);
            const discount = subtotal * customers_currentCustomer.discount;
            const total = subtotal - discount;

            // Check credit limit if paying with credit
            if (paymentMethod === 'credit') {
                if (customers_currentCustomer.balance + total > customers_currentCustomer.creditLimit) {
                    customers_showToast(`This order exceeds the customer's credit limit (â‚¹${customers_currentCustomer.creditLimit.toLocaleString('en-IN')})`, 'toast-error');
                    return;
                }
            }

            // Create order
            const orderId = 'ORD' + (customers_orders.length + 1001);
            const orderDate = document.getElementById('customers_orderDate').value;

            const order = {
                id: orderId,
                customerId: customers_currentCustomer.id,
                date: orderDate,
                items,
                subtotal,
                discount,
                total,
                paymentMethod,
                paymentStatus,
                amountPaid: paymentStatus === 'paid' ? total : paymentStatus === 'partial' ? total * 0.5 : 0
            };

            customers_orders.push(order);

            // Update customer balance
            if (paymentMethod === 'credit') {
                customers_currentCustomer.balance += total;
            }

            // Log activity
            customers_logActivity(`Placed new order #${orderId} for ${customers_currentCustomer.name} (â‚¹${total.toFixed(2)})`);

            customers_orderModal.classList.remove('active');
            customers_renderCustomerTable();
            customers_renderOrderList();
            customers_updateDashboardStats();
            customers_initCharts();
            customers_showToast('Order placed successfully!', 'toast-success');
        }

        // Mark order as paid
        function customers_markOrderAsPaid(orderId) {
            const order = customers_orders.find(o => o.id === orderId);
            if (!order) return;

            order.paymentStatus = 'paid';
            order.amountPaid = order.total;

            // Log activity
            customers_logActivity(`Marked order #${orderId} as paid`);

            customers_renderOrderList();
            customers_updateDashboardStats();
            customers_showToast('Order marked as paid!', 'toast-success');
        }

        // Log activity
        function customers_logActivity(message) {
            customers_activityLog.unshift({
                type: 'info',
                message,
                timestamp: new Date().toISOString()
            });

            // Keep only the last 20 activities
            if (customers_activityLog.length > 20) {
                customers_activityLog.pop();
            }

            customers_renderActivityLog();
        }

        // Export CSV
        function customers_exportCSV() {
            let csv = 'ID,Name,Phone,Email,Type,Credit Limit,Balance,Status\n';

            customers_data.forEach(customer => {
                csv += `"${customer.id}","${customer.name}","${customer.phone}","${customer.email || ''}",`;
                csv += `"${customer.type}","${customer.creditLimit}","${customer.balance}","${customer.status}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', 'dairy_customers.csv');
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            customers_showToast('CSV exported successfully!', 'toast-success');
        }

        // Show toast notification
        function customers_showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'toast-success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <div class="toast-content">
                    <div>${message}</div>
                </div>
            `;
            customers_toastContainer.appendChild(toast);

            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Helper functions
        function customers_capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function customers_formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function customers_formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize the dashboard when page loads
        window.addEventListener('DOMContentLoaded', customers_initDashboard);
    </script>

    <!--Deliveries-->
    <script>
        // Data structure with initial values
        const deliveries_initialData = {
            deliveries: {
                monday: [
                    { id: "DL-1001", customer: "Supermarket A", product: "Whole Milk", quantity: 120, time: "08:30", vehicle: "Truck 1", status: "Completed", notes: "Early delivery" },
                    { id: "DL-1002", customer: "Cafe Delight", product: "Skim Milk", quantity: 80, time: "10:15", vehicle: "Van 2", status: "Completed", notes: "Customer satisfied" }
                ],
                tuesday: [
                    { id: "DL-2001", customer: "Restaurant B", product: "Whole Milk", quantity: 150, time: "09:00", vehicle: "Truck 2", status: "Scheduled", notes: "Back entrance delivery" }
                ],
                wednesday: [
                    { id: "DL-3001", customer: "School Cafeteria", product: "Chocolate Milk", quantity: 200, time: "07:45", vehicle: "Truck 1", status: "Scheduled", notes: "Summer vacation schedule" }
                ],
                thursday: [
                    { id: "DL-4001", customer: "Catering Service", product: "Skim Milk", quantity: 130, time: "08:15", vehicle: "Truck 1", status: "Scheduled", notes: "VIP customer" }
                ],
                friday: [
                    { id: "DL-5001", customer: "Restaurant C", product: "Whole Milk", quantity: 110, time: "09:30", vehicle: "Van 1", status: "Scheduled", notes: "New customer" }
                ],
                saturday: [
                    { id: "DL-6001", customer: "Supermarket D", product: "Whole Milk", quantity: 170, time: "08:00", vehicle: "Truck 2", status: "Scheduled", notes: "Weekend special" }
                ],
                sunday: [
                    { id: "DL-7001", customer: "Hotel Grand", product: "Whole Milk", quantity: 90, time: "09:00", vehicle: "Van 1", status: "Scheduled", notes: "Sunday brunch delivery" },
                    { id: "DL-7002", customer: "Bakery Corner", product: "Butter", quantity: 25, time: "10:30", vehicle: "Van 2", status: "Scheduled", notes: "Weekly order" }
                ]
            },
            vehicles: [
                { name: "Truck 1", type: "Truck", capacity: 500 },
                { name: "Truck 2", type: "Truck", capacity: 500 },
                { name: "Van 1", type: "Van", capacity: 250 },
                { name: "Van 2", type: "Van", capacity: 250 }
            ],
            activities: [
                { action: "system", message: "Welcome to DairyPro CRM! System initialized.", timestamp: new Date() }
            ]
        };

        // Days of the week
        const deliveries_days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
        const deliveries_dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const deliveries_dayNamesShort = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

        // Global variables
        let deliveries_appData = JSON.parse(JSON.stringify(deliveries_initialData));
        let deliveries_currentDelivery = null;
        let deliveries_currentVehicle = null;
        let deliveries_currentSort = { field: null, direction: 1 };
        let deliveries_chartsInitialized = false;
        let deliveries_currentDay = 'monday';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            deliveries_loadData();
            deliveries_initUI();
            deliveries_renderAll();
            deliveries_setupEventListeners();
        });

        // Load data from localStorage
        function deliveries_loadData() {
            const savedData = localStorage.getItem('dairyCrmData');
            if (savedData) {
                deliveries_appData = JSON.parse(savedData);
            }
        }

        // Save data to localStorage
        function deliveries_saveData() {
            localStorage.setItem('dairyCrmData', JSON.stringify(deliveries_appData));
        }

        // Log activity
        function deliveries_logActivity(action, message) {
            deliveries_appData.activities.unshift({
                action: action,
                message: message,
                timestamp: new Date()
            });

            if (deliveries_appData.activities.length > 20) {
                deliveries_appData.activities.pop();
            }

            deliveries_renderActivities();
            deliveries_saveData();
        }

        // Initialize UI components
        function deliveries_initUI() {
            deliveries_initTabs();
        }

        // Render all data
        function deliveries_renderAll() {
            deliveries_days.forEach(day => deliveries_renderDayTable(day));
            deliveries_renderVehicles();
            deliveries_renderVehicleDropdowns();
            deliveries_renderCalendar();
            deliveries_renderActivities();
            deliveries_updateChartsAndStats();
        }

        // Set up event listeners
        function deliveries_setupEventListeners() {
            // View buttons
            document.querySelectorAll('.view-btn[data-view]').forEach(btn => {
                btn.addEventListener('click', function () {
                    const view = this.getAttribute('data-view');
                    deliveries_switchView(view);
                });
            });

            // Chart view buttons
            document.querySelectorAll('.view-btn[data-chart]').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.view-btn[data-chart]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    deliveries_updateChartsAndStats();
                });
            });

            // Search and filter
            document.getElementById('deliveries_searchInput').addEventListener('input', deliveries_filterDeliveries);
            document.getElementById('deliveries_vehicleFilter').addEventListener('change', deliveries_filterDeliveries);
            document.getElementById('deliveries_productFilter').addEventListener('change', deliveries_filterDeliveries);

            // Add delivery buttons
            document.getElementById('deliveries_addMondayBtn').addEventListener('click', () => deliveries_addDelivery('monday'));
            document.getElementById('deliveries_addTuesdayBtn').addEventListener('click', () => deliveries_addDelivery('tuesday'));
            document.getElementById('deliveries_addWednesdayBtn').addEventListener('click', () => deliveries_addDelivery('wednesday'));
            document.getElementById('deliveries_addThursdayBtn').addEventListener('click', () => deliveries_addDelivery('thursday'));
            document.getElementById('deliveries_addFridayBtn').addEventListener('click', () => deliveries_addDelivery('friday'));
            document.getElementById('deliveries_addSaturdayBtn').addEventListener('click', () => deliveries_addDelivery('saturday'));
            document.getElementById('deliveries_addSundayBtn').addEventListener('click', () => deliveries_addDelivery('sunday'));

            // Vehicle management
            document.getElementById('deliveries_addVehicleBtn').addEventListener('click', deliveries_showVehicleModal);
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', deliveries_hideModals);
            });
            document.getElementById('deliveries_cancelVehicle').addEventListener('click', deliveries_hideModals);
            document.getElementById('deliveries_saveVehicle').addEventListener('click', deliveries_saveVehicle);

            // Delivery modal
            document.getElementById('deliveries_cancelDelivery').addEventListener('click', deliveries_hideModals);
            document.getElementById('deliveries_saveDelivery').addEventListener('click', deliveries_saveDelivery);

            // Table sorting
            document.querySelectorAll('.custom-table th[data-sort]').forEach(th => {
                th.addEventListener('click', function () {
                    const field = this.getAttribute('data-sort');
                    deliveries_sortTable(field);
                });
            });

            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const day = this.getAttribute('data-day');
                    deliveries_currentDay = day;
                    deliveries_switchTab(day);
                });
            });
        }

        // Initialize tabs
        function deliveries_initTabs() {
            document.querySelector('.tab-btn[data-day="monday"]').classList.add('active');
            document.getElementById('deliveries_monday_content').classList.add('active');
        }

        // Switch tabs
        function deliveries_switchTab(day) {
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`.tab-btn[data-day="${day}"]`).classList.add('active');
            document.getElementById(`deliveries_${day}_content`).classList.add('active');
        }

        // Initialize charts
        function deliveries_initCharts() {
            // Only initialize once
            if (deliveries_chartsInitialized) return;

            // Delivery volume chart
            const ctx1 = document.getElementById('deliveries_deliveryChart').getContext('2d');
            window.deliveries_deliveryChart = new Chart(ctx1, {
                type: 'bar',
                data: { labels: deliveries_dayNamesShort, datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Vehicle utilization chart
            const ctx2 = document.getElementById('deliveries_vehicleChart').getContext('2d');
            window.deliveries_vehicleChart = new Chart(ctx2, {
                type: 'radar',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Product distribution chart
            const ctx3 = document.getElementById('deliveries_productChart').getContext('2d');
            window.deliveries_productChart = new Chart(ctx3, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            deliveries_chartsInitialized = true;
        }

        // Render table for a specific day
        function deliveries_renderDayTable(day) {
            const tableBody = document.getElementById(`deliveries_${day}_table`);
            if (!tableBody) return;

            tableBody.innerHTML = '';

            if (deliveries_appData.deliveries[day].length === 0) {
                tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No deliveries scheduled for this day</p>
                    </td>
                </tr>
            `;
                return;
            }

            deliveries_appData.deliveries[day].forEach((delivery, index) => {
                const statusClass = `status-${delivery.status.toLowerCase().replace(' ', '-')}`;

                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${delivery.customer}</td>
                <td>${delivery.product}</td>
                <td>${delivery.quantity}</td>
                <td>${delivery.time}</td>
                <td>${delivery.vehicle}</td>
                <td><span class="status-badge ${statusClass}">${delivery.status}</span></td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-icon btn-edit" title="View Details" data-day="${day}" data-index="${index}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon btn-edit" title="Edit" data-day="${day}" data-index="${index}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon btn-delete" title="Delete" data-day="${day}" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
                tableBody.appendChild(row);
            });

            // Add event listeners to buttons
            deliveries_addTableEventListeners(day);
        }

        // Add event listeners to table elements
        function deliveries_addTableEventListeners(day) {
            const tableBody = document.getElementById(`deliveries_${day}_table`);
            if (!tableBody) return;

            tableBody.addEventListener('click', function (e) {
                const btn = e.target.closest('.btn-icon');
                if (!btn) return;

                const day = btn.getAttribute('data-day');
                const index = parseInt(btn.getAttribute('data-index'));
                const delivery = deliveries_appData.deliveries[day][index];

                if (btn.classList.contains('btn-view')) {
                    deliveries_showDeliveryDetails(delivery);
                }
                else if (btn.classList.contains('btn-edit')) {
                    deliveries_editDelivery(day, index);
                }
                else if (btn.classList.contains('btn-delete')) {
                    deliveries_deleteDelivery(day, index);
                }
            });
        }

        // Render vehicles
        function deliveries_renderVehicles() {
            const container = document.getElementById('deliveries_vehicleManagement');
            if (!container) return;

            container.innerHTML = '';

            deliveries_appData.vehicles.forEach(vehicle => {
                let totalQuantity = 0;
                deliveries_days.forEach(day => {
                    deliveries_appData.deliveries[day].forEach(delivery => {
                        if (delivery.vehicle === vehicle.name) {
                            totalQuantity += delivery.quantity;
                        }
                    });
                });

                const utilization = Math.min(100, Math.round((totalQuantity / vehicle.capacity) * 100));

                const vehicleCard = document.createElement('div');
                vehicleCard.className = 'card';
                vehicleCard.innerHTML = `
                <div class="card-header">
                    <h4>${vehicle.name} (${vehicle.type})</h4>
                </div>
                <div class="card-body card-grid">
                    <p>Capacity: ${vehicle.capacity}L</p>
                    <p>Utilization: ${utilization}%</p>
                    <div class="utilization-bar">
                        <div class="utilization-fill" style="width: ${utilization}%"></div>
                    </div>
                    <div class="action-buttons" style="margin-top:15px;">
                        <button class="btn-icon btn-edit" title="Edit" data-name="${vehicle.name}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon btn-delete" title="Delete" data-name="${vehicle.name}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                </br>
            `;
                container.appendChild(vehicleCard);
            });

            // Add new vehicle button
            const addButton = document.createElement('button');
            addButton.className = 'btn btn-primary';
            addButton.id = 'deliveries_addNewVehicle';
            addButton.innerHTML = '<i class="fas fa-plus"></i> Add New Vehicle';
            addButton.addEventListener('click', deliveries_showVehicleModal);
            container.appendChild(addButton);

            // Add event listeners to vehicle actions
            container.addEventListener('click', function (e) {
                const btn = e.target.closest('.btn-icon');
                if (!btn) return;

                const name = btn.getAttribute('data-name');

                if (btn.classList.contains('btn-edit')) {
                    deliveries_editVehicle(name);
                }
                else if (btn.classList.contains('btn-delete')) {
                    deliveries_deleteVehicle(name);
                }
            });
        }

        // Render vehicle dropdowns
        function deliveries_renderVehicleDropdowns() {
            // Vehicle filter dropdown
            const vehicleFilter = document.getElementById('deliveries_vehicleFilter');
            if (!vehicleFilter) return;

            vehicleFilter.innerHTML = '<option value="">All Vehicles</option>';

            // Delivery vehicle dropdown
            const deliveryVehicle = document.getElementById('deliveries_deliveryVehicle');
            if (!deliveryVehicle) return;

            deliveryVehicle.innerHTML = '';

            deliveries_appData.vehicles.forEach(vehicle => {
                const option1 = document.createElement('option');
                option1.value = vehicle.name;
                option1.textContent = vehicle.name;
                vehicleFilter.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = vehicle.name;
                option2.textContent = vehicle.name;
                deliveryVehicle.appendChild(option2);
            });
        }

        // Render calendar
        function deliveries_renderCalendar() {
            const calendarGrid = document.getElementById('deliveries_calendarGrid');
            if (!calendarGrid) return;

            calendarGrid.innerHTML = '';

            deliveries_days.forEach((day, index) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `
                <div class="calendar-day-header">${deliveries_dayNames[index]}</div>
                <div id="deliveries_calendar_${day}"></div>
            `;
                calendarGrid.appendChild(dayElement);

                const deliveriesContainer = document.getElementById(`deliveries_calendar_${day}`);
                if (!deliveriesContainer) return;

                deliveriesContainer.innerHTML = '';

                deliveries_appData.deliveries[day].forEach(delivery => {
                    const deliveryElement = document.createElement('div');
                    deliveryElement.className = 'calendar-delivery';
                    deliveryElement.innerHTML = `
                    <strong>${delivery.customer}</strong><br>
                    ${delivery.time} - ${delivery.quantity}L<br>
                    ${delivery.vehicle}
                `;
                    deliveryElement.addEventListener('click', () => {
                        deliveries_showDeliveryDetails(delivery);
                    });
                    deliveriesContainer.appendChild(deliveryElement);
                });
            });
        }

        // Render activities
        function deliveries_renderActivities() {
            const activityList = document.getElementById('deliveries_activityList');
            if (!activityList) return;

            activityList.innerHTML = '';

            deliveries_appData.activities.forEach(activity => {
                const icons = {
                    'delivery': 'fa-truck',
                    'vehicle': 'fa-truck-moving',
                    'system': 'fa-cog',
                    'edit': 'fa-edit',
                    'delete': 'fa-trash'
                };

                const activityItem = document.createElement('li');
                activityItem.innerHTML = `
                <i class="fas ${icons[activity.action] || 'fa-info-circle'}"></i>
                <div>
                    <p>${activity.message}</p>
                    <div class="dairy-activity-time">${deliveries_formatTime(activity.timestamp)}</div>
                </div>
            `;
                activityList.appendChild(activityItem);
            });
        }

        // Format time for display
        function deliveries_formatTime(date) {
            return new Date(date).toLocaleString();
        }

        // Update charts and statistics
        function deliveries_updateChartsAndStats() {
            deliveries_initCharts();

            // Update delivery chart
            if (window.deliveries_deliveryChart) {
                window.deliveries_deliveryChart.data = deliveries_getDeliveryChartData();
                window.deliveries_deliveryChart.update();
            }

            // Update vehicle chart
            if (window.deliveries_vehicleChart) {
                window.deliveries_vehicleChart.data = deliveries_getVehicleData();
                window.deliveries_vehicleChart.update();
            }

            // Update product chart
            if (window.deliveries_productChart) {
                window.deliveries_productChart.data = deliveries_getProductData();
                window.deliveries_productChart.update();
            }

            // Update statistics
            deliveries_updateStatistics();
        }

        // Get data for delivery chart
        function deliveries_getDeliveryChartData() {
            const volumes = deliveries_days.map(day => {
                return deliveries_appData.deliveries[day].reduce((total, delivery) => {
                    return total + delivery.quantity;
                }, 0);
            });

            const counts = deliveries_days.map(day => {
                return deliveries_appData.deliveries[day].length;
            });

            const chartType = document.querySelector('.view-btn[data-chart].active')?.getAttribute('data-chart') || 'volume';

            return {
                labels: deliveries_dayNamesShort,
                datasets: [{
                    label: chartType === 'volume' ? 'Volume (L)' : 'Delivery Count',
                    data: chartType === 'volume' ? volumes : counts,
                    backgroundColor: 'rgba(52, 152, 219, 0.7)',
                    borderColor: 'rgb(52, 152, 219)',
                    borderWidth: 1
                }]
            };
        }

        // Get data for vehicle chart
        function deliveries_getVehicleData() {
            const vehicles = deliveries_appData.vehicles.map(v => v.name);
            const utilization = deliveries_appData.vehicles.map(vehicle => {
                let totalQuantity = 0;
                deliveries_days.forEach(day => {
                    deliveries_appData.deliveries[day].forEach(delivery => {
                        if (delivery.vehicle === vehicle.name) {
                            totalQuantity += delivery.quantity;
                        }
                    });
                });

                return Math.min(100, Math.round((totalQuantity / vehicle.capacity) * 100));
            });

            return {
                labels: vehicles,
                datasets: [{
                    label: 'Utilization %',
                    data: utilization,
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    borderColor: 'rgb(46, 204, 113)',
                    pointBackgroundColor: 'rgb(46, 204, 113)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(46, 204, 113)'
                }]
            };
        }

        // Get data for product chart
        function deliveries_getProductData() {
            const products = [
                'Whole Milk', 'Skim Milk', 'Chocolate Milk',
                'Yogurt', 'Cheese', 'Butter', 'Cream'
            ];

            const quantities = {};
            products.forEach(product => quantities[product] = 0);

            deliveries_days.forEach(day => {
                deliveries_appData.deliveries[day].forEach(delivery => {
                    if (quantities.hasOwnProperty(delivery.product)) {
                        quantities[delivery.product] += delivery.quantity;
                    }
                });
            });

            return {
                labels: products,
                datasets: [{
                    label: 'Quantity (L)',
                    data: products.map(p => quantities[p]),
                    backgroundColor: 'rgba(155, 89, 182, 0.2)',
                    borderColor: 'rgb(155, 89, 182)',
                    tension: 0.3,
                    fill: true
                }]
            };
        }

        // Update statistics
        function deliveries_updateStatistics() {
            // Calculate total deliveries
            const totalDeliveries = deliveries_days.reduce((total, day) => {
                return total + deliveries_appData.deliveries[day].length;
            }, 0);
            document.getElementById('deliveries_totalDeliveries').textContent = totalDeliveries;

            // Calculate total volume
            const totalVolume = deliveries_days.reduce((total, day) => {
                return total + deliveries_appData.deliveries[day].reduce((dayTotal, delivery) => {
                    return dayTotal + delivery.quantity;
                }, 0);
            }, 0);
            document.getElementById('deliveries_totalVolume').textContent = totalVolume.toLocaleString();

            // Calculate on-time rate (simulated)
            const completed = deliveries_days.reduce((total, day) => {
                return total + deliveries_appData.deliveries[day].filter(d => d.status === 'Completed').length;
            }, 0);
            const onTimeRate = totalDeliveries > 0 ? Math.round((completed / totalDeliveries) * 100) : 0;
            document.getElementById('deliveries_onTimeRate').textContent = `${onTimeRate}%`;

            // Calculate fuel efficiency (simulated)
            const fuelEfficiency = 7.5 + (Math.random() * 1.5);
            document.getElementById('deliveries_fuelEfficiency').textContent = fuelEfficiency.toFixed(1);
        }

        // Switch between views
        function deliveries_switchView(view) {
            // Update active button
            document.querySelectorAll('.view-btn[data-view]').forEach(b => b.classList.remove('active'));
            document.querySelector(`.view-btn[data-view="${view}"]`).classList.add('active');

            // Hide all views
            document.querySelectorAll('.dashboard-view').forEach(el => {
                el.style.display = 'none';
            });

            // Show selected view
            document.getElementById(`deliveries_${view}View`).style.display = 'block';
        }

        // Filter deliveries
        function deliveries_filterDeliveries() {
            const searchTerm = document.getElementById('deliveries_searchInput').value.toLowerCase();
            const vehicleFilter = document.getElementById('deliveries_vehicleFilter').value;
            const productFilter = document.getElementById('deliveries_productFilter').value;

            deliveries_days.forEach(day => {
                const filteredData = deliveries_appData.deliveries[day].filter(delivery => {
                    const matchesSearch = delivery.customer.toLowerCase().includes(searchTerm) ||
                        delivery.id.toLowerCase().includes(searchTerm);
                    const matchesVehicle = vehicleFilter ? delivery.vehicle === vehicleFilter : true;
                    const matchesProduct = productFilter ? delivery.product === productFilter : true;

                    return matchesSearch && matchesVehicle && matchesProduct;
                });

                const tableBody = document.getElementById(`deliveries_${day}_table`);
                if (!tableBody) return;

                tableBody.innerHTML = '';

                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No matching deliveries for this day</p>
                        </td>
                    </tr>
                `;
                    return;
                }

                filteredData.forEach(delivery => {
                    const statusClass = `status-${delivery.status.toLowerCase().replace(' ', '-')}`;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${delivery.customer}</td>
                    <td>${delivery.product}</td>
                    <td>${delivery.quantity}</td>
                    <td>${delivery.time}</td>
                    <td>${delivery.vehicle}</td>
                    <td><span class="status-badge ${statusClass}">${delivery.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" title="View Details" data-day="${day}" data-id="${delivery.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-edit" title="Edit" data-day="${day}" data-id="${delivery.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" title="Delete" data-day="${day}" data-id="${delivery.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                    tableBody.appendChild(row);
                });
            });
        }

        // Sort table
        function deliveries_sortTable(field) {
            // Toggle sort direction if same field
            if (deliveries_currentSort.field === field) {
                deliveries_currentSort.direction *= -1;
            } else {
                deliveries_currentSort.field = field;
                deliveries_currentSort.direction = 1;
            }

            // Sort data for each day
            deliveries_days.forEach(day => {
                deliveries_appData.deliveries[day].sort((a, b) => {
                    let valA = a[field];
                    let valB = b[field];

                    if (field === 'quantity') {
                        valA = parseInt(valA);
                        valB = parseInt(valB);
                    }

                    if (valA < valB) return -1 * deliveries_currentSort.direction;
                    if (valA > valB) return 1 * deliveries_currentSort.direction;
                    return 0;
                });

                deliveries_renderDayTable(day);
            });
        }

        // Add a new delivery
        function deliveries_addDelivery(day) {
            deliveries_currentDelivery = {
                id: `DL-${Math.floor(1000 + Math.random() * 9000)}`,
                customer: "New Customer",
                product: "Whole Milk",
                quantity: 10,
                time: "09:00",
                vehicle: deliveries_appData.vehicles.length > 0 ? deliveries_appData.vehicles[0].name : "",
                status: "Scheduled",
                notes: "",
                day: day
            };

            document.getElementById('deliveries_deliveryModalTitle').textContent = "Add New Delivery";
            document.getElementById('deliveries_deliveryCustomer').value = deliveries_currentDelivery.customer;
            document.getElementById('deliveries_deliveryProduct').value = deliveries_currentDelivery.product;
            document.getElementById('deliveries_deliveryQuantity').value = deliveries_currentDelivery.quantity;
            document.getElementById('deliveries_deliveryTime').value = deliveries_currentDelivery.time;
            document.getElementById('deliveries_deliveryVehicle').value = deliveries_currentDelivery.vehicle;
            document.getElementById('deliveries_deliveryStatus').value = deliveries_currentDelivery.status;
            document.getElementById('deliveries_deliveryNotes').value = deliveries_currentDelivery.notes;

            document.getElementById('deliveries_deliveryModal').classList.add('active');
        }

        // Edit a delivery
        function deliveries_editDelivery(day, index) {
            deliveries_currentDelivery = { ...deliveries_appData.deliveries[day][index], day, index };

            document.getElementById('deliveries_deliveryModalTitle').textContent = "Edit Delivery";
            document.getElementById('deliveries_deliveryCustomer').value = deliveries_currentDelivery.customer;
            document.getElementById('deliveries_deliveryProduct').value = deliveries_currentDelivery.product;
            document.getElementById('deliveries_deliveryQuantity').value = deliveries_currentDelivery.quantity;
            document.getElementById('deliveries_deliveryTime').value = deliveries_currentDelivery.time;
            document.getElementById('deliveries_deliveryVehicle').value = deliveries_currentDelivery.vehicle;
            document.getElementById('deliveries_deliveryStatus').value = deliveries_currentDelivery.status;
            document.getElementById('deliveries_deliveryNotes').value = deliveries_currentDelivery.notes || "";

            document.getElementById('deliveries_deliveryModal').classList.add('active');
        }

        // Show delivery details
        function deliveries_showDeliveryDetails(delivery) {
            alert(`Delivery Details:\n\nID: ${delivery.id}\nCustomer: ${delivery.customer}\nProduct: ${delivery.product}\nQuantity: ${delivery.quantity}L\nTime: ${delivery.time}\nVehicle: ${delivery.vehicle}\nStatus: ${delivery.status}\nNotes: ${delivery.notes || "None"}`);
        }

        // Save delivery
        function deliveries_saveDelivery() {
            const customer = document.getElementById('deliveries_deliveryCustomer').value;
            const product = document.getElementById('deliveries_deliveryProduct').value;
            const quantity = parseInt(document.getElementById('deliveries_deliveryQuantity').value);
            const time = document.getElementById('deliveries_deliveryTime').value;
            const vehicle = document.getElementById('deliveries_deliveryVehicle').value;
            const status = document.getElementById('deliveries_deliveryStatus').value;
            const notes = document.getElementById('deliveries_deliveryNotes').value;

            if (!customer || !product || !quantity || !time || !vehicle || !status) {
                alert('Please fill all required fields');
                return;
            }

            if (deliveries_currentDelivery.index !== undefined) {
                // Update existing delivery
                deliveries_appData.deliveries[deliveries_currentDelivery.day][deliveries_currentDelivery.index] = {
                    ...deliveries_currentDelivery,
                    customer,
                    product,
                    quantity,
                    time,
                    vehicle,
                    status,
                    notes
                };

                deliveries_logActivity("edit", `Updated delivery for ${customer}`);
            } else {
                // Add new delivery
                const day = deliveries_currentDelivery.day;
                deliveries_appData.deliveries[day].push({
                    id: deliveries_currentDelivery.id,
                    customer,
                    product,
                    quantity,
                    time,
                    vehicle,
                    status,
                    notes
                });

                deliveries_logActivity("delivery", `Added new delivery for ${customer} on ${deliveries_dayNames[deliveries_days.indexOf(day)]}`);
            }

            deliveries_hideModals();
            deliveries_renderAll();
            deliveries_saveData();
        }

        // Delete a delivery
        function deliveries_deleteDelivery(day, index) {
            if (confirm('Are you sure you want to delete this delivery?')) {
                const delivery = deliveries_appData.deliveries[day][index];
                deliveries_appData.deliveries[day].splice(index, 1);

                deliveries_logActivity("delete", `Deleted delivery for ${delivery.customer}`);
                deliveries_renderAll();
                deliveries_saveData();
            }
        }

        // Show vehicle modal
        function deliveries_showVehicleModal() {
            deliveries_currentVehicle = null;
            document.getElementById('deliveries_vehicleModalTitle').textContent = "Add New Vehicle";
            document.getElementById('deliveries_vehicleName').value = "";
            document.getElementById('deliveries_vehicleType').value = "";
            document.getElementById('deliveries_vehicleCapacity').value = "";
            document.getElementById('deliveries_vehicleModal').classList.add('active');
        }

        // Edit a vehicle
        function deliveries_editVehicle(name) {
            deliveries_currentVehicle = deliveries_appData.vehicles.find(v => v.name === name);
            document.getElementById('deliveries_vehicleModalTitle').textContent = "Edit Vehicle";
            document.getElementById('deliveries_vehicleName').value = deliveries_currentVehicle.name;
            document.getElementById('deliveries_vehicleType').value = deliveries_currentVehicle.type;
            document.getElementById('deliveries_vehicleCapacity').value = deliveries_currentVehicle.capacity;
            document.getElementById('deliveries_vehicleModal').classList.add('active');
        }

        // Save vehicle
        function deliveries_saveVehicle() {
            const name = document.getElementById('deliveries_vehicleName').value;
            const type = document.getElementById('deliveries_vehicleType').value;
            const capacity = parseInt(document.getElementById('deliveries_vehicleCapacity').value);

            if (!name || !type || !capacity) {
                alert('Please fill all fields');
                return;
            }

            if (deliveries_currentVehicle) {
                // Update existing vehicle
                deliveries_currentVehicle.name = name;
                deliveries_currentVehicle.type = type;
                deliveries_currentVehicle.capacity = capacity;
                deliveries_logActivity("vehicle", `Updated vehicle ${name}`);
            } else {
                // Add new vehicle
                deliveries_appData.vehicles.push({ name, type, capacity });
                deliveries_logActivity("vehicle", `Added new vehicle ${name}`);
            }

            deliveries_hideModals();
            deliveries_renderAll();
            deliveries_saveData();
        }

        // Delete a vehicle
        function deliveries_deleteVehicle(name) {
            if (confirm('Are you sure you want to delete this vehicle? All deliveries using this vehicle will be reassigned.')) {
                // Reassign deliveries to first available vehicle
                const newVehicle = deliveries_appData.vehicles.length > 1 ?
                    deliveries_appData.vehicles.find(v => v.name !== name).name : "Truck 1";

                deliveries_days.forEach(day => {
                    deliveries_appData.deliveries[day].forEach(delivery => {
                        if (delivery.vehicle === name) {
                            delivery.vehicle = newVehicle;
                        }
                    });
                });

                // Remove vehicle
                deliveries_appData.vehicles = deliveries_appData.vehicles.filter(v => v.name !== name);

                deliveries_logActivity("delete", `Deleted vehicle ${name} and reassigned deliveries`);
                deliveries_renderAll();
                deliveries_saveData();
            }
        }

        // Hide all modals
        function deliveries_hideModals() {
            document.getElementById('deliveries_vehicleModal').classList.remove('active');
            document.getElementById('deliveries_deliveryModal').classList.remove('active');
        }
    </script>

    <!--payments-->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // DOM Elements
            const cardsTotal = document.getElementById("payments_total");
            const cardsAmount = document.getElementById("payments_amount");
            const cardsAvg = document.getElementById("payments_avg");
            const cardsMax = document.getElementById("payments_max");
            const tableBody = document.getElementById("payments_table_body");
            const paginationEl = document.getElementById("payments_pagination");
            const recentListEl = document.getElementById("payments_recent_list");

            const searchInput = document.getElementById("payments_search");
            const typeFilter = document.getElementById("payments_filter_type");
            const statusFilter = document.getElementById("payments_filter_status");
            const methodFilter = document.getElementById("payments_filter_method");
            const startDate = document.getElementById("payments_filter_start");
            const endDate = document.getElementById("payments_filter_end");

            const openModalBtn = document.getElementById("payments_add_btn");
            const modal = document.getElementById("payments_modal");
            const modalClose = document.getElementById("payments_modal_close");
            const modalTitle = document.getElementById("payments_modal_title");
            const form = document.getElementById("payments_form");
            const formCancel = document.getElementById("payments_form_cancel");
            const editId = document.getElementById("payments_edit_id");

            const exportCSV = document.getElementById("payments_export_csv");
            const exportPDF = document.getElementById("payments_export_pdf");

            const notification = document.getElementById("payments_notification");
            const notificationTitle = document.getElementById("payments_notification_title");
            const notificationMsg = document.getElementById("payments_notification_message");

            // Chart contexts
            const chartType = document.getElementById("payments_chart_type").getContext("2d");
            const chartStatus = document.getElementById("payments_chart_status").getContext("2d");
            const chartTrend = document.getElementById("payments_chart_trend").getContext("2d");

            // Data and state
            let paymentData = [];
            let currentPage = 1;
            const PAGE_SIZE = 6;
            let editingId = null;
            let chart1, chart2, chart3;

            // Helper functions
            const genID = () => "PYMT" + Math.random().toString(36).substr(2, 6).toUpperCase();
            const formatDate = d => new Date(d).toLocaleDateString("en-IN", { day: '2-digit', month: 'short', year: 'numeric' });
            const formatCurrency = amount => 'â‚¹' + amount.toLocaleString('en-IN');

            const saveToLocal = () => localStorage.setItem("paymentsData", JSON.stringify(paymentData));
            const loadFromLocal = () => {
                const data = localStorage.getItem("paymentsData");
                if (data) {
                    paymentData = JSON.parse(data);
                } else {
                    // Sample data
                    paymentData = [
                        { id: "PYMT01", type: "Customer", party: "Sneha Rao", date: "2025-06-01", amount: 6200, status: "Paid", method: "UPI", invoice: "INV1001", remarks: "Monthly subscription" },
                        { id: "PYMT02", type: "Farmer", party: "Rajeev Kumar", date: "2025-06-03", amount: 3400, status: "Partially Paid", method: "Bank Transfer", invoice: "INV1002", remarks: "Milk supply June" },
                        { id: "PYMT03", type: "Supplier", party: "AgroMart Ltd.", date: "2025-06-05", amount: 8900, status: "Unpaid", method: "Cheque", invoice: "INV1003", remarks: "Feed & supplements" },
                        { id: "PYMT04", type: "Customer", party: "Neha Sharma", date: "2025-06-07", amount: 7400, status: "Paid", method: "Cash", invoice: "INV1004", remarks: "Advance payment" },
                        { id: "PYMT05", type: "Farmer", party: "Rakesh Singh", date: "2025-06-10", amount: 2800, status: "Paid", method: "UPI", invoice: "INV1005", remarks: "Milk batch May" },
                        { id: "PYMT06", type: "Supplier", party: "GreenFarm Co.", date: "2025-06-12", amount: 4600, status: "Partially Paid", method: "Bank Transfer", invoice: "INV1006", remarks: "Logistics" },
                        { id: "PYMT07", type: "Customer", party: "Vikram Patel", date: "2025-06-15", amount: 5300, status: "Unpaid", method: "Other", invoice: "INV1007", remarks: "Equipment rental" },
                        { id: "PYMT08", type: "Farmer", party: "Priya Sharma", date: "2025-06-18", amount: 4100, status: "Paid", method: "UPI", invoice: "INV1008", remarks: "Milk delivery" },
                        { id: "PYMT09", type: "Supplier", party: "Organic Solutions", date: "2025-06-20", amount: 9200, status: "Partially Paid", method: "Cheque", invoice: "INV1009", remarks: "Fertilizers" },
                        { id: "PYMT10", type: "Customer", party: "Amit Verma", date: "2025-06-22", amount: 6800, status: "Paid", method: "Bank Transfer", invoice: "INV1010", remarks: "Annual subscription" }
                    ];
                    saveToLocal();
                }
            };

            // Render cards with updated data
            const updateCards = () => {
                const totalPayments = paymentData.length;
                const totalAmount = paymentData.reduce((sum, p) => sum + p.amount, 0);
                const avgAmount = totalPayments ? (totalAmount / totalPayments).toFixed(2) : 0;
                const maxPayment = Math.max(...paymentData.map(p => p.amount));

                cardsTotal.textContent = totalPayments;
                cardsAmount.textContent = formatCurrency(totalAmount);
                cardsAvg.textContent = formatCurrency(avgAmount);
                cardsMax.textContent = formatCurrency(maxPayment);
            };

            // Render table with pagination
            const renderTable = () => {
                const filtered = paymentData.filter(p => {
                    const s = searchInput.value.toLowerCase();
                    const matchSearch = p.party.toLowerCase().includes(s) || p.invoice.toLowerCase().includes(s);
                    const matchType = !typeFilter.value || p.type === typeFilter.value;
                    const matchStatus = !statusFilter.value || p.status === statusFilter.value;
                    const matchMethod = !methodFilter.value || p.method === methodFilter.value;
                    const matchStart = !startDate.value || new Date(p.date) >= new Date(startDate.value);
                    const matchEnd = !endDate.value || new Date(p.date) <= new Date(endDate.value);
                    return matchSearch && matchType && matchStatus && matchMethod && matchStart && matchEnd;
                });

                const totalPages = Math.ceil(filtered.length / PAGE_SIZE);
                if (currentPage > totalPages) currentPage = totalPages || 1;

                const start = (currentPage - 1) * PAGE_SIZE;
                const pageData = filtered.slice(start, start + PAGE_SIZE);

                tableBody.innerHTML = pageData.map(p => `
                    <tr>
                        <td>${p.id}</td>
                        <td>${p.type}</td>
                        <td>${p.party}</td>
                        <td>${formatDate(p.date)}</td>
                        <td><strong>${formatCurrency(p.amount)}</strong></td>
                        <td><span class="status-badge status-${p.status.toLowerCase().replace(/\s/g, '-')}">${p.status}</span></td>
                        <td>${p.method}</td>
                        <td>${p.invoice}</td>
                        <td style="display:flex">
                            <button class="btn-edit" onclick="editPayment('${p.id}')">
<i class="fas fa-edit"></i>
 Edit
                            </button>&nbsp;
                            <button class="btn-delete" onclick="deletePayment('${p.id}')">
<i class="fas fa-trash"></i>
 Delete
                            </button>
                        </td>
                    </tr>
                `).join("");

                paginationEl.innerHTML = Array.from({ length: totalPages }, (_, i) => {
                    const page = i + 1;
                    return `<button class="${page === currentPage ? 'active' : ''}" onclick="goToPage(${page})">${page}</button>`;
                }).join("");
            };

            // Global functions
            window.goToPage = (page) => {
                currentPage = page;
                renderTable();
            };

            window.editPayment = (id) => {
                const payment = paymentData.find(p => p.id === id);
                if (!payment) return;

                editingId = id;
                editId.value = id;

                // Fill form with payment data
                document.getElementById("payments_type").value = payment.type;
                document.getElementById("payments_party").value = payment.party;
                document.getElementById("payments_date").value = payment.date;
                document.getElementById("payments_amount_input").value = payment.amount;
                document.getElementById("payments_status").value = payment.status;
                document.getElementById("payments_method").value = payment.method;
                document.getElementById("payments_invoice").value = payment.invoice || '';
                document.getElementById("payments_remarks").value = payment.remarks || '';

                modalTitle.textContent = "Edit Payment";
                modal.classList.add("active");
            };

            window.deletePayment = (id) => {
                if (confirm("Are you sure you want to delete this payment?")) {
                    paymentData = paymentData.filter(p => p.id !== id);
                    saveToLocal();
                    renderAll();
                    showNotification("Payment Deleted", "The payment has been successfully deleted");
                }
            };

            // Render charts
            const renderCharts = () => {
                // Destroy existing charts
                if (chart1) chart1.destroy();
                if (chart2) chart2.destroy();
                if (chart3) chart3.destroy();

                // Type Distribution Chart
                const typeCounts = paymentData.reduce((acc, curr) => {
                    acc[curr.type] = (acc[curr.type] || 0) + 1;
                    return acc;
                }, {});

                chart1 = new Chart(chartType, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(typeCounts),
                        datasets: [{
                            label: 'Payment Count',
                            data: Object.values(typeCounts),
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(75, 192, 192, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 }
                            }
                        }
                    }
                });

                // Status Distribution Chart
                const statusCounts = paymentData.reduce((acc, curr) => {
                    acc[curr.status] = (acc[curr.status] || 0) + 1;
                    return acc;
                }, {});

                chart2 = new Chart(chartStatus, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            data: Object.values(statusCounts),
                            backgroundColor: [
                                'rgba(46, 196, 182, 0.7)',
                                'rgba(255, 158, 0, 0.7)',
                                'rgba(230, 57, 70, 0.7)'
                            ],
                            borderColor: [
                                'rgba(46, 196, 182, 1)',
                                'rgba(255, 158, 0, 1)',
                                'rgba(230, 57, 70, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                // Payments Over Time Chart
                const groupedByDate = paymentData.reduce((acc, curr) => {
                    const date = curr.date;
                    if (!acc[date]) {
                        acc[date] = 0;
                    }
                    acc[date] += curr.amount;
                    return acc;
                }, {});

                const sortedDates = Object.keys(groupedByDate).sort();
                const amounts = sortedDates.map(date => groupedByDate[date]);

                chart3 = new Chart(chartTrend, {
                    type: 'line',
                    data: {
                        labels: sortedDates,
                        datasets: [{
                            label: 'Payment Amount',
                            data: amounts,
                            fill: true,
                            backgroundColor: 'rgba(103, 58, 183, 0.1)',
                            borderColor: 'rgba(103, 58, 183, 1)',
                            tension: 0.3,
                            pointBackgroundColor: 'rgba(103, 58, 183, 1)',
                            pointRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0, 0, 0, 0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            };

            // Render recent activity
            const renderActivity = () => {
                // Sort by date descending and get last 5
                const latest = [...paymentData]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);

                recentListEl.innerHTML = latest.map(p => {
                    const statusClass = p.status.toLowerCase().replace(/\s/g, '-');
                    const icon = p.status === 'Paid' ? 'check_circle' : p.status === 'Partially Paid' ? 'pending' : 'warning';
                    return `
                        <li>
                            <div class="recent-item">
                                <div class="recent-icon">
                                      <i class="fas fa-info-circle">${icon}</i>
                                </div>
                                <div class="recent-content">
                                    <strong>${p.party}</strong>
                                    <div>
                                        <span class="amount">${formatCurrency(p.amount)}</span> 
                                        <span class="status">- ${p.status}</span>
                                    </div>
                                    <div class="meta">
                                        <span>${p.type}</span>
                                        <span>${formatDate(p.date)}</span>
                                        <span>${p.invoice}</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                    `;
                }).join("");
            };

            // Show notification
            const showNotification = (title, message) => {
                notificationTitle.textContent = title;
                notificationMsg.textContent = message;
                notification.classList.add("show");

                setTimeout(() => {
                    notification.classList.remove("show");
                }, 3000);
            };

            // Render all components
            const renderAll = () => {
                updateCards();
                renderTable();
                renderCharts();
                renderActivity();
            };

            // Event listeners
            openModalBtn.addEventListener("click", () => {
                editingId = null;
                editId.value = "";
                form.reset();
                modalTitle.textContent = "Add New Payment";
                modal.classList.add("active");
            });

            modalClose.addEventListener("click", () => {
                modal.classList.remove("active");
            });

            formCancel.addEventListener("click", () => {
                modal.classList.remove("active");
            });

            form.addEventListener("submit", (e) => {
                e.preventDefault();

                // Get form values
                const payment = {
                    id: editingId || genID(),
                    type: document.getElementById("payments_type").value,
                    party: document.getElementById("payments_party").value,
                    date: document.getElementById("payments_date").value,
                    amount: parseFloat(document.getElementById("payments_amount_input").value),
                    status: document.getElementById("payments_status").value,
                    method: document.getElementById("payments_method").value,
                    invoice: document.getElementById("payments_invoice").value,
                    remarks: document.getElementById("payments_remarks").value
                };

                if (editingId) {
                    // Update existing payment
                    const index = paymentData.findIndex(p => p.id === editingId);
                    if (index !== -1) {
                        paymentData[index] = payment;
                        showNotification("Payment Updated", "Payment details have been updated");
                    }
                } else {
                    // Add new payment
                    paymentData.unshift(payment);
                    showNotification("Payment Added", "New payment has been added successfully");
                }

                saveToLocal();
                modal.classList.remove("active");
                renderAll();
            });

            [searchInput, typeFilter, statusFilter, methodFilter, startDate, endDate].forEach(el =>
                el.addEventListener("input", () => {
                    currentPage = 1;
                    renderTable();
                })
            );

            exportCSV.addEventListener("click", () => {
                const csv = ["ID,Type,Party,Date,Amount,Status,Method,Invoice,Remarks"];
                paymentData.forEach(p => {
                    csv.push([p.id, p.type, p.party, p.date, p.amount, p.status, p.method, p.invoice, p.remarks].join(","));
                });
                const blob = new Blob([csv.join("\n")], { type: "text/csv" });
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = "payments.csv";
                a.click();
            });

            exportPDF.addEventListener("click", () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Title
                doc.setFontSize(18);
                doc.text("Payments Summary", 20, 20);

                // Table header
                doc.setFontSize(12);
                doc.text("ID", 20, 30);
                doc.text("Party", 40, 30);
                doc.text("Date", 80, 30);
                doc.text("Amount", 110, 30);
                doc.text("Status", 140, 30);
                doc.text("Method", 170, 30);

                // Table data
                let y = 40;
                paymentData.slice(0, 15).forEach((p, i) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }

                    doc.text(p.id, 20, y);
                    doc.text(p.party, 40, y);
                    doc.text(formatDate(p.date), 80, y);
                    doc.text(formatCurrency(p.amount), 110, y);
                    doc.text(p.status, 140, y);
                    doc.text(p.method, 170, y);

                    y += 10;
                });

                doc.save("payments-summary.pdf");
            });

            // Close modal when clicking outside
            window.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.remove("active");
                }
            });

            // Initialize
            loadFromLocal();
            renderAll();
        });
    </script>

    <!--reports-->
    <script>
        // Initialize reports data
        if (!localStorage.getItem("reports")) {
            const sampleReports = [
                { title: "Monthly Sales Report", type: "Sales", date: "2025-07-01", author: "Ravi Kumar", status: "Finalized" },
                { title: "Inventory Stock Review", type: "Inventory", date: "2025-06-25", author: "Priya Sharma", status: "Draft" },
                { title: "Logistics Overview Q2", type: "Logistics", date: "2025-06-15", author: "Anil Reddy", status: "Finalized" },
                { title: "Milk Sales Projection", type: "Sales", date: "2025-05-30", author: "Ravi Kumar", status: "Draft" },
                { title: "Product Expiry Audit", type: "Inventory", date: "2025-05-10", author: "Sneha Verma", status: "Finalized" }
            ];
            localStorage.setItem("reports", JSON.stringify(sampleReports));
        }

        let reports_data = JSON.parse(localStorage.getItem("reports")) || [];

        // Switch between tabs
        function reports_switch_tab(tab) {
            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            document.querySelectorAll("[id^='reports_tab_']").forEach(sec => sec.style.display = "none");

            // Activate the clicked tab
            const tabs = document.querySelectorAll(".tab");
            for (let i = 0; i < tabs.length; i++) {
                if (tabs[i].getAttribute("onclick").includes(tab)) {
                    tabs[i].classList.add("active");
                    break;
                }
            }

            document.getElementById("reports_tab_" + tab).style.display = "block";

            // Render charts if that tab is selected
            if (tab === "charts") {
                reports_render_charts();
            }
            else if (tab === "table" || tab === "cards") {
                reports_render_table();
            }
        }

        // Render reports table
        function reports_render_table() {
            const tbody = document.getElementById("reports_table_body");
            const search = document.getElementById("reports_search").value.toLowerCase();
            const typeFilter = document.getElementById("reports_type_filter").value;
            tbody.innerHTML = "";

            reports_data.filter(r => {
                return (!typeFilter || r.type === typeFilter) &&
                    (r.title.toLowerCase().includes(search) ||
                        r.type.toLowerCase().includes(search) ||
                        r.author.toLowerCase().includes(search));
            }).forEach((r, i) => {
                const statusClass = r.status === "Finalized" ? "status-finalized" : "status-draft";
                tbody.innerHTML += `
                <tr>
                    <td>${r.title}</td>
                    <td>${r.type}</td>
                    <td>${r.date}</td>
                    <td>${r.author}</td>
                    <td><span class="status-badge ${statusClass}">${r.status}</span></td>
                    <td style="display:flex; gap:6px">
                        <button class="action-btn edit" onclick="reports_edit(${i})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" onclick="reports_delete(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });

            // Also render cards and log
            reports_render_cards();
            reports_render_log();
        }

        // Render card view
        function reports_render_cards() {
            const container = document.getElementById("reports_card_container");
            const search = document.getElementById("reports_search").value.toLowerCase();
            const typeFilter = document.getElementById("reports_type_filter").value;
            container.innerHTML = "";

            reports_data.filter(r => {
                return (!typeFilter || r.type === typeFilter) &&
                    (r.title.toLowerCase().includes(search) ||
                        r.type.toLowerCase().includes(search) ||
                        r.author.toLowerCase().includes(search));
            }).forEach((r, i) => {
                const statusClass = r.status === "Finalized" ? "status-finalized" : "status-draft";
                container.innerHTML += `
                <div class="card" style="border:none;">
                    <div class="card-header">
                        <h3 class="card-title">${r.title}</h3>
                        <span class="status-badge ${statusClass}">${r.status}</span>
                    </div>
                    <p><strong>Type:</strong> ${r.type}</p>
                    <p><strong>Date:</strong> ${r.date}</p>
                    <p><strong>Author:</strong> ${r.author}</p>
                    <div class="form-actions" style="margin-top: 15px;">
                        <button class="btn btn-edit" onclick="reports_edit(${i})">Edit</button>
                        <button class="btn btn-delete" onclick="reports_delete(${i})">Delete</button>
                    </div>
                </div>`;
            });
        }

        // Render activity log
        function reports_render_log() {
            const log = document.getElementById("reports_activity_log");
            log.innerHTML = "";

            // Show latest 5 reports
            reports_data.slice(-5).reverse().forEach(r => {
                log.innerHTML += `<li><i class="fas fa-file"></i> ${r.date}: <strong>${r.title}</strong> by ${r.author} (${r.status})</li>`;
            });
        }

        // Render charts
        function reports_render_charts() {
            const ctx1 = document.getElementById("reports_type_chart");
            const ctx2 = document.getElementById("reports_trend_chart");

            // Destroy previous charts if they exist
            if (window.reportsTypeChart) window.reportsTypeChart.destroy();
            if (window.reportsTrendChart) window.reportsTrendChart.destroy();

            // Calculate data for charts
            const typeCount = {};
            const trend = Array(12).fill(0);
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            reports_data.forEach(r => {
                typeCount[r.type] = (typeCount[r.type] || 0) + 1;
                try {
                    const month = new Date(r.date).getMonth();
                    if (!isNaN(month)) trend[month]++;
                } catch (e) {
                    console.error("Invalid date format:", r.date);
                }
            });

            // Pie chart - Reports by Type
            window.reportsTypeChart = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: Object.keys(typeCount),
                    datasets: [{
                        data: Object.values(typeCount),
                        backgroundColor: ['#2c6e49', '#f8961e', '#457b9d'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Bar chart - Monthly Report Trend
            window.reportsTrendChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: monthNames,
                    datasets: [{
                        label: 'Number of Reports',
                        data: trend,
                        backgroundColor: '#4c956c',
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    }
                }
            });
        }
        // Save report
        function reports_save(e) {
            e.preventDefault();
            const data = {
                title: document.getElementById("reports_title").value,
                type: document.getElementById("reports_type").value,
                date: document.getElementById("reports_date").value,
                author: document.getElementById("reports_author").value,
                status: document.getElementById("reports_status").value
            };

            const index = document.getElementById("reports_edit_index").value;
            if (index !== "") {
                // Update existing report
                reports_data[index] = data;
            } else {
                // Add new report
                reports_data.push(data);
            }

            localStorage.setItem("reports", JSON.stringify(reports_data));
            reports_render_table();
            reports_switch_tab("table");

            // Reset form
            e.target.reset();
            document.getElementById("reports_edit_index").value = "";
        }

        // Edit report
        function reports_edit(i) {
            const r = reports_data[i];
            document.getElementById("reports_edit_index").value = i;
            document.getElementById("reports_title").value = r.title;
            document.getElementById("reports_type").value = r.type;
            document.getElementById("reports_date").value = r.date;
            document.getElementById("reports_author").value = r.author;
            document.getElementById("reports_status").value = r.status;
            reports_switch_tab("form");
        }

        // Delete report
        function reports_delete(i) {
            if (confirm("Are you sure you want to delete this report?")) {
                reports_data.splice(i, 1);
                localStorage.setItem("reports", JSON.stringify(reports_data));
                reports_render_table();
            }
        }

        // Export to CSV
        function reports_export_csv() {
            let csv = "Title,Type,Date,Author,Status\n";
            reports_data.forEach(r => {
                csv += `${r.title},${r.type},${r.date},${r.author},${r.status}\n`;
            });

            const blob = new Blob([csv], { type: "text/csv" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "Reports_Export.csv";
            link.click();
        }

        // Export to PDF
        function reports_export_pdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(18);
            doc.text("Reports Export", 105, 15, null, null, "center");
            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text(new Date().toLocaleDateString(), 105, 22, null, null, "center");

            // Table data
            const headers = [["Title", "Type", "Date", "Author", "Status"]];
            const data = reports_data.map(r => [r.title, r.type, r.date, r.author, r.status]);

            // Generate PDF
            doc.autoTable({
                head: headers,
                body: data,
                startY: 30,
                theme: "grid",
                styles: { fontSize: 10, cellPadding: 3 },
                headStyles: { fillColor: [44, 110, 73] }
            });

            // Save the PDF
            doc.save("Reports_Export.pdf");
        }

        // Initialize the page
        window.onload = function () {
            reports_render_table();

            // Add event listeners
            document.getElementById("reports_search").addEventListener("input", reports_render_table);
            document.getElementById("reports_type_filter").addEventListener("change", reports_render_table);
        };
    </script>


</body>
</html>
